/*

 This is a generated file. DO NOT EDIT.

 Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>

 @licstart
 The code in this file is free software: you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License (GNU AGPL)
 as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 The code in this file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with WebODF.  If not, see <http://www.gnu.org/licenses/>.

 As additional permission under GNU AGPL version 3 section 7, you
 may distribute UNMODIFIED VERSIONS OF THIS file without the copy of the GNU AGPL normally
 required by section 4, provided you include this license notice and a URL
 through which recipients can access the Corresponding Source.

 As a special exception to the AGPL, any HTML file which merely makes function
 calls to this code, and for that purpose includes it in unmodified form by reference or in-line shall be
 deemed a separate work for copyright law purposes. In addition, the copyright
 holders of this code give you permission to combine this code with free
 software libraries that are released under the GNU LGPL. You may copy and
 distribute such a system following the terms of the GNU AGPL for this code
 and the LGPL for the libraries. If you modify this code, you may extend this
 exception to your version of the code, but you are not obligated to do so.
 If you do not wish to do so, delete this exception statement from your
 version.

 This license applies to this entire compilation.
 @licend

 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var webodf_version="0.5.0";function Runtime(){}Runtime.prototype.getVariable=function(g){};Runtime.prototype.toJson=function(g){};Runtime.prototype.fromJson=function(g){};Runtime.prototype.byteArrayFromString=function(g,l){};Runtime.prototype.byteArrayToString=function(g,l){};Runtime.prototype.read=function(g,l,e,b){};Runtime.prototype.readFile=function(g,l,e){};Runtime.prototype.readFileSync=function(g,l){};Runtime.prototype.loadXML=function(g,l){};Runtime.prototype.writeFile=function(g,l,e){};
Runtime.prototype.isFile=function(g,l){};Runtime.prototype.getFileSize=function(g,l){};Runtime.prototype.deleteFile=function(g,l){};Runtime.prototype.log=function(g,l){};Runtime.prototype.setTimeout=function(g,l){};Runtime.prototype.clearTimeout=function(g){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(g){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};
Runtime.prototype.parseXML=function(g){};Runtime.prototype.exit=function(g){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(g){};Runtime.prototype.cancelAnimationFrame=function(g){};Runtime.prototype.assert=function(g,l,e){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(g,l){function e(b){var e="",m,c=b.length;for(m=0;m<c;m+=1)e+=String.fromCharCode(b[m]&255);return e}function b(b){var e="",m,c=b.length,p=[],r,d,a,n;for(m=0;m<c;m+=1)r=b[m],128>r?p.push(r):(m+=1,d=b[m],194<=r&&224>r?p.push((r&31)<<6|d&63):(m+=1,a=b[m],224<=r&&240>r?p.push((r&15)<<12|(d&63)<<6|a&63):(m+=1,n=b[m],240<=r&&245>r&&(r=(r&7)<<18|(d&63)<<12|(a&63)<<6|n&63,r-=65536,p.push((r>>10)+55296,(r&1023)+56320))))),1E3<=p.length&&(e+=String.fromCharCode.apply(null,
p),p.length=0);return e+String.fromCharCode.apply(null,p)}var c;"utf8"===l?c=b(g):("binary"!==l&&this.log("Unsupported encoding: "+l),c=e(g));return c};Runtime.getVariable=function(g){try{return eval(g)}catch(l){}};Runtime.toJson=function(g){return JSON.stringify(g)};Runtime.fromJson=function(g){return JSON.parse(g)};Runtime.getFunctionName=function(g){return void 0===g.name?(g=/function\s+(\w+)/.exec(g))&&g[1]:g.name};
function BrowserRuntime(g){function l(b){var d=b.length,a,n,h=0;for(a=0;a<d;a+=1)n=b.charCodeAt(a),h+=1+(128<n)+(2048<n),55040<n&&57344>n&&(h+=1,a+=1);return h}function e(b,d,a){var n=b.length,h,x;d=new Uint8Array(new ArrayBuffer(d));a?(d[0]=239,d[1]=187,d[2]=191,x=3):x=0;for(a=0;a<n;a+=1)h=b.charCodeAt(a),128>h?(d[x]=h,x+=1):2048>h?(d[x]=192|h>>>6,d[x+1]=128|h&63,x+=2):55040>=h||57344<=h?(d[x]=224|h>>>12&15,d[x+1]=128|h>>>6&63,d[x+2]=128|h&63,x+=3):(a+=1,h=(h-55296<<10|b.charCodeAt(a)-56320)+65536,
d[x]=240|h>>>18&7,d[x+1]=128|h>>>12&63,d[x+2]=128|h>>>6&63,d[x+3]=128|h&63,x+=4);return d}function b(b){var d=b.length,a=new Uint8Array(new ArrayBuffer(d)),n;for(n=0;n<d;n+=1)a[n]=b.charCodeAt(n)&255;return a}function c(b,d){var a,n,h;void 0!==d?h=b:d=b;g?(n=g.ownerDocument,h&&(a=n.createElement("span"),a.className=h,a.appendChild(n.createTextNode(h)),g.appendChild(a),g.appendChild(n.createTextNode(" "))),a=n.createElement("span"),0<d.length&&"<"===d[0]?a.innerHTML=d:a.appendChild(n.createTextNode(d)),
g.appendChild(a),g.appendChild(n.createElement("br"))):console&&console.log(d);"alert"===h&&alert(d)}function k(r,d,a){if(0!==a.status||a.responseText)if(200===a.status||0===a.status){if(a.response&&"string"!==typeof a.response)"binary"===d?(a=a.response,a=new Uint8Array(a)):a=String(a.response);else if("binary"===d)if(null!==a.responseBody&&"undefined"!==String(typeof VBArray)){a=(new VBArray(a.responseBody)).toArray();var n=a.length,h=new Uint8Array(new ArrayBuffer(n));for(d=0;d<n;d+=1)h[d]=a[d];
a=h}else{(d=a.getResponseHeader("Content-Length"))&&(d=parseInt(d,10));if(d&&d!==a.responseText.length)a:{var n=a.responseText,h=!1,x=l(n);if("number"===typeof d){if(d!==x&&d!==x+3){n=void 0;break a}h=x+3===d;x=d}n=e(n,x,h)}void 0===n&&(n=b(a.responseText));a=n}else a=a.responseText;p[r]=a;r={err:null,data:a}}else r={err:a.responseText||a.statusText,data:null};else r={err:"File "+r+" is empty.",data:null};return r}function f(b,d,a){var n=new XMLHttpRequest;n.open("GET",b,a);n.overrideMimeType&&("binary"!==
d?n.overrideMimeType("text/plain; charset="+d):n.overrideMimeType("text/plain; charset=x-user-defined"));return n}function m(b,d,a){function n(){var n;4===h.readyState&&(n=k(b,d,h),a(n.err,n.data))}if(p.hasOwnProperty(b))a(null,p[b]);else{var h=f(b,d,!0);h.onreadystatechange=n;try{h.send(null)}catch(x){a(x.message,null)}}}var q=this,p={};this.byteArrayFromString=function(r,d){var a;"utf8"===d?a=e(r,l(r),!1):("binary"!==d&&q.log("unknown encoding: "+d),a=b(r));return a};this.byteArrayToString=Runtime.byteArrayToString;
this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=m;this.read=function(b,d,a,n){m(b,"binary",function(h,b){var e=null;if(b){if("string"===typeof b)throw"This should not happen.";e=b.subarray(d,d+a)}n(h,e)})};this.readFileSync=function(b,d){var a=f(b,d,!1),n;try{a.send(null);n=k(b,d,a);if(n.err)throw n.err;if(null===n.data)throw"No data read from "+b+".";}catch(h){throw h;}return n.data};this.writeFile=function(b,d,a){p[b]=d;var n=new XMLHttpRequest,
h;n.open("PUT",b,!0);n.onreadystatechange=function(){4===n.readyState&&(0!==n.status||n.responseText?200<=n.status&&300>n.status||0===n.status?a(null):a("Status "+String(n.status)+": "+n.responseText||n.statusText):a("File "+b+" is empty."))};h=d.buffer&&!n.sendAsBinary?d.buffer:q.byteArrayToString(d,"binary");try{n.sendAsBinary?n.sendAsBinary(h):n.send(h)}catch(e){q.log("HUH? "+e+" "+d),a(e.message)}};this.deleteFile=function(b,d){delete p[b];var a=new XMLHttpRequest;a.open("DELETE",b,!0);a.onreadystatechange=
function(){4===a.readyState&&(200>a.status&&300<=a.status?d(a.responseText):d(null))};a.send(null)};this.loadXML=function(b,d){var a=new XMLHttpRequest;a.open("GET",b,!0);a.overrideMimeType&&a.overrideMimeType("text/xml");a.onreadystatechange=function(){4===a.readyState&&(0!==a.status||a.responseText?200===a.status||0===a.status?d(null,a.responseXML):d(a.responseText,null):d("File "+b+" is empty.",null))};try{a.send(null)}catch(n){d(n.message,null)}};this.isFile=function(b,d){q.getFileSize(b,function(a){d(-1!==
a)})};this.getFileSize=function(b,d){if(p.hasOwnProperty(b)&&"string"!==typeof p[b])d(p[b].length);else{var a=new XMLHttpRequest;a.open("HEAD",b,!0);a.onreadystatechange=function(){if(4===a.readyState){var n=a.getResponseHeader("Content-Length");n?d(parseInt(n,10)):m(b,"binary",function(a,n){a?d(-1):d(n.length)})}};a.send(null)}};this.log=c;this.assert=function(b,d,a){if(!b)throw c("alert","ASSERTION FAILED:\n"+d),a&&a(),d;};this.setTimeout=function(b,d){return setTimeout(function(){b()},d)};this.clearTimeout=
function(b){clearTimeout(b)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(b){return(new DOMParser).parseFromString(b,"text/xml")};this.exit=function(b){c("Calling exit with code "+String(b)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=
function(b){var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,a=0;if(d)d.bind(window),a=d(b);else return setTimeout(b,15);return a};this.cancelAnimationFrame=function(b){var d=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;d?(d.bind(window),d(b)):clearTimeout(b)}}
function NodeJSRuntime(){function g(b){var e=b.length,m,d=new Uint8Array(new ArrayBuffer(e));for(m=0;m<e;m+=1)d[m]=b[m];return d}function l(e,m,f){function d(a,d){if(a)return f(a,null);if(!d)return f("No data for "+e+".",null);if("string"===typeof d)return f(a,d);f(a,g(d))}e=c.resolve(k,e);"binary"!==m?b.readFile(e,m,d):b.readFile(e,null,d)}var e=this,b=require("fs"),c=require("path"),k="",f,m;this.byteArrayFromString=function(b,e){var m=new Buffer(b,e),d,a=m.length,n=new Uint8Array(new ArrayBuffer(a));
for(d=0;d<a;d+=1)n[d]=m[d];return n};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=l;this.loadXML=function(b,m){l(b,"utf-8",function(c,d){if(c)return m(c,null);if(!d)return m("No data for "+b+".",null);m(null,e.parseXML(d))})};this.writeFile=function(e,m,f){m=new Buffer(m);e=c.resolve(k,e);b.writeFile(e,m,"binary",function(d){f(d||null)})};this.deleteFile=function(e,m){e=c.resolve(k,e);
b.unlink(e,m)};this.read=function(e,m,f,d){e=c.resolve(k,e);b.open(e,"r+",666,function(a,n){if(a)d(a,null);else{var h=new Buffer(f);b.read(n,h,0,f,m,function(a){b.close(n);d(a,g(h))})}})};this.readFileSync=function(e,m){var c;c=b.readFileSync(e,"binary"===m?null:m);if(null===c)throw"File "+e+" could not be read.";"binary"===m&&(c=g(c));return c};this.isFile=function(e,m){e=c.resolve(k,e);b.stat(e,function(b,d){m(!b&&d.isFile())})};this.getFileSize=function(e,m){e=c.resolve(k,e);b.stat(e,function(b,
d){b?m(-1):m(d.size)})};this.log=function(b,e){var m;void 0!==e?m=b:e=b;"alert"===m&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(e+"\n");"alert"===m&&process.stderr.write("!!!!! ALERT !!!!!\n")};this.assert=function(b,e,m){b||(process.stderr.write("ASSERTION FAILED: "+e),m&&m())};this.setTimeout=function(b,e){return setTimeout(function(){b()},e)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(b){k=
b};this.currentDirectory=function(){return k};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return m};this.parseXML=function(b){return f.parseFromString(b,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){return setTimeout(b,15)};this.cancelAnimationFrame=function(b){clearTimeout(b)};f=new (require("xmldom").DOMParser);m=e.parseXML("<a/>").implementation}
function RhinoRuntime(){function g(b,e){var c;void 0!==e?c=b:e=b;"alert"===c&&print("\n!!!!! ALERT !!!!!");print(e);"alert"===c&&print("!!!!! ALERT !!!!!")}var l=this,e={},b=e.javax.xml.parsers.DocumentBuilderFactory.newInstance(),c,k,f="";b.setValidating(!1);b.setNamespaceAware(!0);b.setExpandEntityReferences(!1);b.setSchema(null);k=e.org.xml.sax.EntityResolver({resolveEntity:function(b,c){var f=new e.java.io.FileReader(c);return new e.org.xml.sax.InputSource(f)}});c=b.newDocumentBuilder();c.setEntityResolver(k);
this.byteArrayFromString=function(b,e){var c,f=b.length,d=new Uint8Array(new ArrayBuffer(f));for(c=0;c<f;c+=1)d[c]=b.charCodeAt(c)&255;return d};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(b,f){var k=new e.java.io.File(b),r=null;try{r=c.parse(k)}catch(d){return print(d),f(d,null)}f(null,r)};this.readFile=function(b,c,k){f&&(b=f+"/"+b);var r=new e.java.io.File(b),d="binary"===c?
"latin1":c;r.isFile()?((b=readFile(b,d))&&"binary"===c&&(b=l.byteArrayFromString(b,"binary")),k(null,b)):k(b+" is not a file.",null)};this.writeFile=function(b,c,k){f&&(b=f+"/"+b);b=new e.java.io.FileOutputStream(b);var r,d=c.length;for(r=0;r<d;r+=1)b.write(c[r]);b.close();k(null)};this.deleteFile=function(b,c){f&&(b=f+"/"+b);var k=new e.java.io.File(b),r=b+Math.random(),r=new e.java.io.File(r);k.rename(r)?(r.deleteOnExit(),c(null)):c("Could not delete "+b)};this.read=function(b,c,k,r){f&&(b=f+"/"+
b);var d;d=b;var a="binary";(new e.java.io.File(d)).isFile()?("binary"===a&&(a="latin1"),d=readFile(d,a)):d=null;d?r(null,this.byteArrayFromString(d.substring(c,c+k),"binary")):r("Cannot read "+b,null)};this.readFileSync=function(b,e){if(!e)return"";var c=readFile(b,e);if(null===c)throw"File could not be read.";return c};this.isFile=function(b,c){f&&(b=f+"/"+b);var k=new e.java.io.File(b);c(k.isFile())};this.getFileSize=function(b,c){f&&(b=f+"/"+b);var k=new e.java.io.File(b);c(k.length())};this.log=
g;this.assert=function(b,e,c){b||(g("alert","ASSERTION FAILED: "+e),c&&c())};this.setTimeout=function(b){b();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(b){f=b};this.currentDirectory=function(){return f};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return c.getDOMImplementation()};this.parseXML=function(b){b=new e.java.io.StringReader(b);b=new e.org.xml.sax.InputSource(b);return c.parse(b)};
this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){b();return 0};this.cancelAnimationFrame=function(){}}Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};
(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function g(b,e,c){var f=b+"/manifest.json",d,a;runtime.log("Loading manifest: "+f);try{d=runtime.readFileSync(f,"utf-8")}catch(n){if(c)runtime.log("No loadable manifest found.");else throw console.log(String(n)),n;return}c=JSON.parse(d);for(a in c)c.hasOwnProperty(a)&&(e[a]={dir:b,deps:c[a]})}function l(b,e,c){function f(h){if(!n[h]&&!c(h)){if(a[h])throw"Circular dependency detected for "+h+".";a[h]=!0;if(!e[h])throw"Missing dependency information for class "+h+".";var b=e[h],m=b.deps,
k,g=m.length;for(k=0;k<g;k+=1)f(m[k]);a[h]=!1;n[h]=!0;d.push(b.dir+"/"+h.replace(".","/")+".js")}}var d=[],a={},n={};b.forEach(f);return d}function e(b,e){return e=e+("\n//# sourceURL="+b)+("\n//@ sourceURL="+b)}function b(b){var c,f;for(c=0;c<b.length;c+=1)f=runtime.readFileSync(b[c],"utf-8"),f=e(b[c],f),eval(f)}function c(b){b=b.split(".");var e,c=f,k=b.length;for(e=0;e<k;e+=1){if(!c.hasOwnProperty(b[e]))return!1;c=c[b[e]]}return!0}var k,f={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=
function(e,f){if(IS_COMPILED_CODE||0===e.length)return f&&f();var p;if(!(p=k)){p=[];var r=runtime.libraryPaths(),d;runtime.currentDirectory()&&-1===r.indexOf(runtime.currentDirectory())&&g(runtime.currentDirectory(),p,!0);for(d=0;d<r.length;d+=1)g(r[d],p)}k=p;e=l(e,k,c);if(0===e.length)return f&&f();if("BrowserRuntime"===runtime.type()&&f){p=e;r=document.currentScript||document.documentElement.lastChild;d=document.createDocumentFragment();var a,n;for(n=0;n<p.length;n+=1)a=document.createElement("script"),
a.type="text/javascript",a.charset="utf-8",a.async=!1,a.setAttribute("src",p[n]),d.appendChild(a);f&&(a.onload=f);r.parentNode.insertBefore(d,r)}else b(e),f&&f()};runtime.loadClass=function(b,e){runtime.loadClasses([b],e)}})();(function(){var g=function(g){return g};runtime.getTranslator=function(){return g};runtime.setTranslator=function(l){g=l};runtime.tr=function(l){var e=g(l);return e&&"string"===String(typeof e)?e:l}})();
(function(g){function l(e){if(e.length){var b=e[0];runtime.readFile(b,"utf8",function(c,k){function f(){var b;(b=eval(g))&&runtime.exit(b)}var m="",m=b.lastIndexOf("/"),g=k,m=-1!==m?b.substring(0,m):".";runtime.setCurrentDirectory(m);c?(runtime.log(c),runtime.exit(1)):null===g?(runtime.log("No code found for "+b),runtime.exit(1)):f.apply(null,e)})}}g=g?Array.prototype.slice.call(g):[];"NodeJSRuntime"===runtime.type()?l(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?l(g):l(g.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(g,l,e){function b(b){f!==k&&(b?(f=k,e(b)):(f+=1,f===k&&e(null)))}var c,k=g.length,f=0;for(c=0;c<k;c+=1)l(g[c],b)},destroyAll:function(g,l){function e(b,c){if(c)l(c);else if(b<g.length)g[b](function(c){e(b+1,c)});else l()}e(0,void 0)}}}()})();function makeBase64(){function g(a){var d,h=a.length,n=new Uint8Array(new ArrayBuffer(h));for(d=0;d<h;d+=1)n[d]=a.charCodeAt(d)&255;return n}function l(a){var d,h="",n,b=a.length-2;for(n=0;n<b;n+=3)d=a[n]<<16|a[n+1]<<8|a[n+2],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>18],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>12&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>6&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d&
63];n===b+1?(d=a[n]<<4,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>6],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d&63],h+="=="):n===b&&(d=a[n]<<10|a[n+1]<<2,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>12],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d>>>6&63],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[d&63],h+="=");return h}function e(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,
"");var d=a.length,n=new Uint8Array(new ArrayBuffer(3*d)),b=a.length%4,e=0,c,D;for(c=0;c<d;c+=4)D=(h[a.charAt(c)]||0)<<18|(h[a.charAt(c+1)]||0)<<12|(h[a.charAt(c+2)]||0)<<6|(h[a.charAt(c+3)]||0),n[e]=D>>16,n[e+1]=D>>8&255,n[e+2]=D&255,e+=3;d=3*d-[0,0,2,1][b];return n.subarray(0,d)}function b(a){var d,h,n=a.length,b=0,e=new Uint8Array(new ArrayBuffer(3*n));for(d=0;d<n;d+=1)h=a[d],128>h?e[b++]=h:(2048>h?e[b++]=192|h>>>6:(e[b++]=224|h>>>12&15,e[b++]=128|h>>>6&63),e[b++]=128|h&63);return e.subarray(0,
b)}function c(a){var d,h,n,b,e=a.length,D=new Uint8Array(new ArrayBuffer(e)),c=0;for(d=0;d<e;d+=1)h=a[d],128>h?D[c++]=h:(d+=1,n=a[d],224>h?D[c++]=(h&31)<<6|n&63:(d+=1,b=a[d],D[c++]=(h&15)<<12|(n&63)<<6|b&63));return D.subarray(0,c)}function k(a){return l(g(a))}function f(a){return String.fromCharCode.apply(String,e(a))}function m(a){return c(g(a))}function q(a){a=c(a);for(var d="",h=0;h<a.length;)d+=String.fromCharCode.apply(String,a.subarray(h,h+45E3)),h+=45E3;return d}function p(a,d,h){var n,b,
e,D="";for(e=d;e<h;e+=1)d=a.charCodeAt(e)&255,128>d?D+=String.fromCharCode(d):(e+=1,n=a.charCodeAt(e)&255,224>d?D+=String.fromCharCode((d&31)<<6|n&63):(e+=1,b=a.charCodeAt(e)&255,D+=String.fromCharCode((d&15)<<12|(n&63)<<6|b&63)));return D}function r(a,d){function h(){var e=b+1E5;e>a.length&&(e=a.length);n+=p(a,b,e);b=e;e=b===a.length;d(n,e)&&!e&&runtime.setTimeout(h,0)}var n="",b=0;1E5>a.length?d(p(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),h())}function d(a){return b(g(a))}function a(a){return String.fromCharCode.apply(String,
b(a))}function n(a){return String.fromCharCode.apply(String,b(g(a)))}var h=function(a){var d={},h,n;h=0;for(n=a.length;h<n;h+=1)d[a.charAt(h)]=h;return d}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),x,w,y=runtime.getWindow(),u,s;y&&y.btoa?(u=y.btoa,x=function(a){return u(n(a))}):(u=k,x=function(a){return l(d(a))});y&&y.atob?(s=y.atob,w=function(a){a=s(a);return p(a,0,a.length)}):(s=f,w=function(a){return q(e(a))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=
l;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=e;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=b;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=c;this.convertUTF8StringToBase64=k;this.convertBase64ToUTF8String=f;this.convertUTF8StringToUTF16Array=m;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=q;this.convertUTF8StringToUTF16String=r;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=d;this.convertUTF16ArrayToUTF8String=
a;this.convertUTF16StringToUTF8String=n;this.convertUTF16StringToBase64=x;this.convertBase64ToUTF16String=w;this.fromBase64=f;this.toBase64=k;this.atob=s;this.btoa=u;this.utob=n;this.btou=r;this.encode=x;this.encodeURI=function(a){return x(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return w(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();core.ByteArray=function(g){this.pos=0;this.data=g;this.readUInt32LE=function(){this.pos+=4;var g=this.data,e=this.pos;return g[--e]<<24|g[--e]<<16|g[--e]<<8|g[--e]};this.readUInt16LE=function(){this.pos+=2;var g=this.data,e=this.pos;return g[--e]<<8|g[--e]}};core.ByteArrayWriter=function(g){function l(e){e>c-b&&(c=Math.max(2*c,b+e),e=new Uint8Array(new ArrayBuffer(c)),e.set(k),k=e)}var e=this,b=0,c=1024,k=new Uint8Array(new ArrayBuffer(c));this.appendByteArrayWriter=function(b){e.appendByteArray(b.getByteArray())};this.appendByteArray=function(e){var c=e.length;l(c);k.set(e,b);b+=c};this.appendArray=function(e){var c=e.length;l(c);k.set(e,b);b+=c};this.appendUInt16LE=function(b){e.appendArray([b&255,b>>8&255])};this.appendUInt32LE=function(b){e.appendArray([b&
255,b>>8&255,b>>16&255,b>>24&255])};this.appendString=function(b){e.appendByteArray(runtime.byteArrayFromString(b,g))};this.getLength=function(){return b};this.getByteArray=function(){var e=new Uint8Array(new ArrayBuffer(b));e.set(k.subarray(0,b));return e}};core.CSSUnits=function(){var g=this,l={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(e,b,c){return e*l[c]/l[b]};this.convertMeasure=function(e,b){var c,k;e&&b&&(c=parseFloat(e),k=e.replace(c.toString(),""),c=g.convert(c,k,b));return c};this.getUnits=function(e){return e.substr(e.length-2,e.length)}};(function(){function g(){var b,c,k,f,m,g,l,r,d;void 0===e&&(c=(b=runtime.getWindow())&&b.document,g=c.documentElement,l=c.body,e={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},c&&(f=c.createElement("div"),f.style.position="absolute",f.style.left="-99999px",f.style.transform="scale(2)",f.style["-webkit-transform"]="scale(2)",m=c.createElement("div"),f.appendChild(m),l.appendChild(f),b=c.createRange(),b.selectNode(m),e.rangeBCRIgnoresElementBCR=0===b.getClientRects().length,
m.appendChild(c.createTextNode("Rect transform test")),c=m.getBoundingClientRect(),k=b.getBoundingClientRect(),e.unscaledRangeClientRects=2<Math.abs(c.height-k.height),f.style.transform="",f.style["-webkit-transform"]="",c=g.style.overflow,k=l.style.overflow,r=l.style.height,d=l.scrollTop,g.style.overflow="visible",l.style.overflow="visible",l.style.height="200%",l.scrollTop=l.scrollHeight,e.elementBCRIgnoresBodyScroll=b.getBoundingClientRect().top!==m.getBoundingClientRect().top,l.scrollTop=d,l.style.height=
r,l.style.overflow=k,g.style.overflow=c,b.detach(),l.removeChild(f),b=Object.keys(e).map(function(a){return a+":"+String(e[a])}).join(", "),runtime.log("Detected browser quirks - "+b)));return e}function l(b,e,k){for(b=b?b.firstElementChild:null;b;){if(b.localName===k&&b.namespaceURI===e)return b;b=b.nextElementSibling}return null}var e;core.DomUtils=function(){function b(a,d){for(var b=0,e;a.parentNode!==d;)runtime.assert(null!==a.parentNode,"parent is null"),a=a.parentNode;for(e=d.firstChild;e!==
a;)b+=1,e=e.nextSibling;return b}function e(a,d){return 0>=a.compareBoundaryPoints(Range.START_TO_START,d)&&0<=a.compareBoundaryPoints(Range.END_TO_END,d)}function k(a,d){return 0>=a.compareBoundaryPoints(Range.END_TO_START,d)&&0<=a.compareBoundaryPoints(Range.START_TO_END,d)}function f(a,d){var b=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),d.nodeType===Node.TEXT_NODE&&(b=d)):(d.nodeType===Node.TEXT_NODE&&(a.appendData(d.data),d.parentNode.removeChild(d)),b=a));return b}
function m(a){for(var d=a.parentNode;a.firstChild;)d.insertBefore(a.firstChild,a);d.removeChild(a);return d}function q(a,d){for(var b=a.parentNode,e=a.firstChild,c;e;)c=e.nextSibling,q(e,d),e=c;b&&d(a)&&m(a);return b}function p(a,d){return a===d||Boolean(a.compareDocumentPosition(d)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function r(a,d){return g().unscaledRangeClientRects?a:a/d}function d(a,h,b){Object.keys(h).forEach(function(e){var c=e.split(":"),f=c[1],k=b(c[0]),c=h[e],g=typeof c;"object"===g?Object.keys(c).length&&
(e=k?a.getElementsByTagNameNS(k,f)[0]||a.ownerDocument.createElementNS(k,e):a.getElementsByTagName(f)[0]||a.ownerDocument.createElement(e),a.appendChild(e),d(e,c,b)):k&&(runtime.assert("number"===g||"string"===g,"attempting to map unsupported type '"+g+"' (key: "+e+")"),a.setAttributeNS(k,e,String(c)))})}var a=null;this.splitBoundaries=function(a){var d,e=[],c,f,k;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===Node.TEXT_NODE){c=a.endContainer;f=a.endContainer.nodeType!==
Node.TEXT_NODE?a.endOffset===a.endContainer.childNodes.length:!1;k=a.endOffset;d=a.endContainer;if(k<d.childNodes.length)for(d=d.childNodes.item(k),k=0;d.firstChild;)d=d.firstChild;else for(;d.lastChild;)d=d.lastChild,k=d.nodeType===Node.TEXT_NODE?d.textContent.length:d.childNodes.length;d===c&&(c=null);a.setEnd(d,k);k=a.endContainer;0!==a.endOffset&&k.nodeType===Node.TEXT_NODE&&(d=k,a.endOffset!==d.length&&(e.push(d.splitText(a.endOffset)),e.push(d)));k=a.startContainer;0!==a.startOffset&&k.nodeType===
Node.TEXT_NODE&&(d=k,a.startOffset!==d.length&&(k=d.splitText(a.startOffset),e.push(d),e.push(k),a.setStart(k,0)));if(null!==c){for(k=a.endContainer;k.parentNode&&k.parentNode!==c;)k=k.parentNode;f=f?c.childNodes.length:b(k,c);a.setEnd(c,f)}}return e};this.containsRange=e;this.rangesIntersect=k;this.rangeIntersection=function(a,d){var b;k(a,d)&&(b=a.cloneRange(),-1===a.compareBoundaryPoints(Range.START_TO_START,d)&&b.setStart(d.startContainer,d.startOffset),1===a.compareBoundaryPoints(Range.END_TO_END,
d)&&b.setEnd(d.endContainer,d.endOffset));return b};this.getNodesInRange=function(a,d,b){var e=[],c=a.commonAncestorContainer,c=c.nodeType===Node.TEXT_NODE?c.parentNode:c;b=a.startContainer.ownerDocument.createTreeWalker(c,b,d,!1);var f,k;a.endContainer.childNodes[a.endOffset-1]?(f=a.endContainer.childNodes[a.endOffset-1],k=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(f=a.endContainer,k=Node.DOCUMENT_POSITION_PRECEDING);a.startContainer.childNodes[a.startOffset]?(a=a.startContainer.childNodes[a.startOffset],
b.currentNode=a):a.startOffset===(a.startContainer.nodeType===Node.TEXT_NODE?a.startContainer.length:a.startContainer.childNodes.length)?(a=a.startContainer,b.currentNode=a,b.lastChild(),a=b.nextNode()):(a=a.startContainer,b.currentNode=a);if(a){a=b.currentNode;if(a!==c)for(a=a.parentNode;a&&a!==c;)d(a)===NodeFilter.FILTER_REJECT&&(b.currentNode=a),a=a.parentNode;a=b.currentNode;switch(d(a)){case NodeFilter.FILTER_REJECT:for(a=b.nextSibling();!a&&b.parentNode();)a=b.nextSibling();break;case NodeFilter.FILTER_SKIP:a=
b.nextNode()}for(;a;){d=f.compareDocumentPosition(a);if(0!==d&&0===(d&k))break;e.push(a);a=b.nextNode()}}return e};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=f(a,a.nextSibling));a&&a.previousSibling&&f(a.previousSibling,a)};this.rangeContainsNode=function(a,d){var b=d.ownerDocument.createRange(),f=d.ownerDocument.createRange(),k;b.setStart(a.startContainer,a.startOffset);b.setEnd(a.endContainer,a.endOffset);f.selectNodeContents(d);k=e(b,f);b.detach();f.detach();return k};this.mergeIntoParent=
m;this.removeUnwantedNodes=q;this.getElementsByTagNameNS=function(a,d,b){var e=[];a=a.getElementsByTagNameNS(d,b);e.length=b=a.length;for(d=0;d<b;d+=1)e[d]=a.item(d);return e};this.getElementsByTagName=function(a,d){var b=[],e,c,f;e=a.getElementsByTagName(d);b.length=f=e.length;for(c=0;c<f;c+=1)b[c]=e.item(c);return b};this.containsNode=function(a,d){return a===d||a.contains(d)};this.comparePoints=function(a,d,e,c){if(a===e)return c-d;var f=a.compareDocumentPosition(e);2===f?f=-1:4===f?f=1:10===f?
(d=b(a,e),f=d<c?1:-1):(c=b(e,a),f=c<d?-1:1);return f};this.adaptRangeDifferenceToZoomLevel=r;this.translateRect=function(a,d,b){return{top:r(a.top-d.top,b),left:r(a.left-d.left,b),bottom:r(a.bottom-d.top,b),right:r(a.right-d.left,b),width:r(a.width,b),height:r(a.height,b)}};this.getBoundingClientRect=function(d){var h=d.ownerDocument,b=g(),e=h.body;if((!1===b.unscaledRangeClientRects||b.rangeBCRIgnoresElementBCR)&&d.nodeType===Node.ELEMENT_NODE)return d=d.getBoundingClientRect(),b.elementBCRIgnoresBodyScroll?
{left:d.left+e.scrollLeft,right:d.right+e.scrollLeft,top:d.top+e.scrollTop,bottom:d.bottom+e.scrollTop,width:d.width,height:d.height}:d;var c;a?c=a:a=c=h.createRange();b=c;b.selectNode(d);return b.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(a,d,b){Object.keys(d).forEach(function(e){var c=e.split(":"),f=c[1],c=b(c[0]),k=d[e];c?(f=a.getElementsByTagNameNS(c,f)[0],f||(f=a.ownerDocument.createElementNS(c,e),a.appendChild(f)),f.textContent=k):runtime.log("Key ignored: "+e)})};this.removeKeyElementsFromNode=
function(a,d,b){d.forEach(function(d){var h=d.split(":"),e=h[1];(h=b(h[0]))?(e=a.getElementsByTagNameNS(h,e)[0])?e.parentNode.removeChild(e):runtime.log("Element for "+d+" not found."):runtime.log("Property Name ignored: "+d)})};this.getKeyValRepresentationOfNode=function(a,d){for(var b={},e=a.firstElementChild,c;e;){if(c=d(e.namespaceURI))b[c+":"+e.localName]=e.textContent;e=e.nextElementSibling}return b};this.mapObjOntoNode=d;this.getDirectChild=l;(function(a){var d,b;b=runtime.getWindow();null!==
b&&(d=b.navigator.appVersion.toLowerCase(),b=-1===d.indexOf("chrome")&&(-1!==d.indexOf("applewebkit")||-1!==d.indexOf("safari")),d=d.indexOf("msie"),b||d)&&(a.containsNode=p)})(this)}})();core.Cursor=function(g,l){function e(d){d.parentNode&&(m.push(d.previousSibling),m.push(d.nextSibling),d.parentNode.removeChild(d))}function b(d,a,b){if(a.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(a),"putCursorIntoTextNode: invalid container");var h=a.parentNode;runtime.assert(Boolean(h),"putCursorIntoTextNode: container without parent");runtime.assert(0<=b&&b<=a.length,"putCursorIntoTextNode: offset is out of bounds");0===b?h.insertBefore(d,a):(b!==a.length&&a.splitText(b),h.insertBefore(d,
a.nextSibling))}else a.nodeType===Node.ELEMENT_NODE&&a.insertBefore(d,a.childNodes.item(b));m.push(d.previousSibling);m.push(d.nextSibling)}var c=g.createElementNS("urn:webodf:names:cursor","cursor"),k=g.createElementNS("urn:webodf:names:cursor","anchor"),f,m=[],q=g.createRange(),p,r=new core.DomUtils;this.getNode=function(){return c};this.getAnchorNode=function(){return k.parentNode?k:c};this.getSelectedRange=function(){p?(q.setStartBefore(c),q.collapse(!0)):(q.setStartAfter(f?k:c),q.setEndBefore(f?
c:k));return q};this.setSelectedRange=function(d,a){q&&q!==d&&q.detach();q=d;f=!1!==a;(p=d.collapsed)?(e(k),e(c),b(c,d.startContainer,d.startOffset)):(e(k),e(c),b(f?c:k,d.endContainer,d.endOffset),b(f?k:c,d.startContainer,d.startOffset));m.forEach(r.normalizeTextNodes);m.length=0};this.hasForwardSelection=function(){return f};this.remove=function(){e(c);m.forEach(r.normalizeTextNodes);m.length=0};c.setAttributeNS("urn:webodf:names:cursor","memberId",l);k.setAttributeNS("urn:webodf:names:cursor","memberId",
l)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(g){};core.EventNotifier=function(g){function l(b){runtime.assert(!e.hasOwnProperty(b),'Duplicated event ids: "'+b+'" registered more than once.');e[b]=[]}var e={};this.emit=function(b,c){var k,f;runtime.assert(e.hasOwnProperty(b),'unknown event fired "'+b+'"');f=e[b];for(k=0;k<f.length;k+=1)f[k](c)};this.subscribe=function(b,c){runtime.assert(e.hasOwnProperty(b),'tried to subscribe to unknown event "'+b+'"');e[b].push(c)};this.unsubscribe=function(b,c){var k;runtime.assert(e.hasOwnProperty(b),'tried to unsubscribe from unknown event "'+
b+'"');k=e[b].indexOf(c);runtime.assert(-1!==k,'tried to unsubscribe unknown callback from event "'+b+'"');-1!==k&&e[b].splice(k,1)};this.register=l;g&&g.forEach(l)};core.LazyProperty=function(g){var l,e=!1;this.value=function(){e||(l=g(),e=!0);return l};this.reset=function(){e=!1}};core.LoopWatchDog=function(g,l){var e=Date.now(),b=0;this.check=function(){var c;if(g&&(c=Date.now(),c-e>g))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<l&&(b+=1,b>l))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};core.PositionIterator=function(g,l,e,b){function c(){this.acceptNode=function(a){return!a||a.nodeType===n&&0===a.length?w:x}}function k(a){this.acceptNode=function(d){return!d||d.nodeType===n&&0===d.length?w:a.acceptNode(d)}}function f(){var a=r.currentNode,b=a.nodeType;d=b===n?a.length-1:b===h?1:0}function m(){if(null===r.previousSibling()){if(!r.parentNode()||r.currentNode===g)return r.firstChild(),!1;d=0}else f();return!0}function q(){var b=r.currentNode,h;h=a(b);if(b!==g)for(b=b.parentNode;b&&
b!==g;)a(b)===w&&(r.currentNode=b,h=w),b=b.parentNode;h===w?(d=1,b=p.nextPosition()):b=h===x?!0:p.nextPosition();b&&runtime.assert(a(r.currentNode)===x,"moveToAcceptedNode did not result in walker being on an accepted node");return b}var p=this,r,d,a,n=Node.TEXT_NODE,h=Node.ELEMENT_NODE,x=NodeFilter.FILTER_ACCEPT,w=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var a=r.currentNode,b=a.nodeType;if(a===g)return!1;if(0===d&&b===h)null===r.firstChild()&&(d=1);else if(b===n&&d+1<a.length)d+=1;else if(null!==
r.nextSibling())d=0;else if(r.parentNode())d=1;else return!1;return!0};this.previousPosition=function(){var a=!0,b=r.currentNode;0===d?a=m():b.nodeType===n?d-=1:null!==r.lastChild()?f():b===g?a=!1:d=0;return a};this.previousNode=m;this.container=function(){var a=r.currentNode,b=a.nodeType;0===d&&b!==n&&(a=a.parentNode);return a};this.rightNode=function(){var b=r.currentNode,e=b.nodeType;if(e===n&&d===b.length)for(b=b.nextSibling;b&&a(b)!==x;)b=b.nextSibling;else e===h&&1===d&&(b=null);return b};this.leftNode=
function(){var b=r.currentNode;if(0===d)for(b=b.previousSibling;b&&a(b)!==x;)b=b.previousSibling;else if(b.nodeType===h)for(b=b.lastChild;b&&a(b)!==x;)b=b.previousSibling;return b};this.getCurrentNode=function(){return r.currentNode};this.unfilteredDomOffset=function(){if(r.currentNode.nodeType===n)return d;for(var a=0,b=r.currentNode,b=1===d?b.lastChild:b.previousSibling;b;)a+=1,b=b.previousSibling;return a};this.getPreviousSibling=function(){var a=r.currentNode,d=r.previousSibling();r.currentNode=
a;return d};this.getNextSibling=function(){var a=r.currentNode,d=r.nextSibling();r.currentNode=a;return d};this.setPositionBeforeElement=function(a){runtime.assert(Boolean(a),"setPositionBeforeElement called without element");r.currentNode=a;d=0;return q()};this.setUnfilteredPosition=function(a,b){runtime.assert(Boolean(a),"PositionIterator.setUnfilteredPosition called without container");r.currentNode=a;if(a.nodeType===n)return d=b,runtime.assert(b<=a.length,"Error in setPosition: "+b+" > "+a.length),
runtime.assert(0<=b,"Error in setPosition: "+b+" < 0"),b===a.length&&(r.nextSibling()?d=0:r.parentNode()?d=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid.")),!0;b<a.childNodes.length?(r.currentNode=a.childNodes.item(b),d=0):d=1;return q()};this.moveToEnd=function(){r.currentNode=g;d=1};this.moveToEndOfNode=function(a){a.nodeType===n?p.setUnfilteredPosition(a,a.length):(r.currentNode=a,d=1)};this.isBeforeNode=function(){return 0===d};this.getNodeFilter=function(){return a};
a=(e?new k(e):new c).acceptNode;a.acceptNode=a;l=l||NodeFilter.SHOW_ALL;runtime.assert(g.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");r=g.ownerDocument.createTreeWalker(g,l,a,b);d=0;null===r.firstChild()&&(d=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(g){};core.PositionFilterChain=function(){var g=[],l=core.PositionFilter.FilterResult.FILTER_ACCEPT,e=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(b){var c;for(c=0;c<g.length;c+=1)if(g[c].acceptPosition(b)===e)return e;return l};this.addFilter=function(b){g.push(b)}};(function(){core.RawInflate=function(){var g;(function(l){g=l()})(function(){return function e(b,c,k){function f(g,m){if(!c[g]){if(!b[g])throw Error("Cannot find module '"+g+"'");var r=c[g]={exports:{}};b[g][0].call(r.exports,function(d){var a=b[g][1][d];return f(a?a:d)},r,r.exports,e,b,c,k)}return c[g].exports}for(var g=0;g<k.length;g++)f(k[g]);return f}({1:[function(e,b,c){function k(a,d){var b=new n(d);b.push(a,!0);if(b.err)throw b.msg;return b.result}var f=e("./zlib/inflate.js"),g=e("./utils/common"),
q=e("./utils/strings"),p=e("./zlib/constants"),r=e("./zlib/messages"),d=e("./zlib/zstream"),a=e("./zlib/gzheader"),n=function(b){var e=this.options=g.assign({chunkSize:16384,windowBits:0,to:""},b||{});e.raw&&0<=e.windowBits&&16>e.windowBits&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15));!(0<=e.windowBits&&16>e.windowBits)||b&&b.windowBits||(e.windowBits+=32);15<e.windowBits&&48>e.windowBits&&0===(e.windowBits&15)&&(e.windowBits|=15);this.err=0;this.msg="";this.ended=!1;this.chunks=
[];this.strm=new d;this.strm.avail_out=0;b=f.inflateInit2(this.strm,e.windowBits);if(b!==p.Z_OK)throw Error(r[b]);this.header=new a;f.inflateGetHeader(this.strm,this.header)};n.prototype.push=function(a,d){var b=this.strm,e=this.options.chunkSize,n,c,k,r,H;if(this.ended)return!1;c=d===~~d?d:!0===d?p.Z_FINISH:p.Z_NO_FLUSH;b.input="string"===typeof a?q.binstring2buf(a):a;b.next_in=0;b.avail_in=b.input.length;do{0===b.avail_out&&(b.output=new g.Buf8(e),b.next_out=0,b.avail_out=e);n=f.inflate(b,p.Z_NO_FLUSH);
if(n!==p.Z_STREAM_END&&n!==p.Z_OK)return this.onEnd(n),this.ended=!0,!1;if(b.next_out&&(0===b.avail_out||n===p.Z_STREAM_END||0===b.avail_in&&c===p.Z_FINISH))if("string"===this.options.to)k=q.utf8border(b.output,b.next_out),r=b.next_out-k,H=q.buf2string(b.output,k),b.next_out=r,b.avail_out=e-r,r&&g.arraySet(b.output,b.output,k,r,0),this.onData(H);else this.onData(g.shrinkBuf(b.output,b.next_out))}while((0<b.avail_in||0===b.avail_out)&&n!==p.Z_STREAM_END);n===p.Z_STREAM_END&&(c=p.Z_FINISH);return c===
p.Z_FINISH?(n=f.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===p.Z_OK):!0};n.prototype.onData=function(a){this.chunks.push(a)};n.prototype.onEnd=function(a){a===p.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):g.flattenChunks(this.chunks));this.chunks=[];this.err=a;this.msg=this.strm.msg};c.Inflate=n;c.inflate=k;c.inflateRaw=function(a,d){d=d||{};d.raw=!0;return k(a,d)};c.ungzip=k},{"./utils/common":2,"./utils/strings":3,"./zlib/constants":5,"./zlib/gzheader":7,"./zlib/inflate.js":9,
"./zlib/messages":11,"./zlib/zstream":12}],2:[function(e,b,c){e="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Int32Array;c.assign=function(b){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var c=e.shift();if(c){if("object"!==typeof c)throw new TypeError(c+"must be non-object");for(var f in c)c.hasOwnProperty(f)&&(b[f]=c[f])}}return b};c.shrinkBuf=function(b,e){if(b.length===e)return b;if(b.subarray)return b.subarray(0,e);b.length=e;return b};
var k={arraySet:function(b,e,c,f,d){if(e.subarray&&b.subarray)b.set(e.subarray(c,c+f),d);else for(var a=0;a<f;a++)b[d+a]=e[c+a]},flattenChunks:function(b){var e,c,f,d,a;e=f=0;for(c=b.length;e<c;e++)f+=b[e].length;a=new Uint8Array(f);e=f=0;for(c=b.length;e<c;e++)d=b[e],a.set(d,f),f+=d.length;return a}},f={arraySet:function(b,e,c,f,d){for(var a=0;a<f;a++)b[d+a]=e[c+a]},flattenChunks:function(b){return[].concat.apply([],b)}};c.setTyped=function(b){b?(c.Buf8=Uint8Array,c.Buf16=Uint16Array,c.Buf32=Int32Array,
c.assign(c,k)):(c.Buf8=Array,c.Buf16=Array,c.Buf32=Array,c.assign(c,f))};c.setTyped(e)},{}],3:[function(e,b,c){function k(a,d){if(65537>d&&(a.subarray&&q||!a.subarray&&g))return String.fromCharCode.apply(null,f.shrinkBuf(a,d));for(var b="",e=0;e<d;e++)b+=String.fromCharCode(a[e]);return b}var f=e("./common"),g=!0,q=!0;try{String.fromCharCode.apply(null,[0])}catch(p){g=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(r){q=!1}var d=new f.Buf8(256);for(e=0;256>e;e++)d[e]=252<=e?6:248<=
e?5:240<=e?4:224<=e?3:192<=e?2:1;d[254]=d[254]=1;c.string2buf=function(a){var d,b,e,c,k,g=a.length,r=0;for(c=0;c<g;c++)b=a.charCodeAt(c),55296===(b&64512)&&c+1<g&&(e=a.charCodeAt(c+1),56320===(e&64512)&&(b=65536+(b-55296<<10)+(e-56320),c++)),r+=128>b?1:2048>b?2:65536>b?3:4;d=new f.Buf8(r);for(c=k=0;k<r;c++)b=a.charCodeAt(c),55296===(b&64512)&&c+1<g&&(e=a.charCodeAt(c+1),56320===(e&64512)&&(b=65536+(b-55296<<10)+(e-56320),c++)),128>b?d[k++]=b:(2048>b?d[k++]=192|b>>>6:(65536>b?d[k++]=224|b>>>12:(d[k++]=
240|b>>>18,d[k++]=128|b>>>12&63),d[k++]=128|b>>>6&63),d[k++]=128|b&63);return d};c.buf2binstring=function(a){return k(a,a.length)};c.binstring2buf=function(a){for(var d=new f.Buf8(a.length),b=0,e=d.length;b<e;b++)d[b]=a.charCodeAt(b);return d};c.buf2string=function(a,b){var e,c,f,g,r=b||a.length,m=Array(2*r);for(e=c=0;e<r;)if(f=a[e++],128>f)m[c++]=f;else if(g=d[f],4<g)m[c++]=65533,e+=g-1;else{for(f&=2===g?31:3===g?15:7;1<g&&e<r;)f=f<<6|a[e++]&63,g--;1<g?m[c++]=65533:65536>f?m[c++]=f:(f-=65536,m[c++]=
55296|f>>10&1023,m[c++]=56320|f&1023)}return k(m,c)};c.utf8border=function(a,b){var e;b=b||a.length;b>a.length&&(b=a.length);for(e=b-1;0<=e&&128===(a[e]&192);)e--;return 0>e||0===e?b:e+d[a[e]]>b?e:b}},{"./common":2}],4:[function(e,b,c){b.exports=function(b,e,c,g){var p=b&65535|0;b=b>>>16&65535|0;for(var r=0;0!==c;){r=2E3<c?2E3:c;c-=r;do p=p+e[g++]|0,b=b+p|0;while(--r);p%=65521;b%=65521}return p|b<<16|0}},{}],5:[function(e,b,c){b.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,
Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],6:[function(e,b,c){var k=function(){for(var b,e=[],c=0;256>c;c++){b=c;for(var k=0;8>k;k++)b=b&1?3988292384^b>>>1:b>>>1;e[c]=b}return e}();b.exports=function(b,e,c,g){c=g+c;for(b^=
-1;g<c;g++)b=b>>>8^k[(b^e[g])&255];return b^-1}},{}],7:[function(e,b,c){b.exports=function(){this.os=this.xflags=this.time=this.text=0;this.extra=null;this.extra_len=0;this.comment=this.name="";this.hcrc=0;this.done=!1}},{}],8:[function(e,b,c){b.exports=function(b,e){var c,g,p,r,d,a,n,h,x,w,y,u,s,z,v,H,J,E,F,D,L,V,Y,G;c=b.state;g=b.next_in;Y=b.input;p=g+(b.avail_in-5);r=b.next_out;G=b.output;d=r-(e-b.avail_out);a=r+(b.avail_out-257);n=c.dmax;h=c.wsize;x=c.whave;w=c.wnext;y=c.window;u=c.hold;s=c.bits;
z=c.lencode;v=c.distcode;H=(1<<c.lenbits)-1;J=(1<<c.distbits)-1;a:do b:for(15>s&&(u+=Y[g++]<<s,s+=8,u+=Y[g++]<<s,s+=8),E=z[u&H];;){F=E>>>24;u>>>=F;s-=F;F=E>>>16&255;if(0===F)G[r++]=E&65535;else if(F&16){D=E&65535;if(F&=15)s<F&&(u+=Y[g++]<<s,s+=8),D+=u&(1<<F)-1,u>>>=F,s-=F;15>s&&(u+=Y[g++]<<s,s+=8,u+=Y[g++]<<s,s+=8);E=v[u&J];c:for(;;){F=E>>>24;u>>>=F;s-=F;F=E>>>16&255;if(F&16){E&=65535;F&=15;s<F&&(u+=Y[g++]<<s,s+=8,s<F&&(u+=Y[g++]<<s,s+=8));E+=u&(1<<F)-1;if(E>n){b.msg="invalid distance too far back";
c.mode=30;break a}u>>>=F;s-=F;F=r-d;if(E>F){F=E-F;if(F>x&&c.sane){b.msg="invalid distance too far back";c.mode=30;break a}L=0;V=y;if(0===w){if(L+=h-F,F<D){D-=F;do G[r++]=y[L++];while(--F);L=r-E;V=G}}else if(w<F){if(L+=h+w-F,F-=w,F<D){D-=F;do G[r++]=y[L++];while(--F);L=0;if(w<D){F=w;D-=F;do G[r++]=y[L++];while(--F);L=r-E;V=G}}}else if(L+=w-F,F<D){D-=F;do G[r++]=y[L++];while(--F);L=r-E;V=G}for(;2<D;)G[r++]=V[L++],G[r++]=V[L++],G[r++]=V[L++],D-=3;D&&(G[r++]=V[L++],1<D&&(G[r++]=V[L++]))}else{L=r-E;do G[r++]=
G[L++],G[r++]=G[L++],G[r++]=G[L++],D-=3;while(2<D);D&&(G[r++]=G[L++],1<D&&(G[r++]=G[L++]))}}else if(0===(F&64)){E=v[(E&65535)+(u&(1<<F)-1)];continue c}else{b.msg="invalid distance code";c.mode=30;break a}break}}else if(0===(F&64)){E=z[(E&65535)+(u&(1<<F)-1)];continue b}else{F&32?c.mode=12:(b.msg="invalid literal/length code",c.mode=30);break a}break}while(g<p&&r<a);D=s>>3;g-=D;s-=D<<3;b.next_in=g;b.next_out=r;b.avail_in=g<p?5+(p-g):5-(g-p);b.avail_out=r<a?257+(a-r):257-(r-a);c.hold=u&(1<<s)-1;c.bits=
s}},{}],9:[function(e,b,c){function g(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function f(){this.mode=0;this.last=!1;this.wrap=0;this.havedict=!1;this.total=this.check=this.dmax=this.flags=0;this.head=null;this.wnext=this.whave=this.wsize=this.wbits=0;this.window=null;this.extra=this.offset=this.length=this.bits=this.hold=0;this.distcode=this.lencode=null;this.have=this.ndist=this.nlen=this.ncode=this.distbits=this.lenbits=0;this.next=null;this.lens=new d.Buf16(320);this.work=
new d.Buf16(288);this.distdyn=this.lendyn=null;this.was=this.back=this.sane=0}function m(a){var b;if(!a||!a.state)return y;b=a.state;a.total_in=a.total_out=b.total=0;a.msg="";b.wrap&&(a.adler=b.wrap&1);b.mode=u;b.last=0;b.havedict=0;b.dmax=32768;b.head=null;b.hold=0;b.bits=0;b.lencode=b.lendyn=new d.Buf32(s);b.distcode=b.distdyn=new d.Buf32(z);b.sane=1;b.back=-1;return w}function q(a){var d;if(!a||!a.state)return y;d=a.state;d.wsize=0;d.whave=0;d.wnext=0;return m(a)}function p(a,d){var b,e;if(!a||
!a.state)return y;e=a.state;0>d?(b=0,d=-d):(b=(d>>4)+1,48>d&&(d&=15));if(d&&(8>d||15<d))return y;null!==e.window&&e.wbits!==d&&(e.window=null);e.wrap=b;e.wbits=d;return q(a)}function r(a,d){var b;if(!a)return y;b=new f;a.state=b;b.window=null;b=p(a,d);b!==w&&(a.state=null);return b}var d=e("../utils/common"),a=e("./adler32"),n=e("./crc32"),h=e("./inffast"),x=e("./inftrees"),w=0,y=-2,u=1,s=852,z=592,v=!0,H,J;c.inflateReset=q;c.inflateReset2=p;c.inflateResetKeep=m;c.inflateInit=function(a){return r(a,
15)};c.inflateInit2=r;c.inflate=function(b,e){var c,f,r,m,p,q,s,t,B,z,W,C,I,Q;C=0;var A,P,O,X,K,S=new d.Buf8(4),ba=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!b||!b.state||!b.output||!b.input&&0!==b.avail_in)return y;c=b.state;12===c.mode&&(c.mode=13);p=b.next_out;r=b.output;s=b.avail_out;m=b.next_in;f=b.input;q=b.avail_in;t=c.hold;B=c.bits;z=q;W=s;K=w;a:for(;;)switch(c.mode){case u:if(0===c.wrap){c.mode=13;break}for(;16>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}if(c.wrap&2&&35615===t){c.check=
0;S[0]=t&255;S[1]=t>>>8&255;c.check=n(c.check,S,2,0);B=t=0;c.mode=2;break}c.flags=0;c.head&&(c.head.done=!1);if(!(c.wrap&1)||(((t&255)<<8)+(t>>8))%31){b.msg="incorrect header check";c.mode=30;break}if(8!==(t&15)){b.msg="unknown compression method";c.mode=30;break}t>>>=4;B-=4;I=(t&15)+8;if(0===c.wbits)c.wbits=I;else if(I>c.wbits){b.msg="invalid window size";c.mode=30;break}c.dmax=1<<I;b.adler=c.check=1;c.mode=t&512?10:12;B=t=0;break;case 2:for(;16>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.flags=
t;if(8!==(c.flags&255)){b.msg="unknown compression method";c.mode=30;break}if(c.flags&57344){b.msg="unknown header flags set";c.mode=30;break}c.head&&(c.head.text=t>>8&1);c.flags&512&&(S[0]=t&255,S[1]=t>>>8&255,c.check=n(c.check,S,2,0));B=t=0;c.mode=3;case 3:for(;32>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.head&&(c.head.time=t);c.flags&512&&(S[0]=t&255,S[1]=t>>>8&255,S[2]=t>>>16&255,S[3]=t>>>24&255,c.check=n(c.check,S,4,0));B=t=0;c.mode=4;case 4:for(;16>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=
8}c.head&&(c.head.xflags=t&255,c.head.os=t>>8);c.flags&512&&(S[0]=t&255,S[1]=t>>>8&255,c.check=n(c.check,S,2,0));B=t=0;c.mode=5;case 5:if(c.flags&1024){for(;16>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.length=t;c.head&&(c.head.extra_len=t);c.flags&512&&(S[0]=t&255,S[1]=t>>>8&255,c.check=n(c.check,S,2,0));B=t=0}else c.head&&(c.head.extra=null);c.mode=6;case 6:if(c.flags&1024&&(C=c.length,C>q&&(C=q),C&&(c.head&&(I=c.head.extra_len-c.length,c.head.extra||(c.head.extra=Array(c.head.extra_len)),d.arraySet(c.head.extra,
f,m,C,I)),c.flags&512&&(c.check=n(c.check,f,C,m)),q-=C,m+=C,c.length-=C),c.length))break a;c.length=0;c.mode=7;case 7:if(c.flags&2048){if(0===q)break a;C=0;do I=f[m+C++],c.head&&I&&65536>c.length&&(c.head.name+=String.fromCharCode(I));while(I&&C<q);c.flags&512&&(c.check=n(c.check,f,C,m));q-=C;m+=C;if(I)break a}else c.head&&(c.head.name=null);c.length=0;c.mode=8;case 8:if(c.flags&4096){if(0===q)break a;C=0;do I=f[m+C++],c.head&&I&&65536>c.length&&(c.head.comment+=String.fromCharCode(I));while(I&&C<
q);c.flags&512&&(c.check=n(c.check,f,C,m));q-=C;m+=C;if(I)break a}else c.head&&(c.head.comment=null);c.mode=9;case 9:if(c.flags&512){for(;16>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}if(t!==(c.check&65535)){b.msg="header crc mismatch";c.mode=30;break}B=t=0}c.head&&(c.head.hcrc=c.flags>>9&1,c.head.done=!0);b.adler=c.check=0;c.mode=12;break;case 10:for(;32>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}b.adler=c.check=g(t);B=t=0;c.mode=11;case 11:if(0===c.havedict)return b.next_out=p,b.avail_out=s,b.next_in=
m,b.avail_in=q,c.hold=t,c.bits=B,2;b.adler=c.check=1;c.mode=12;case 12:if(5===e||6===e)break a;case 13:if(c.last){t>>>=B&7;B-=B&7;c.mode=27;break}for(;3>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.last=t&1;t>>>=1;B-=1;switch(t&3){case 0:c.mode=14;break;case 1:C=c;if(v){I=void 0;H=new d.Buf32(512);J=new d.Buf32(32);for(I=0;144>I;)C.lens[I++]=8;for(;256>I;)C.lens[I++]=9;for(;280>I;)C.lens[I++]=7;for(;288>I;)C.lens[I++]=8;x(1,C.lens,0,288,H,0,C.work,{bits:9});for(I=0;32>I;)C.lens[I++]=5;x(2,C.lens,
0,32,J,0,C.work,{bits:5});v=!1}C.lencode=H;C.lenbits=9;C.distcode=J;C.distbits=5;c.mode=20;if(6===e){t>>>=2;B-=2;break a}break;case 2:c.mode=17;break;case 3:b.msg="invalid block type",c.mode=30}t>>>=2;B-=2;break;case 14:t>>>=B&7;for(B-=B&7;32>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}if((t&65535)!==(t>>>16^65535)){b.msg="invalid stored block lengths";c.mode=30;break}c.length=t&65535;B=t=0;c.mode=15;if(6===e)break a;case 15:c.mode=16;case 16:if(C=c.length){C>q&&(C=q);C>s&&(C=s);if(0===C)break a;d.arraySet(r,
f,m,C,p);q-=C;m+=C;s-=C;p+=C;c.length-=C;break}c.mode=12;break;case 17:for(;14>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.nlen=(t&31)+257;t>>>=5;B-=5;c.ndist=(t&31)+1;t>>>=5;B-=5;c.ncode=(t&15)+4;t>>>=4;B-=4;if(286<c.nlen||30<c.ndist){b.msg="too many length or distance symbols";c.mode=30;break}c.have=0;c.mode=18;case 18:for(;c.have<c.ncode;){for(;3>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.lens[ba[c.have++]]=t&7;t>>>=3;B-=3}for(;19>c.have;)c.lens[ba[c.have++]]=0;c.lencode=c.lendyn;c.lenbits=
7;C={bits:c.lenbits};K=x(0,c.lens,0,19,c.lencode,0,c.work,C);c.lenbits=C.bits;if(K){b.msg="invalid code lengths set";c.mode=30;break}c.have=0;c.mode=19;case 19:for(;c.have<c.nlen+c.ndist;){for(;;){C=c.lencode[t&(1<<c.lenbits)-1];A=C>>>24;P=C>>>16&255;O=C&65535;if(A<=B)break;if(0===q)break a;q--;t+=f[m++]<<B;B+=8}if(16>O)t>>>=A,B-=A,c.lens[c.have++]=O;else{if(16===O){for(C=A+2;B<C;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}t>>>=A;B-=A;if(0===c.have){b.msg="invalid bit length repeat";c.mode=30;break}I=
c.lens[c.have-1];C=3+(t&3);t>>>=2;B-=2}else if(17===O){for(C=A+3;B<C;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}t>>>=A;B-=A;I=0;C=3+(t&7);t>>>=3;B-=3}else{for(C=A+7;B<C;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}t>>>=A;B-=A;I=0;C=11+(t&127);t>>>=7;B-=7}if(c.have+C>c.nlen+c.ndist){b.msg="invalid bit length repeat";c.mode=30;break}for(;C--;)c.lens[c.have++]=I}}if(30===c.mode)break;if(0===c.lens[256]){b.msg="invalid code -- missing end-of-block";c.mode=30;break}c.lenbits=9;C={bits:c.lenbits};K=x(1,c.lens,
0,c.nlen,c.lencode,0,c.work,C);c.lenbits=C.bits;if(K){b.msg="invalid literal/lengths set";c.mode=30;break}c.distbits=6;c.distcode=c.distdyn;C={bits:c.distbits};K=x(2,c.lens,c.nlen,c.ndist,c.distcode,0,c.work,C);c.distbits=C.bits;if(K){b.msg="invalid distances set";c.mode=30;break}c.mode=20;if(6===e)break a;case 20:c.mode=21;case 21:if(6<=q&&258<=s){b.next_out=p;b.avail_out=s;b.next_in=m;b.avail_in=q;c.hold=t;c.bits=B;h(b,W);p=b.next_out;r=b.output;s=b.avail_out;m=b.next_in;f=b.input;q=b.avail_in;
t=c.hold;B=c.bits;12===c.mode&&(c.back=-1);break}for(c.back=0;;){C=c.lencode[t&(1<<c.lenbits)-1];A=C>>>24;P=C>>>16&255;O=C&65535;if(A<=B)break;if(0===q)break a;q--;t+=f[m++]<<B;B+=8}if(P&&0===(P&240)){I=A;Q=P;for(X=O;;){C=c.lencode[X+((t&(1<<I+Q)-1)>>I)];A=C>>>24;P=C>>>16&255;O=C&65535;if(I+A<=B)break;if(0===q)break a;q--;t+=f[m++]<<B;B+=8}t>>>=I;B-=I;c.back+=I}t>>>=A;B-=A;c.back+=A;c.length=O;if(0===P){c.mode=26;break}if(P&32){c.back=-1;c.mode=12;break}if(P&64){b.msg="invalid literal/length code";
c.mode=30;break}c.extra=P&15;c.mode=22;case 22:if(c.extra){for(C=c.extra;B<C;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.length+=t&(1<<c.extra)-1;t>>>=c.extra;B-=c.extra;c.back+=c.extra}c.was=c.length;c.mode=23;case 23:for(;;){C=c.distcode[t&(1<<c.distbits)-1];A=C>>>24;P=C>>>16&255;O=C&65535;if(A<=B)break;if(0===q)break a;q--;t+=f[m++]<<B;B+=8}if(0===(P&240)){I=A;Q=P;for(X=O;;){C=c.distcode[X+((t&(1<<I+Q)-1)>>I)];A=C>>>24;P=C>>>16&255;O=C&65535;if(I+A<=B)break;if(0===q)break a;q--;t+=f[m++]<<B;B+=
8}t>>>=I;B-=I;c.back+=I}t>>>=A;B-=A;c.back+=A;if(P&64){b.msg="invalid distance code";c.mode=30;break}c.offset=O;c.extra=P&15;c.mode=24;case 24:if(c.extra){for(C=c.extra;B<C;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}c.offset+=t&(1<<c.extra)-1;t>>>=c.extra;B-=c.extra;c.back+=c.extra}if(c.offset>c.dmax){b.msg="invalid distance too far back";c.mode=30;break}c.mode=25;case 25:if(0===s)break a;C=W-s;if(c.offset>C){C=c.offset-C;if(C>c.whave&&c.sane){b.msg="invalid distance too far back";c.mode=30;break}C>
c.wnext?(C-=c.wnext,I=c.wsize-C):I=c.wnext-C;C>c.length&&(C=c.length);Q=c.window}else Q=r,I=p-c.offset,C=c.length;C>s&&(C=s);s-=C;c.length-=C;do r[p++]=Q[I++];while(--C);0===c.length&&(c.mode=21);break;case 26:if(0===s)break a;r[p++]=c.length;s--;c.mode=21;break;case 27:if(c.wrap){for(;32>B;){if(0===q)break a;q--;t|=f[m++]<<B;B+=8}W-=s;b.total_out+=W;c.total+=W;W&&(b.adler=c.check=c.flags?n(c.check,r,W,p-W):a(c.check,r,W,p-W));W=s;if((c.flags?t:g(t))!==c.check){b.msg="incorrect data check";c.mode=
30;break}B=t=0}c.mode=28;case 28:if(c.wrap&&c.flags){for(;32>B;){if(0===q)break a;q--;t+=f[m++]<<B;B+=8}if(t!==(c.total&4294967295)){b.msg="incorrect length check";c.mode=30;break}B=t=0}c.mode=29;case 29:K=1;break a;case 30:K=-3;break a;case 31:return-4;default:return y}b.next_out=p;b.avail_out=s;b.next_in=m;b.avail_in=q;c.hold=t;c.bits=B;if(c.wsize||W!==b.avail_out&&30>c.mode&&(27>c.mode||4!==e))f=b.output,m=b.next_out,p=W-b.avail_out,s=b.state,null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=
0,s.window=new d.Buf8(s.wsize)),p>=s.wsize?(d.arraySet(s.window,f,m-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(q=s.wsize-s.wnext,q>p&&(q=p),d.arraySet(s.window,f,m-p,q,s.wnext),(p-=q)?(d.arraySet(s.window,f,m-p,p,0),s.wnext=p,s.whave=s.wsize):(s.wnext+=q,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=q)));z-=b.avail_in;W-=b.avail_out;b.total_in+=z;b.total_out+=W;c.total+=W;c.wrap&&W&&(b.adler=c.check=c.flags?n(c.check,r,W,b.next_out-W):a(c.check,r,W,b.next_out-W));b.data_type=c.bits+
(c.last?64:0)+(12===c.mode?128:0)+(20===c.mode||15===c.mode?256:0);(0===z&&0===W||4===e)&&K===w&&(K=-5);return K};c.inflateEnd=function(a){if(!a||!a.state)return y;var b=a.state;b.window&&(b.window=null);a.state=null;return w};c.inflateGetHeader=function(a,b){var d;if(!a||!a.state)return y;d=a.state;if(0===(d.wrap&2))return y;d.head=b;b.done=!1;return w};c.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":2,"./adler32":4,"./crc32":6,"./inffast":8,"./inftrees":10}],10:[function(e,
b,c){var g=e("../utils/common"),f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],m=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],q=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];b.exports=function(b,d,a,c,e,x,w,y){for(var u=y.bits,s=0,z=
0,v=0,H=0,J=0,E=0,F=0,D=0,L=0,V=0,Y,G,aa=null,T=0,t,B=new g.Buf16(16),E=new g.Buf16(16),ea=null,W=0,C,I,Q,s=0;15>=s;s++)B[s]=0;for(z=0;z<c;z++)B[d[a+z]]++;J=u;for(H=15;1<=H&&0===B[H];H--);J>H&&(J=H);if(0===H)return e[x++]=20971520,e[x++]=20971520,y.bits=1,0;for(v=1;v<H&&0===B[v];v++);J<v&&(J=v);for(s=D=1;15>=s;s++)if(D<<=1,D-=B[s],0>D)return-1;if(0<D&&(0===b||1!==H))return-1;E[1]=0;for(s=1;15>s;s++)E[s+1]=E[s]+B[s];for(z=0;z<c;z++)0!==d[a+z]&&(w[E[d[a+z]]++]=z);switch(b){case 0:aa=ea=w;t=19;break;
case 1:aa=f;T-=257;ea=m;W-=257;t=256;break;default:aa=q,ea=p,t=-1}z=V=0;s=v;u=x;E=J;F=0;G=-1;L=1<<J;c=L-1;if(1===b&&852<L||2===b&&592<L)return 1;for(var A=0;;){A++;C=s-F;w[z]<t?(I=0,Q=w[z]):w[z]>t?(I=ea[W+w[z]],Q=aa[T+w[z]]):(I=96,Q=0);D=1<<s-F;v=Y=1<<E;do Y-=D,e[u+(V>>F)+Y]=C<<24|I<<16|Q|0;while(0!==Y);for(D=1<<s-1;V&D;)D>>=1;0!==D?(V&=D-1,V+=D):V=0;z++;if(0===--B[s]){if(s===H)break;s=d[a+w[z]]}if(s>J&&(V&c)!==G){0===F&&(F=J);u+=v;E=s-F;for(D=1<<E;E+F<H;){D-=B[E+F];if(0>=D)break;E++;D<<=1}L+=1<<
E;if(1===b&&852<L||2===b&&592<L)return 1;G=V&c;e[G]=J<<24|E<<16|u-x|0}}0!==V&&(e[u+V]=s-F<<24|4194304);y.bits=J;return 0}},{"../utils/common":2}],11:[function(e,b,c){b.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],12:[function(e,b,c){b.exports=function(){this.input=null;this.total_in=this.avail_in=this.next_in=0;this.output=null;this.total_out=this.avail_out=
this.next_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}},{}]},{},[1])(1)});return{inflate:function(l,e){return g.inflateRaw(l)}}}()})();core.ScheduledTask=function(g,l,e){function b(){f&&(e(k),f=!1)}function c(){b();g.apply(void 0,m);m=null}var k,f=!1,m=[],q=!1;this.trigger=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");m=Array.prototype.slice.call(arguments);f||(f=!0,k=l(c))};this.triggerImmediate=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");m=Array.prototype.slice.call(arguments);c()};this.processRequests=function(){f&&c()};this.cancel=b;this.destroy=function(c){b();
q=!0;c()}};core.StepDirection={PREVIOUS:1,NEXT:2};core.StepIterator=function(g,l){function e(){r=null;a=d=void 0}function b(){void 0===a&&(a=g.acceptPosition(l)===p);return a}function c(a,b){e();return l.setUnfilteredPosition(a,b)}function k(){r||(r=l.container());return r}function f(){void 0===d&&(d=l.unfilteredDomOffset());return d}function m(){for(e();l.nextPosition();)if(e(),b())return!0;return!1}function q(){for(e();l.previousPosition();)if(e(),b())return!0;return!1}var p=core.PositionFilter.FilterResult.FILTER_ACCEPT,r,d,a;this.isStep=b;this.setPosition=
c;this.container=k;this.offset=f;this.nextStep=m;this.previousStep=q;this.advanceStep=function(a){return a===core.StepDirection.NEXT?m():q()};this.roundToClosestStep=function(){var a,d,e=b();e||(a=k(),d=f(),e=q(),e||(c(a,d),e=m()));return e};this.roundToPreviousStep=function(){var a=b();a||(a=q());return a};this.roundToNextStep=function(){var a=b();a||(a=m());return a};this.leftNode=function(){return l.leftNode()}};(function(){var g;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||g.performRedraw()};core.Task.createRedrawTask=function(l){return new core.ScheduledTask(l,g.requestRedrawTask,g.cancelRedrawTask)};core.Task.createTimeoutTask=function(g,e){return new core.ScheduledTask(g,function(b){return runtime.setTimeout(b,e)},runtime.clearTimeout)};g=new function(){var g={};this.requestRedrawTask=function(e){var b=runtime.requestAnimationFrame(function(){e();
delete g[b]});g[b]=e;return b};this.performRedraw=function(){Object.keys(g).forEach(function(e){g[e]();runtime.cancelAnimationFrame(parseInt(e,10))});g={}};this.cancelRedrawTask=function(e){runtime.cancelAnimationFrame(e);delete g[e]}}})();core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};
core.UnitTest.provideTestAreaDiv=function(){var g=runtime.getWindow().document,l=g.getElementById("testarea");runtime.assert(!l,'Unclean test environment, found a div with id "testarea".');l=g.createElement("div");l.setAttribute("id","testarea");g.body.appendChild(l);return l};
core.UnitTest.cleanupTestAreaDiv=function(){var g=runtime.getWindow().document,l=g.getElementById("testarea");runtime.assert(!!l&&l.parentNode===g.body,'Test environment broken, found no div with id "testarea" below body.');g.body.removeChild(l)};core.UnitTest.createXmlDocument=function(g,l,e){var b="<?xml version='1.0' encoding='UTF-8'?>",b=b+("<"+g);Object.keys(e).forEach(function(c){b+=" xmlns:"+c+'="'+e[c]+'"'});b+=">";b+=l;b+="</"+g+">";return runtime.parseXML(b)};
core.UnitTest.createOdtDocument=function(g,l){return core.UnitTest.createXmlDocument("office:document",g,l)};
core.UnitTestLogger=function(){var g=[],l=0,e=0,b="",c="";this.startTest=function(k,f){g=[];l=0;b=k;c=f;e=Date.now()};this.endTest=function(){var k=Date.now();return{description:c,suite:[b,c],success:0===l,log:g,time:k-e}};this.debug=function(b){g.push({category:"debug",message:b})};this.fail=function(b){l+=1;g.push({category:"fail",message:b})};this.pass=function(b){g.push({category:"pass",message:b})}};
core.UnitTestRunner=function(g,l){function e(a){q+=1;d?l.debug(a):l.fail(a)}function b(a,b){var d;try{if(a.length!==b.length)return e("array of length "+a.length+" should be "+b.length+" long"),!1;for(d=0;d<a.length;d+=1)if(a[d]!==b[d])return e(a[d]+" should be "+b[d]+" at array index "+d),!1}catch(c){return!1}return!0}function c(a,b,d){var f=a.attributes,g=f.length,k,m,r;for(k=0;k<g;k+=1)if(m=f.item(k),"xmlns"!==m.prefix&&"urn:webodf:names:steps"!==m.namespaceURI){r=b.getAttributeNS(m.namespaceURI,
m.localName);if(!b.hasAttributeNS(m.namespaceURI,m.localName))return e("Attribute "+m.localName+" with value "+m.value+" was not present"),!1;if(r!==m.value)return e("Attribute "+m.localName+" was "+r+" should be "+m.value),!1}return d?!0:c(b,a,!0)}function k(a,b){var d,f;d=a.nodeType;f=b.nodeType;if(d!==f)return e("Nodetype '"+d+"' should be '"+f+"'"),!1;if(d===Node.TEXT_NODE){if(a.data===b.data)return!0;e("Textnode data '"+a.data+"' should be '"+b.data+"'");return!1}runtime.assert(d===Node.ELEMENT_NODE,
"Only textnodes and elements supported.");if(a.namespaceURI!==b.namespaceURI)return e("namespace '"+a.namespaceURI+"' should be '"+b.namespaceURI+"'"),!1;if(a.localName!==b.localName)return e("localName '"+a.localName+"' should be '"+b.localName+"'"),!1;if(!c(a,b,!1))return!1;d=a.firstChild;for(f=b.firstChild;d;){if(!f)return e("Nodetype '"+d.nodeType+"' is unexpected here."),!1;if(!k(d,f))return!1;d=d.nextSibling;f=f.nextSibling}return f?(e("Nodetype '"+f.nodeType+"' is missing here."),!1):!0}function f(a,
d,c){if(0===d)return a===d&&1/a===1/d;if(a===d)return!0;if(null===a||null===d)return!1;if("number"===typeof d&&isNaN(d))return"number"===typeof a&&isNaN(a);if("number"===typeof d&&"number"===typeof a){if(a===d)return!0;void 0===c&&(c=1E-4);runtime.assert("number"===typeof c,"Absolute tolerance not given as number.");runtime.assert(0<=c,"Absolute tolerance should be given as positive number, was "+c);a=Math.abs(a-d);return a<=c}return Object.prototype.toString.call(d)===Object.prototype.toString.call([])?
b(a,d):"object"===typeof d&&"object"===typeof a?d.constructor===Element||d.constructor===Node?k(a,d):r(a,d):!1}function m(a,b,d,c){"string"===typeof b&&"string"===typeof d||l.debug("WARN: shouldBe() expects string arguments");var g,k;try{k=eval(b)}catch(m){g=m}a=eval(d);g?e(b+" should be "+a+". Threw exception "+g):f(k,a,c)?l.pass(b+" is "+d):String(typeof k)===String(typeof a)?(d=0===k&&0>1/k?"-0":String(k),e(b+" should be "+a+". Was "+d+".")):e(b+" should be "+a+" (of type "+typeof a+"). Was "+
k+" (of type "+typeof k+").")}var q=0,p,r,d=!1;this.resourcePrefix=function(){return g};this.beginExpectFail=function(){p=q;d=!0};this.endExpectFail=function(){var a=p===q;d=!1;q=p;a&&(q+=1,l.fail("Expected at least one failed test, but none registered."))};r=function(a,d){var c=Object.keys(a),g=Object.keys(d);c.sort();g.sort();return b(c,g)&&Object.keys(a).every(function(b){var c=a[b],h=d[b];return f(c,h)?!0:(e(c+" should be "+h+" for key "+b),!1)})};this.areNodesEqual=k;this.shouldBeNull=function(a,
b){m(a,b,"null")};this.shouldBeNonNull=function(a,b){var d,c;try{c=eval(b)}catch(f){d=f}d?e(b+" should be non-null. Threw exception "+d):null!==c?l.pass(b+" is non-null."):e(b+" should be non-null. Was "+c)};this.shouldBe=m;this.testFailed=e;this.countFailedTests=function(){return q};this.name=function(a){var b,d,c=[],e=a.length;c.length=e;for(b=0;b<e;b+=1){d=Runtime.getFunctionName(a[b])||"";if(""===d)throw"Found a function without a name.";c[b]={f:a[b],name:d}}return c}};
core.UnitTester=function(){function g(b,c){return"<span style='color:blue;cursor:pointer' onclick='"+c+"'>"+b+"</span>"}function l(b){e.reporter&&e.reporter(b)}var e=this,b=0,c=new core.UnitTestLogger,k={},f="BrowserRuntime"===runtime.type();this.resourcePrefix="";this.reporter=function(b){var c,e;f?runtime.log("<span>Running "+g(b.description,'runTest("'+b.suite[0]+'","'+b.description+'")')+"</span>"):runtime.log("Running "+b.description);if(!b.success)for(c=0;c<b.log.length;c+=1)e=b.log[c],runtime.log(e.category,
e.message)};this.runTests=function(m,q,p){function r(e){function f(){m&&a.endExpectFail();l(c.endTest());n.tearDown();h[g]=s===a.countFailedTests();r(e.slice(1))}var g,m;if(0===e.length)k[d]=h,b+=a.countFailedTests(),q();else if(w=e[0].f,g=e[0].name,m=!0===e[0].expectFail,s=a.countFailedTests(),p.length&&-1===p.indexOf(g))r(e.slice(1));else{n.setUp();c.startTest(d,g);m&&a.beginExpectFail();try{w(f)}catch(x){a.testFailed("Unexpected exception encountered: "+x.toString()+"\n"+x.stack),f()}}}var d=Runtime.getFunctionName(m)||
"",a=new core.UnitTestRunner(e.resourcePrefix,c),n=new m(a),h={},x,w,y,u,s;if(k.hasOwnProperty(d))runtime.log("Test "+d+" has already run.");else{f?runtime.log("<span>Running "+g(d,'runSuite("'+d+'");')+": "+n.description()+"</span>"):runtime.log("Running "+d+": "+n.description);y=n.tests();for(x=0;x<y.length;x+=1)if(w=y[x].f,m=y[x].name,u=!0===y[x].expectFail,!p.length||-1!==p.indexOf(m)){s=a.countFailedTests();n.setUp();c.startTest(d,m);u&&a.beginExpectFail();try{w()}catch(z){a.testFailed("Unexpected exception encountered: "+
z.toString()+"\n"+z.stack)}u&&a.endExpectFail();l(c.endTest());n.tearDown();h[m]=s===a.countFailedTests()}r(n.asyncTests())}};this.failedTestsCount=function(){return b};this.results=function(){return k}};core.Utils=function(){function g(l,e){if(e&&Array.isArray(e)){l=l||[];if(!Array.isArray(l))throw"Destination is not an array.";l=l.concat(e.map(function(b){return g(null,b)}))}else if(e&&"object"===typeof e){l=l||{};if("object"!==typeof l)throw"Destination is not an object.";Object.keys(e).forEach(function(b){l[b]=g(l[b],e[b])})}else l=e;return l}this.hashString=function(g){var e=0,b,c;b=0;for(c=g.length;b<c;b+=1)e=(e<<5)-e+g.charCodeAt(b),e|=0;return e};this.mergeObjects=function(l,e){Object.keys(e).forEach(function(b){l[b]=
g(l[b],e[b])});return l}};core.Zip=function(g,l){function e(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,
853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,
4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,
225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,
2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,
2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],d,c,e=a.length,h=0,h=0;d=-1;for(c=0;c<e;c+=1)h=(d^a[c])&255,h=b[h],d=d>>>8^h;return d^-1}function b(a){return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&15,a>>5&63,(a&31)<<1)}function c(a){var b=a.getFullYear();return 1980>b?0:b-1980<<
25|a.getMonth()+1<<21|a.getDate()<<16|a.getHours()<<11|a.getMinutes()<<5|a.getSeconds()>>1}function k(a,d){var c,e,n,f,g,k,m,r=this;this.load=function(b){if(null!==r.data)b(null,r.data);else{var d=g+34+e+n+256;d+m>h&&(d=h-m);runtime.read(a,m,d,function(d,c){if(d||null===c)b(d,c);else a:{var e=c,h=new core.ByteArray(e),n=h.readUInt32LE(),m;if(67324752!==n)b("File entry signature is wrong."+n.toString()+" "+e.length.toString(),null);else{h.pos+=22;n=h.readUInt16LE();m=h.readUInt16LE();h.pos+=n+m;if(f){e=
e.subarray(h.pos,h.pos+g);if(g!==e.length){b("The amount of compressed bytes read was "+e.length.toString()+" instead of "+g.toString()+" for "+r.filename+" in "+a+".",null);break a}e=w(e,k)}else e=e.subarray(h.pos,h.pos+k);k!==e.length?b("The amount of bytes read was "+e.length.toString()+" instead of "+k.toString()+" for "+r.filename+" in "+a+".",null):(r.data=e,b(null,e))}}})}};this.set=function(a,b,d,c){r.filename=a;r.data=b;r.compressed=d;r.date=c};this.error=null;d&&(c=d.readUInt32LE(),33639248!==
c?this.error="Central directory entry has wrong signature at position "+(d.pos-4).toString()+' for file "'+a+'": '+d.data.length.toString():(d.pos+=6,f=d.readUInt16LE(),this.date=b(d.readUInt32LE()),d.readUInt32LE(),g=d.readUInt32LE(),k=d.readUInt32LE(),e=d.readUInt16LE(),n=d.readUInt16LE(),c=d.readUInt16LE(),d.pos+=8,m=d.readUInt32LE(),this.filename=runtime.byteArrayToString(d.data.subarray(d.pos,d.pos+e),"utf8"),this.data=null,d.pos+=e+n+c))}function f(a,b){if(22!==a.length)b("Central directory length should be 22.",
y);else{var d=new core.ByteArray(a),c;c=d.readUInt32LE();101010256!==c?b("Central directory signature is wrong: "+c.toString(),y):(c=d.readUInt16LE(),0!==c?b("Zip files with non-zero disk numbers are not supported.",y):(c=d.readUInt16LE(),0!==c?b("Zip files with non-zero disk numbers are not supported.",y):(c=d.readUInt16LE(),x=d.readUInt16LE(),c!==x?b("Number of entries is inconsistent.",y):(c=d.readUInt32LE(),d=d.readUInt16LE(),d=h-22-c,runtime.read(g,d,h-d,function(a,d){if(a||null===d)b(a,y);else a:{var c=
new core.ByteArray(d),e,h;n=[];for(e=0;e<x;e+=1){h=new k(g,c);if(h.error){b(h.error,y);break a}n[n.length]=h}b(null,y)}})))))}}function m(a,b){var d=null,c,e;for(e=0;e<n.length;e+=1)if(c=n[e],c.filename===a){d=c;break}d?d.data?b(null,d.data):d.load(b):b(a+" not found.",null)}function q(a){var b=new core.ByteArrayWriter("utf8"),d=0;b.appendArray([80,75,3,4,20,0,0,0,0,0]);a.data&&(d=a.data.length);b.appendUInt32LE(c(a.date));b.appendUInt32LE(a.data?e(a.data):0);b.appendUInt32LE(d);b.appendUInt32LE(d);
b.appendUInt16LE(a.filename.length);b.appendUInt16LE(0);b.appendString(a.filename);a.data&&b.appendByteArray(a.data);return b}function p(a,b){var d=new core.ByteArrayWriter("utf8"),h=0;d.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);a.data&&(h=a.data.length);d.appendUInt32LE(c(a.date));d.appendUInt32LE(a.data?e(a.data):0);d.appendUInt32LE(h);d.appendUInt32LE(h);d.appendUInt16LE(a.filename.length);d.appendArray([0,0,0,0,0,0,0,0,0,0,0,0]);d.appendUInt32LE(b);d.appendString(a.filename);return d}function r(a,
b){if(a===n.length)b(null);else{var d=n[a];null!==d.data?r(a+1,b):d.load(function(d){d?b(d):r(a+1,b)})}}function d(a,b){r(0,function(d){if(d)b(d);else{var c,e,h=new core.ByteArrayWriter("utf8"),f=[0];for(c=0;c<n.length;c+=1)h.appendByteArrayWriter(q(n[c])),f.push(h.getLength());d=h.getLength();for(c=0;c<n.length;c+=1)e=n[c],h.appendByteArrayWriter(p(e,f[c]));c=h.getLength()-d;h.appendArray([80,75,5,6,0,0,0,0]);h.appendUInt16LE(n.length);h.appendUInt16LE(n.length);h.appendUInt32LE(c);h.appendUInt32LE(d);
h.appendArray([0,0]);a(h.getByteArray())}})}function a(a,b){d(function(d){runtime.writeFile(a,d,b)},b)}var n,h,x,w=core.RawInflate.inflate,y=this,u=new core.Base64;this.load=m;this.save=function(a,b,d,c){var e,h;for(e=0;e<n.length;e+=1)if(h=n[e],h.filename===a){h.set(a,b,d,c);return}h=new k(g);h.set(a,b,d,c);n.push(h)};this.remove=function(a){var b,d;for(b=0;b<n.length;b+=1)if(d=n[b],d.filename===a)return n.splice(b,1),!0;return!1};this.write=function(b){a(g,b)};this.writeAs=a;this.createByteArray=
d;this.loadContentXmlAsFragments=function(a,b){y.loadAsString(a,function(a,d){if(a)return b.rootElementReady(a);b.rootElementReady(null,d,!0)})};this.loadAsString=function(a,b){m(a,function(a,d){if(a||null===d)return b(a,null);var c=runtime.byteArrayToString(d,"utf8");b(null,c)})};this.loadAsDOM=function(a,b){y.loadAsString(a,function(a,d){if(a||null===d)b(a,null);else{var c=(new DOMParser).parseFromString(d,"text/xml");b(null,c)}})};this.loadAsDataURL=function(a,b,d){m(a,function(a,c){if(a||!c)return d(a,
null);var e=0,h;b||(b=80===c[1]&&78===c[2]&&71===c[3]?"image/png":255===c[0]&&216===c[1]&&255===c[2]?"image/jpeg":71===c[0]&&73===c[1]&&70===c[2]?"image/gif":"");for(h="data:"+b+";base64,";e<c.length;)h+=u.convertUTF8ArrayToBase64(c.subarray(e,Math.min(e+45E3,c.length))),e+=45E3;d(null,h)})};this.getEntries=function(){return n.slice()};h=-1;null===l?n=[]:runtime.getFileSize(g,function(a){h=a;0>h?l("File '"+g+"' cannot be read.",y):runtime.read(g,h-22,22,function(a,b){a||null===l||null===b?l(a,y):
f(b,l)})})};gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};gui.SessionConstraints=function(){function g(b){l.hasOwnProperty(b)||(l[b]=!1,e.register(b))}var l={},e=new core.EventNotifier;this.registerConstraint=g;this.subscribe=function(b,c){g(b);e.subscribe(b,c)};this.unsubscribe=function(b,c){e.unsubscribe(b,c)};this.setState=function(b,c){runtime.assert(!0===l.hasOwnProperty(b),"No such constraint");l[b]!==c&&(l[b]=c,e.emit(b,c))};this.getState=function(b){runtime.assert(!0===l.hasOwnProperty(b),"No such constraint");return l[b]}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(g){};odf.OdfNodeFilter=function(){this.acceptNode=function(g){return"http://www.w3.org/1999/xhtml"===g.namespaceURI?NodeFilter.FILTER_SKIP:g.namespaceURI&&g.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};odf.Namespaces={namespaceMap:{db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",
office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",
dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};
(function(){var g=odf.Namespaces.namespaceMap,l=odf.Namespaces.prefixMap,e;for(e in g)g.hasOwnProperty(e)&&(l[g[e]]=e)})();odf.Namespaces.forEachPrefix=function(g){var l=odf.Namespaces.namespaceMap,e;for(e in l)l.hasOwnProperty(e)&&g(e,l[e])};odf.Namespaces.lookupNamespaceURI=function(g){var l=null;odf.Namespaces.namespaceMap.hasOwnProperty(g)&&(l=odf.Namespaces.namespaceMap[g]);return l};odf.Namespaces.lookupPrefix=function(g){var l=odf.Namespaces.prefixMap;return l.hasOwnProperty(g)?l[g]:null};
odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};
function createXPathSingleton(){function g(b,d,a){return-1!==b&&(b<d||-1===d)&&(b<a||-1===a)}function l(b){for(var d=[],a=0,c=b.length,e;a<c;){var f=b,k=c,m=d,l="",q=[],z=f.indexOf("[",a),v=f.indexOf("/",a),H=f.indexOf("=",a);g(v,z,H)?(l=f.substring(a,v),a=v+1):g(z,v,H)?(l=f.substring(a,z),a=p(f,z,q)):g(H,v,z)?(l=f.substring(a,H),a=H):(l=f.substring(a,k),a=k);m.push({location:l,predicates:q});if(a<c&&"="===b[a]){e=b.substring(a+1,c);if(2<e.length&&("'"===e[0]||'"'===e[0]))e=e.slice(1,e.length-1);
else try{e=parseInt(e,10)}catch(J){}a=c}}return{steps:d,value:e}}function e(){var b=null,d=!1;this.setNode=function(a){b=a};this.reset=function(){d=!1};this.next=function(){var a=d?null:b;d=!0;return a}}function b(b,d,a){this.reset=function(){b.reset()};this.next=function(){for(var c=b.next();c;){c.nodeType===Node.ELEMENT_NODE&&(c=c.getAttributeNodeNS(d,a));if(c)break;c=b.next()}return c}}function c(b,d){var a=b.next(),c=null;this.reset=function(){b.reset();a=b.next();c=null};this.next=function(){for(;a;){if(c)if(d&&
c.firstChild)c=c.firstChild;else{for(;!c.nextSibling&&c!==a;)c=c.parentNode;c===a?a=b.next():c=c.nextSibling}else{do(c=a.firstChild)||(a=b.next());while(a&&!c)}if(c&&c.nodeType===Node.ELEMENT_NODE)return c}return null}}function k(b,d){this.reset=function(){b.reset()};this.next=function(){for(var a=b.next();a&&!d(a);)a=b.next();return a}}function f(b,d,a){d=d.split(":",2);var c=a(d[0]),e=d[1];return new k(b,function(a){return a.localName===e&&a.namespaceURI===c})}function m(b,d,a){var c=new e,h=q(c,
d,a),f=d.value;return void 0===f?new k(b,function(a){c.setNode(a);h.reset();return null!==h.next()}):new k(b,function(a){c.setNode(a);h.reset();return(a=h.next())?a.nodeValue===f:!1})}var q,p;p=function(b,d,a){for(var c=d,e=b.length,f=0;c<e;)"]"===b[c]?(f-=1,0>=f&&a.push(l(b.substring(d,c)))):"["===b[c]&&(0>=f&&(d=c+1),f+=1),c+=1;return c};q=function(e,d,a){var n,h,g,k;for(n=0;n<d.steps.length;n+=1){g=d.steps[n];h=g.location;if(""===h)e=new c(e,!1);else if("@"===h[0]){h=h.substr(1).split(":",2);k=
a(h[0]);if(!k)throw"No namespace associated with the prefix "+h[0];e=new b(e,k,h[1])}else"."!==h&&(e=new c(e,!1),-1!==h.indexOf(":")&&(e=f(e,h,a)));for(h=0;h<g.predicates.length;h+=1)k=g.predicates[h],e=m(e,k,a)}return e};return{getODFElementsWithXPath:function(b,d,a){var c=b.ownerDocument,h=[],f=null;if(c&&"function"===typeof c.evaluate)for(a=c.evaluate(d,b,a,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),f=a.iterateNext();null!==f;)f.nodeType===Node.ELEMENT_NODE&&h.push(f),f=a.iterateNext();else{h=
new e;h.setNode(b);b=l(d);h=q(h,b,a);b=[];for(a=h.next();a;)b.push(a),a=h.next();h=b}return h}}}xmldom.XPath=createXPathSingleton();odf.StyleInfo=function(){function g(a,b){var d,c,e,h,f,n=0;if(d=E[a.localName])if(e=d[a.namespaceURI])n=e.length;for(d=0;d<n;d+=1)c=e[d],h=c.ns,f=c.localname,(c=a.getAttributeNS(h,f))&&a.setAttributeNS(h,H[h]+f,b+c);for(e=a.firstElementChild;e;)g(e,b),e=e.nextElementSibling}function l(a,b){var d,c,e,h,f,n=0;if(d=E[a.localName])if(e=d[a.namespaceURI])n=e.length;for(d=0;d<n;d+=1)if(c=e[d],h=c.ns,f=c.localname,c=a.getAttributeNS(h,f))c=c.replace(b,""),a.setAttributeNS(h,H[h]+f,c);for(e=a.firstElementChild;e;)l(e,
b),e=e.nextElementSibling}function e(a,b){var d,c,e,h,f,n=0;if(d=E[a.localName])if(e=d[a.namespaceURI])n=e.length;for(d=0;d<n;d+=1)if(h=e[d],c=h.ns,f=h.localname,c=a.getAttributeNS(c,f))b=b||{},h=h.keyname,b.hasOwnProperty(h)?b[h][c]=1:(f={},f[c]=1,b[h]=f);return b}function b(a,d){var c,h;e(a,d);for(c=a.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&(h=c,b(h,d)),c=c.nextSibling}function c(a,b,d){this.key=a;this.name=b;this.family=d;this.requires={}}function k(a,b,d){var e=a+'"'+b,h=d[e];h||(h=d[e]=
new c(e,a,b));return h}function f(a,b,d){var c,e,h,n,g,m=0;c=a.getAttributeNS(s,"name");n=a.getAttributeNS(s,"family");c&&n&&(b=k(c,n,d));if(b){if(c=E[a.localName])if(h=c[a.namespaceURI])m=h.length;for(c=0;c<m;c+=1)if(n=h[c],e=n.ns,g=n.localname,e=a.getAttributeNS(e,g))n=n.keyname,n=k(e,n,d),b.requires[n.key]=n}for(a=a.firstElementChild;a;)f(a,b,d),a=a.nextElementSibling;return d}function m(a,b){var d=b[a.family];d||(d=b[a.family]={});d[a.name]=1;Object.keys(a.requires).forEach(function(d){m(a.requires[d],
b)})}function q(a,b){var d=f(a,null,{});Object.keys(d).forEach(function(a){a=d[a];var c=b[a.family];c&&c.hasOwnProperty(a.name)&&m(a,b)})}function p(a,b){function d(b){(b=h.getAttributeNS(s,b))&&(a[b]=!0)}var c=["font-name","font-name-asian","font-name-complex"],e,h;for(e=b&&b.firstElementChild;e;)h=e,c.forEach(d),p(a,h),e=e.nextElementSibling}function r(a,b){function d(a){var c=h.getAttributeNS(s,a);c&&b.hasOwnProperty(c)&&h.setAttributeNS(s,"style:"+a,b[c])}var c=["font-name","font-name-asian",
"font-name-complex"],e,h;for(e=a&&a.firstElementChild;e;)h=e,c.forEach(d),r(h,b),e=e.nextElementSibling}var d=odf.Namespaces.chartns,a=odf.Namespaces.dbns,n=odf.Namespaces.dr3dns,h=odf.Namespaces.drawns,x=odf.Namespaces.formns,w=odf.Namespaces.numberns,y=odf.Namespaces.officens,u=odf.Namespaces.presentationns,s=odf.Namespaces.stylens,z=odf.Namespaces.tablens,v=odf.Namespaces.textns,H={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},J={text:[{ens:s,en:"tab-stop",ans:s,a:"leader-text-style"},{ens:s,en:"drop-cap",ans:s,a:"style-name"},{ens:v,en:"notes-configuration",ans:v,a:"citation-body-style-name"},{ens:v,en:"notes-configuration",ans:v,a:"citation-style-name"},{ens:v,en:"a",ans:v,a:"style-name"},{ens:v,en:"alphabetical-index",ans:v,a:"style-name"},{ens:v,en:"linenumbering-configuration",
ans:v,a:"style-name"},{ens:v,en:"list-level-style-number",ans:v,a:"style-name"},{ens:v,en:"ruby-text",ans:v,a:"style-name"},{ens:v,en:"span",ans:v,a:"style-name"},{ens:v,en:"a",ans:v,a:"visited-style-name"},{ens:s,en:"text-properties",ans:s,a:"text-line-through-text-style"},{ens:v,en:"alphabetical-index-source",ans:v,a:"main-entry-style-name"},{ens:v,en:"index-entry-bibliography",ans:v,a:"style-name"},{ens:v,en:"index-entry-chapter",ans:v,a:"style-name"},{ens:v,en:"index-entry-link-end",ans:v,a:"style-name"},
{ens:v,en:"index-entry-link-start",ans:v,a:"style-name"},{ens:v,en:"index-entry-page-number",ans:v,a:"style-name"},{ens:v,en:"index-entry-span",ans:v,a:"style-name"},{ens:v,en:"index-entry-tab-stop",ans:v,a:"style-name"},{ens:v,en:"index-entry-text",ans:v,a:"style-name"},{ens:v,en:"index-title-template",ans:v,a:"style-name"},{ens:v,en:"list-level-style-bullet",ans:v,a:"style-name"},{ens:v,en:"outline-level-style",ans:v,a:"style-name"}],paragraph:[{ens:h,en:"caption",ans:h,a:"text-style-name"},{ens:h,
en:"circle",ans:h,a:"text-style-name"},{ens:h,en:"connector",ans:h,a:"text-style-name"},{ens:h,en:"control",ans:h,a:"text-style-name"},{ens:h,en:"custom-shape",ans:h,a:"text-style-name"},{ens:h,en:"ellipse",ans:h,a:"text-style-name"},{ens:h,en:"frame",ans:h,a:"text-style-name"},{ens:h,en:"line",ans:h,a:"text-style-name"},{ens:h,en:"measure",ans:h,a:"text-style-name"},{ens:h,en:"path",ans:h,a:"text-style-name"},{ens:h,en:"polygon",ans:h,a:"text-style-name"},{ens:h,en:"polyline",ans:h,a:"text-style-name"},
{ens:h,en:"rect",ans:h,a:"text-style-name"},{ens:h,en:"regular-polygon",ans:h,a:"text-style-name"},{ens:y,en:"annotation",ans:h,a:"text-style-name"},{ens:x,en:"column",ans:x,a:"text-style-name"},{ens:s,en:"style",ans:s,a:"next-style-name"},{ens:z,en:"body",ans:z,a:"paragraph-style-name"},{ens:z,en:"even-columns",ans:z,a:"paragraph-style-name"},{ens:z,en:"even-rows",ans:z,a:"paragraph-style-name"},{ens:z,en:"first-column",ans:z,a:"paragraph-style-name"},{ens:z,en:"first-row",ans:z,a:"paragraph-style-name"},
{ens:z,en:"last-column",ans:z,a:"paragraph-style-name"},{ens:z,en:"last-row",ans:z,a:"paragraph-style-name"},{ens:z,en:"odd-columns",ans:z,a:"paragraph-style-name"},{ens:z,en:"odd-rows",ans:z,a:"paragraph-style-name"},{ens:v,en:"notes-configuration",ans:v,a:"default-style-name"},{ens:v,en:"alphabetical-index-entry-template",ans:v,a:"style-name"},{ens:v,en:"bibliography-entry-template",ans:v,a:"style-name"},{ens:v,en:"h",ans:v,a:"style-name"},{ens:v,en:"illustration-index-entry-template",ans:v,a:"style-name"},
{ens:v,en:"index-source-style",ans:v,a:"style-name"},{ens:v,en:"object-index-entry-template",ans:v,a:"style-name"},{ens:v,en:"p",ans:v,a:"style-name"},{ens:v,en:"table-index-entry-template",ans:v,a:"style-name"},{ens:v,en:"table-of-content-entry-template",ans:v,a:"style-name"},{ens:v,en:"table-index-entry-template",ans:v,a:"style-name"},{ens:v,en:"user-index-entry-template",ans:v,a:"style-name"},{ens:s,en:"page-layout-properties",ans:s,a:"register-truth-ref-style-name"}],chart:[{ens:d,en:"axis",ans:d,
a:"style-name"},{ens:d,en:"chart",ans:d,a:"style-name"},{ens:d,en:"data-label",ans:d,a:"style-name"},{ens:d,en:"data-point",ans:d,a:"style-name"},{ens:d,en:"equation",ans:d,a:"style-name"},{ens:d,en:"error-indicator",ans:d,a:"style-name"},{ens:d,en:"floor",ans:d,a:"style-name"},{ens:d,en:"footer",ans:d,a:"style-name"},{ens:d,en:"grid",ans:d,a:"style-name"},{ens:d,en:"legend",ans:d,a:"style-name"},{ens:d,en:"mean-value",ans:d,a:"style-name"},{ens:d,en:"plot-area",ans:d,a:"style-name"},{ens:d,en:"regression-curve",
ans:d,a:"style-name"},{ens:d,en:"series",ans:d,a:"style-name"},{ens:d,en:"stock-gain-marker",ans:d,a:"style-name"},{ens:d,en:"stock-loss-marker",ans:d,a:"style-name"},{ens:d,en:"stock-range-line",ans:d,a:"style-name"},{ens:d,en:"subtitle",ans:d,a:"style-name"},{ens:d,en:"title",ans:d,a:"style-name"},{ens:d,en:"wall",ans:d,a:"style-name"}],section:[{ens:v,en:"alphabetical-index",ans:v,a:"style-name"},{ens:v,en:"bibliography",ans:v,a:"style-name"},{ens:v,en:"illustration-index",ans:v,a:"style-name"},
{ens:v,en:"index-title",ans:v,a:"style-name"},{ens:v,en:"object-index",ans:v,a:"style-name"},{ens:v,en:"section",ans:v,a:"style-name"},{ens:v,en:"table-of-content",ans:v,a:"style-name"},{ens:v,en:"table-index",ans:v,a:"style-name"},{ens:v,en:"user-index",ans:v,a:"style-name"}],ruby:[{ens:v,en:"ruby",ans:v,a:"style-name"}],table:[{ens:a,en:"query",ans:a,a:"style-name"},{ens:a,en:"table-representation",ans:a,a:"style-name"},{ens:z,en:"background",ans:z,a:"style-name"},{ens:z,en:"table",ans:z,a:"style-name"}],
"table-column":[{ens:a,en:"column",ans:a,a:"style-name"},{ens:z,en:"table-column",ans:z,a:"style-name"}],"table-row":[{ens:a,en:"query",ans:a,a:"default-row-style-name"},{ens:a,en:"table-representation",ans:a,a:"default-row-style-name"},{ens:z,en:"table-row",ans:z,a:"style-name"}],"table-cell":[{ens:a,en:"column",ans:a,a:"default-cell-style-name"},{ens:z,en:"table-column",ans:z,a:"default-cell-style-name"},{ens:z,en:"table-row",ans:z,a:"default-cell-style-name"},{ens:z,en:"body",ans:z,a:"style-name"},
{ens:z,en:"covered-table-cell",ans:z,a:"style-name"},{ens:z,en:"even-columns",ans:z,a:"style-name"},{ens:z,en:"covered-table-cell",ans:z,a:"style-name"},{ens:z,en:"even-columns",ans:z,a:"style-name"},{ens:z,en:"even-rows",ans:z,a:"style-name"},{ens:z,en:"first-column",ans:z,a:"style-name"},{ens:z,en:"first-row",ans:z,a:"style-name"},{ens:z,en:"last-column",ans:z,a:"style-name"},{ens:z,en:"last-row",ans:z,a:"style-name"},{ens:z,en:"odd-columns",ans:z,a:"style-name"},{ens:z,en:"odd-rows",ans:z,a:"style-name"},
{ens:z,en:"table-cell",ans:z,a:"style-name"}],graphic:[{ens:n,en:"cube",ans:h,a:"style-name"},{ens:n,en:"extrude",ans:h,a:"style-name"},{ens:n,en:"rotate",ans:h,a:"style-name"},{ens:n,en:"scene",ans:h,a:"style-name"},{ens:n,en:"sphere",ans:h,a:"style-name"},{ens:h,en:"caption",ans:h,a:"style-name"},{ens:h,en:"circle",ans:h,a:"style-name"},{ens:h,en:"connector",ans:h,a:"style-name"},{ens:h,en:"control",ans:h,a:"style-name"},{ens:h,en:"custom-shape",ans:h,a:"style-name"},{ens:h,en:"ellipse",ans:h,a:"style-name"},
{ens:h,en:"frame",ans:h,a:"style-name"},{ens:h,en:"g",ans:h,a:"style-name"},{ens:h,en:"line",ans:h,a:"style-name"},{ens:h,en:"measure",ans:h,a:"style-name"},{ens:h,en:"page-thumbnail",ans:h,a:"style-name"},{ens:h,en:"path",ans:h,a:"style-name"},{ens:h,en:"polygon",ans:h,a:"style-name"},{ens:h,en:"polyline",ans:h,a:"style-name"},{ens:h,en:"rect",ans:h,a:"style-name"},{ens:h,en:"regular-polygon",ans:h,a:"style-name"},{ens:y,en:"annotation",ans:h,a:"style-name"}],presentation:[{ens:n,en:"cube",ans:u,
a:"style-name"},{ens:n,en:"extrude",ans:u,a:"style-name"},{ens:n,en:"rotate",ans:u,a:"style-name"},{ens:n,en:"scene",ans:u,a:"style-name"},{ens:n,en:"sphere",ans:u,a:"style-name"},{ens:h,en:"caption",ans:u,a:"style-name"},{ens:h,en:"circle",ans:u,a:"style-name"},{ens:h,en:"connector",ans:u,a:"style-name"},{ens:h,en:"control",ans:u,a:"style-name"},{ens:h,en:"custom-shape",ans:u,a:"style-name"},{ens:h,en:"ellipse",ans:u,a:"style-name"},{ens:h,en:"frame",ans:u,a:"style-name"},{ens:h,en:"g",ans:u,a:"style-name"},
{ens:h,en:"line",ans:u,a:"style-name"},{ens:h,en:"measure",ans:u,a:"style-name"},{ens:h,en:"page-thumbnail",ans:u,a:"style-name"},{ens:h,en:"path",ans:u,a:"style-name"},{ens:h,en:"polygon",ans:u,a:"style-name"},{ens:h,en:"polyline",ans:u,a:"style-name"},{ens:h,en:"rect",ans:u,a:"style-name"},{ens:h,en:"regular-polygon",ans:u,a:"style-name"},{ens:y,en:"annotation",ans:u,a:"style-name"}],"drawing-page":[{ens:h,en:"page",ans:h,a:"style-name"},{ens:u,en:"notes",ans:h,a:"style-name"},{ens:s,en:"handout-master",
ans:h,a:"style-name"},{ens:s,en:"master-page",ans:h,a:"style-name"}],"list-style":[{ens:v,en:"list",ans:v,a:"style-name"},{ens:v,en:"numbered-paragraph",ans:v,a:"style-name"},{ens:v,en:"list-item",ans:v,a:"style-override"},{ens:s,en:"style",ans:s,a:"list-style-name"}],data:[{ens:s,en:"style",ans:s,a:"data-style-name"},{ens:s,en:"style",ans:s,a:"percentage-data-style-name"},{ens:u,en:"date-time-decl",ans:s,a:"data-style-name"},{ens:v,en:"creation-date",ans:s,a:"data-style-name"},{ens:v,en:"creation-time",
ans:s,a:"data-style-name"},{ens:v,en:"database-display",ans:s,a:"data-style-name"},{ens:v,en:"date",ans:s,a:"data-style-name"},{ens:v,en:"editing-duration",ans:s,a:"data-style-name"},{ens:v,en:"expression",ans:s,a:"data-style-name"},{ens:v,en:"meta-field",ans:s,a:"data-style-name"},{ens:v,en:"modification-date",ans:s,a:"data-style-name"},{ens:v,en:"modification-time",ans:s,a:"data-style-name"},{ens:v,en:"print-date",ans:s,a:"data-style-name"},{ens:v,en:"print-time",ans:s,a:"data-style-name"},{ens:v,
en:"table-formula",ans:s,a:"data-style-name"},{ens:v,en:"time",ans:s,a:"data-style-name"},{ens:v,en:"user-defined",ans:s,a:"data-style-name"},{ens:v,en:"user-field-get",ans:s,a:"data-style-name"},{ens:v,en:"user-field-input",ans:s,a:"data-style-name"},{ens:v,en:"variable-get",ans:s,a:"data-style-name"},{ens:v,en:"variable-input",ans:s,a:"data-style-name"},{ens:v,en:"variable-set",ans:s,a:"data-style-name"}],"page-layout":[{ens:u,en:"notes",ans:s,a:"page-layout-name"},{ens:s,en:"handout-master",ans:s,
a:"page-layout-name"},{ens:s,en:"master-page",ans:s,a:"page-layout-name"}]},E,F=xmldom.XPath;this.collectUsedFontFaces=p;this.changeFontFaceNames=r;this.UsedStyleList=function(a,d){var c={};this.uses=function(a){var b=a.localName,d=a.getAttributeNS(h,"name")||a.getAttributeNS(s,"name");a="style"===b?a.getAttributeNS(s,"family"):a.namespaceURI===w?"data":b;return(a=c[a])?0<a[d]:!1};b(a,c);d&&q(d,c)};this.getStyleName=function(a,b){var d,c,e=E[b.localName];if(e&&(e=e[b.namespaceURI]))for(c=0;c<e.length;c+=
1)if(e[c].keyname===a&&(e=e[c],b.hasAttributeNS(e.ns,e.localname))){d=b.getAttributeNS(e.ns,e.localname);break}return d};this.hasDerivedStyles=function(a,b,d){var c=d.getAttributeNS(s,"name");d=d.getAttributeNS(s,"family");return F.getODFElementsWithXPath(a,"//style:*[@style:parent-style-name='"+c+"'][@style:family='"+d+"']",b).length?!0:!1};this.prefixStyleNames=function(a,b,d){var c;if(a){for(c=a.firstChild;c;){if(c.nodeType===Node.ELEMENT_NODE){var e=c,f=b,n=e.getAttributeNS(h,"name"),k=void 0;
n?k=h:(n=e.getAttributeNS(s,"name"))&&(k=s);k&&e.setAttributeNS(k,H[k]+"name",f+n)}c=c.nextSibling}g(a,b);d&&g(d,b)}};this.removePrefixFromStyleNames=function(a,b,d){var c=RegExp("^"+b);if(a){for(b=a.firstChild;b;){if(b.nodeType===Node.ELEMENT_NODE){var e=b,f=c,n=e.getAttributeNS(h,"name"),g=void 0;n?g=h:(n=e.getAttributeNS(s,"name"))&&(g=s);g&&(n=n.replace(f,""),e.setAttributeNS(g,H[g]+"name",n))}b=b.nextSibling}l(a,c);d&&l(d,c)}};this.determineStylesForNode=e;E=function(){var a,b,d,c,e,h={},f,n,
g,k;for(d in J)if(J.hasOwnProperty(d))for(c=J[d],b=c.length,a=0;a<b;a+=1)e=c[a],g=e.en,k=e.ens,h.hasOwnProperty(g)?f=h[g]:h[g]=f={},f.hasOwnProperty(k)?n=f[k]:f[k]=n=[],n.push({ns:e.ans,localname:e.a,keyname:d});return h}()};"function"!==typeof Object.create&&(Object.create=function(g){var l=function(){};l.prototype=g;return new l});
xmldom.LSSerializer=function(){function g(b){var e=b||{},f=function(b){var d={},a;for(a in b)b.hasOwnProperty(a)&&(d[b[a]]=a);return d}(b),g=[e],l=[f],p=0;this.push=function(){p+=1;e=g[p]=Object.create(e);f=l[p]=Object.create(f)};this.pop=function(){g.pop();l.pop();p-=1;e=g[p];f=l[p]};this.getLocalNamespaceDefinitions=function(){return f};this.getQName=function(b){var d=b.namespaceURI,a=0,c;if(!d)return b.localName;if(c=f[d])return c+":"+b.localName;do{c||!b.prefix?(c="ns"+a,a+=1):c=b.prefix;if(e[c]===
d)break;if(!e[c]){e[c]=d;f[d]=c;break}c=null}while(null===c);return c+":"+b.localName}}function l(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function e(c,g){var f="",m=b.filter?b.filter.acceptNode(g):NodeFilter.FILTER_ACCEPT,q;if(m===NodeFilter.FILTER_ACCEPT&&g.nodeType===Node.ELEMENT_NODE){c.push();q=c.getQName(g);var p,r=g.attributes,d,a,n,h="",x;p="<"+q;d=r.length;for(a=0;a<d;a+=1)n=r.item(a),"http://www.w3.org/2000/xmlns/"!==
n.namespaceURI&&(x=b.filter?b.filter.acceptNode(n):NodeFilter.FILTER_ACCEPT,x===NodeFilter.FILTER_ACCEPT&&(x=c.getQName(n),n="string"===typeof n.value?l(n.value):n.value,h+=" "+(x+'="'+n+'"')));d=c.getLocalNamespaceDefinitions();for(a in d)d.hasOwnProperty(a)&&((r=d[a])?"xmlns"!==r&&(p+=" xmlns:"+d[a]+'="'+a+'"'):p+=' xmlns="'+a+'"');f+=p+(h+">")}if(m===NodeFilter.FILTER_ACCEPT||m===NodeFilter.FILTER_SKIP){for(m=g.firstChild;m;)f+=e(c,m),m=m.nextSibling;g.nodeValue&&(f+=l(g.nodeValue))}q&&(f+="</"+
q+">",c.pop());return f}var b=this;this.filter=null;this.writeToString=function(b,k){if(!b)return"";var f=new g(k);return e(f,b)}};(function(){function g(b){var d,a=m.length;for(d=0;d<a;d+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&b.localName===m[d])return d;return-1}function l(b,d){var a=new c.UsedStyleList(b,d),e=new odf.OdfNodeFilter;this.acceptNode=function(b){var c=e.acceptNode(b);c===NodeFilter.FILTER_ACCEPT&&b.parentNode===d&&b.nodeType===Node.ELEMENT_NODE&&(c=a.uses(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return c}}function e(b,d){var a=new l(b,d);this.acceptNode=function(b){var d=
a.acceptNode(b);d!==NodeFilter.FILTER_ACCEPT||!b.parentNode||b.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==b.parentNode.localName&&"tab"!==b.parentNode.localName||(d=NodeFilter.FILTER_REJECT);return d}}function b(b,d){if(d){var a=g(d),c,e=b.firstChild;if(-1!==a){for(;e;){c=g(e);if(-1!==c&&c>a)break;e=e.nextSibling}b.insertBefore(d,e)}}}var c=new odf.StyleInfo,k=new core.DomUtils,f=odf.Namespaces.stylens,m="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
q=Date.now()+"_webodf_",p=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";
odf.AnnotationElement=function(){};odf.OdfPart=function(b,d,a,c){var e=this;this.size=0;this.type=null;this.name=b;this.container=a;this.url=null;this.mimetype=d;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==c&&(this.mimetype=d,c.loadAsDataURL(b,d,function(a,b){a&&runtime.log(a);e.url=b;if(e.onchange)e.onchange(e);if(e.onstatereadychange)e.onstatereadychange(e)}))}};odf.OdfPart.prototype.load=function(){};
odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+p.toBase64(this.data):null};odf.OdfContainer=function d(a,n){function h(a){for(var b=a.firstChild,d;b;)d=b.nextSibling,b.nodeType===Node.ELEMENT_NODE?h(b):b.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&a.removeChild(b),b=d}function g(a){var b={},d,c,e=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,null,!1);for(a=e.nextNode();a;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&("annotation"===
a.localName?(d=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(b.hasOwnProperty(d)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+d+"'"):b[d]=a):"annotation-end"===a.localName&&((d=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?b.hasOwnProperty(d)?(c=b[d],c.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+d+"'"):c.annotationEndElement=
a):runtime.log("Warning: annotation end without an annotation start, name: '"+d+"'"):runtime.log("Warning: annotation end without a name found"))),a=e.nextNode()}function m(a,b){for(var d=a&&a.firstChild;d;)d.nodeType===Node.ELEMENT_NODE&&d.setAttributeNS("urn:webodf:names:scope","scope",b),d=d.nextSibling}function y(a,b){for(var d=K.rootElement.meta,d=d&&d.firstChild;d&&(d.namespaceURI!==a||d.localName!==b);)d=d.nextSibling;for(d=d&&d.firstChild;d&&d.nodeType!==Node.TEXT_NODE;)d=d.nextSibling;return d?
d.data:null}function u(a){var b={},d;for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===f&&"font-face"===a.localName&&(d=a.getAttributeNS(f,"name"),b[d]=a),a=a.nextSibling;return b}function s(a,b){var d=null,c,e,h;if(a)for(d=a.cloneNode(!0),c=d.firstElementChild;c;)e=c.nextElementSibling,(h=c.getAttributeNS("urn:webodf:names:scope","scope"))&&h!==b&&d.removeChild(c),c=e;return d}function z(a,b){var d,e,h,n=null,g={};if(a)for(b.forEach(function(a){c.collectUsedFontFaces(g,a)}),
n=a.cloneNode(!0),d=n.firstElementChild;d;)e=d.nextElementSibling,h=d.getAttributeNS(f,"name"),g[h]||n.removeChild(d),d=e;return n}function v(a){var b=K.rootElement.ownerDocument,d;if(a){h(a.documentElement);try{d=b.importNode(a.documentElement,!0)}catch(c){}}return d}function H(a){K.state=a;if(K.onchange)K.onchange(K);if(K.onstatereadychange)K.onstatereadychange(K)}function J(a){Z=null;K.rootElement=a;a.fontFaceDecls=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
a.styles=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");a.meta=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");a.settings=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"settings");a.scripts=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");g(a)}function E(a){var e=v(a),h=K.rootElement,f;e&&"document-styles"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI?(h.fontFaceDecls=k.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),b(h,h.fontFaceDecls),f=k.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),h.styles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"styles"),b(h,h.styles),f=k.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),h.automaticStyles=f||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),m(h.automaticStyles,"document-styles"),b(h,h.automaticStyles),e=k.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),h.masterStyles=e||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),b(h,h.masterStyles),
c.prefixStyleNames(h.automaticStyles,q,h.masterStyles)):H(d.INVALID)}function F(a){a=v(a);var e,h,n,g;if(a&&"document-content"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI){e=K.rootElement;n=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(e.fontFaceDecls&&n){g=e.fontFaceDecls;var l,p,q,x,E={};h=u(g);x=u(n);for(n=n.firstElementChild;n;){l=n.nextElementSibling;if(n.namespaceURI===f&&"font-face"===n.localName)if(p=n.getAttributeNS(f,
"name"),h.hasOwnProperty(p)){if(!n.isEqualNode(h[p])){q=p;for(var D=h,V=x,F=0,W=void 0,W=q=q.replace(/\d+$/,"");D.hasOwnProperty(W)||V.hasOwnProperty(W);)F+=1,W=q+F;q=W;n.setAttributeNS(f,"style:name",q);g.appendChild(n);h[q]=n;delete x[p];E[p]=q}}else g.appendChild(n),h[p]=n,delete x[p];n=l}g=E}else n&&(e.fontFaceDecls=n,b(e,n));h=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");m(h,"document-content");g&&c.changeFontFaceNames(h,g);if(e.automaticStyles&&h)for(g=
h.firstChild;g;)e.automaticStyles.appendChild(g),g=h.firstChild;else h&&(e.automaticStyles=h,b(e,h));a=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===a)throw"<office:body/> tag is mising.";e.body=a;b(e,e.body)}else H(d.INVALID)}function D(a){a=v(a);var d;a&&"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(d=K.rootElement,d.meta=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),
b(d,d.meta))}function L(a){a=v(a);var d;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(d=K.rootElement,d.settings=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),b(d,d.settings))}function V(a){a=v(a);var b;if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(b=K.rootElement,b.manifest=a,a=b.manifest.firstElementChild;a;)"file-entry"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===
a.namespaceURI&&(ba[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextElementSibling}function Y(a,b,d){a=k.getElementsByTagName(a,b);var c;for(c=0;c<a.length;c+=1)b=a[c],d.hasOwnProperty(b.namespaceURI)||b.parentNode.removeChild(b)}function G(a){Y(a,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});Y(a,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function aa(a){var b=a.firstElementChild,d=[],c,e,h,f=a.attributes,n=f.length;for(c=0;c<n;c+=1)h=f.item(c),e=h.localName.substr(0,2).toLowerCase(),null===h.namespaceURI&&"on"===e&&d.push(h);n=d.length;for(c=
0;c<n;c+=1)a.removeAttributeNode(d[c]);for(;b;)aa(b),b=b.nextElementSibling}function T(a){var b=a.shift();b?S.loadAsDOM(b.path,function(c,e){e&&(G(e),aa(e.documentElement));b.handler(e);K.state===d.INVALID?c?runtime.log("ERROR: Unable to load "+b.path+" - "+c):runtime.log("ERROR: Unable to load "+b.path):(c&&runtime.log("DEBUG: Unable to load "+b.path+" - "+c),T(a))}):(g(K.rootElement),H(d.DONE))}function t(a){var b="";odf.Namespaces.forEachPrefix(function(a,d){b+=" xmlns:"+a+'="'+d+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+
a+" "+b+' office:version="1.2">'}function B(){var a=new xmldom.LSSerializer,b=t("document-meta");a.filter=new odf.OdfNodeFilter;b+=a.writeToString(K.rootElement.meta,odf.Namespaces.namespaceMap);return b+"</office:document-meta>"}function ea(a,b){var d=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");d.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",a);d.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0",
"manifest:media-type",b);return d}function W(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),b=a.documentElement,d=new xmldom.LSSerializer,c;for(c in ba)ba.hasOwnProperty(c)&&b.appendChild(ea(c,ba[c]));d.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+d.writeToString(a,odf.Namespaces.namespaceMap)}function C(){var a,b,d,e=odf.Namespaces.namespaceMap,
h=new xmldom.LSSerializer,f=t("document-styles");b=s(K.rootElement.automaticStyles,"document-styles");d=K.rootElement.masterStyles.cloneNode(!0);a=z(K.rootElement.fontFaceDecls,[d,K.rootElement.styles,b]);c.removePrefixFromStyleNames(b,q,d);h.filter=new l(d,b);f+=h.writeToString(a,e);f+=h.writeToString(K.rootElement.styles,e);f+=h.writeToString(b,e);f+=h.writeToString(d,e);return f+"</office:document-styles>"}function I(){var a,b,d=odf.Namespaces.namespaceMap,c=new xmldom.LSSerializer,h=t("document-content");
b=s(K.rootElement.automaticStyles,"document-content");a=z(K.rootElement.fontFaceDecls,[b]);c.filter=new e(K.rootElement.body,b);h+=c.writeToString(a,d);h+=c.writeToString(b,d);h+=c.writeToString(K.rootElement.body,d);return h+"</office:document-content>"}function Q(a,b){runtime.loadXML(a,function(a,c){if(a)b(a);else if(c){G(c);aa(c.documentElement);var e=v(c);e&&"document"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI?(J(e),H(d.DONE)):H(d.INVALID)}else b("No DOM was loaded.")})}
function A(a,d){var c;c=K.rootElement;var e=c.meta;e||(c.meta=e=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),b(c,e));c=e;a&&k.mapKeyValObjOntoNode(c,a,odf.Namespaces.lookupNamespaceURI);d&&k.removeKeyElementsFromNode(c,d,odf.Namespaces.lookupNamespaceURI)}function P(a){function b(a,d){var c;d||(d=a);c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",d);h[a]=c;h.appendChild(c)}var c=new core.Zip("",null),e=runtime.byteArrayFromString("application/vnd.oasis.opendocument."+
a,"utf8"),h=K.rootElement,f=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",a);c.save("mimetype",e,!1,new Date);b("meta");b("settings");b("scripts");b("fontFaceDecls","font-face-decls");b("styles");b("automaticStyles","automatic-styles");b("masterStyles","master-styles");b("body");h.body.appendChild(f);ba["/"]="application/vnd.oasis.opendocument."+a;ba["settings.xml"]="text/xml";ba["meta.xml"]="text/xml";ba["styles.xml"]="text/xml";ba["content.xml"]="text/xml";H(d.DONE);
return c}function O(){var a,b=new Date,d="";K.rootElement.settings&&K.rootElement.settings.firstElementChild&&(a=new xmldom.LSSerializer,d=t("document-settings"),a.filter=new odf.OdfNodeFilter,d+=a.writeToString(K.rootElement.settings,odf.Namespaces.namespaceMap),d+="</office:document-settings>");(a=d)?(a=runtime.byteArrayFromString(a,"utf8"),S.save("settings.xml",a,!0,b)):S.remove("settings.xml");d=runtime.getWindow();a="WebODF/"+webodf.Version;d&&(a=a+" "+d.navigator.userAgent);A({"meta:generator":a},
null);a=runtime.byteArrayFromString(B(),"utf8");S.save("meta.xml",a,!0,b);a=runtime.byteArrayFromString(C(),"utf8");S.save("styles.xml",a,!0,b);a=runtime.byteArrayFromString(I(),"utf8");S.save("content.xml",a,!0,b);a=runtime.byteArrayFromString(W(),"utf8");S.save("META-INF/manifest.xml",a,!0,b)}function X(a,b){O();S.writeAs(a,function(a){b(a)})}var K=this,S,ba={},Z,$="";this.onstatereadychange=n;this.state=this.onchange=null;this.getMetadata=y;this.setRootElement=J;this.getContentElement=function(){var a;
Z||(a=K.rootElement.body,Z=k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||k.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!Z)throw"Could not find content element in <office:body/>.";return Z};this.getDocumentType=function(){var a=K.getContentElement();return a&&a.localName};this.getPart=function(a){return new odf.OdfPart(a,ba[a],K,S)};this.getPartData=
function(a,b){S.load(a,b)};this.setMetadata=A;this.incrementEditingCycles=function(){var a=y(odf.Namespaces.metans,"editing-cycles"),a=a?parseInt(a,10):0;isNaN(a)&&(a=0);A({"meta:editing-cycles":a+1},null);return a+1};this.createByteArray=function(a,b){O();S.createByteArray(a,b)};this.saveAs=X;this.save=function(a){X($,a)};this.getUrl=function(){return $};this.setBlob=function(a,b,d){d=p.convertBase64ToByteArray(d);S.save(a,d,!1,new Date);ba.hasOwnProperty(a)&&runtime.log(a+" has been overwritten.");
ba[a]=b};this.removeBlob=function(a){var b=S.remove(a);runtime.assert(b,"file is not found: "+a);delete ba[a]};this.state=d.LOADING;this.rootElement=function(a){var b=document.createElementNS(a.namespaceURI,a.localName),d;a=new a.Type;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});a===odf.OdfContainer.DocumentType.TEXT?S=P("text"):a===odf.OdfContainer.DocumentType.PRESENTATION?
S=P("presentation"):a===odf.OdfContainer.DocumentType.SPREADSHEET?S=P("spreadsheet"):($=a,S=new core.Zip($,function(a,b){S=b;a?Q($,function(b){a&&(S.error=a+"\n"+b,H(d.INVALID))}):T([{path:"styles.xml",handler:E},{path:"content.xml",handler:F},{path:"meta.xml",handler:D},{path:"settings.xml",handler:L},{path:"META-INF/manifest.xml",handler:V}])}))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=
5;odf.OdfContainer.getContainer=function(b){return new odf.OdfContainer(b,null)}})();odf.OdfContainer.DocumentType={TEXT:1,PRESENTATION:2,SPREADSHEET:3};odf.OdfUtils=function(){function g(a){return"image"===(a&&a.localName)&&a.namespaceURI===aa}function l(a){return null!==a&&a.nodeType===Node.ELEMENT_NODE&&"frame"===a.localName&&a.namespaceURI===aa&&"as-char"===a.getAttributeNS(G,"anchor-type")}function e(a){var b;(b="annotation"===(a&&a.localName)&&a.namespaceURI===odf.Namespaces.officens)||(b="div"===(a&&a.localName)&&"annotationWrapper"===a.className);return b}function b(a){return"a"===(a&&a.localName)&&a.namespaceURI===G}function c(a){var b=a&&
a.localName;return("p"===b||"h"===b)&&a.namespaceURI===G}function k(a,b){for(a&&void 0!==b&&!c(a)&&a.childNodes.item(b)&&(a=a.childNodes.item(b));a&&!c(a);)a=a.parentNode;return a}function f(a,b){for(;a&&a!==b;){if(a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName)return a;a=a.parentElement}return null}function m(a){return/^[ \t\r\n]+$/.test(a)}function q(a){if(null===a||a.nodeType!==Node.ELEMENT_NODE)return!1;var b=a.localName;return/^(span|p|h|a|meta)$/.test(b)&&a.namespaceURI===
G||"span"===b&&"webodf-annotationHighlight"===a.className}function p(a){var b=a&&a.localName,d=!1;b&&(a=a.namespaceURI,a===G&&(d="s"===b||"tab"===b||"line-break"===b));return d}function r(a){return p(a)||l(a)||e(a)}function d(a){var b=a&&a.localName,d=!1;b&&(a=a.namespaceURI,a===G&&(d="s"===b));return d}function a(a){return-1!==ea.indexOf(a.namespaceURI)}function n(b){if(p(b))return!1;if(q(b.parentNode)&&b.nodeType===Node.TEXT_NODE)return 0===b.textContent.length;for(b=b.firstChild;b;){if(a(b)||!n(b))return!1;
b=b.nextSibling}return!0}function h(a){for(;null!==a.firstChild&&q(a);)a=a.firstChild;return a}function x(a){for(;null!==a.lastChild&&q(a);)a=a.lastChild;return a}function w(a){for(;!c(a)&&null===a.previousSibling;)a=a.parentNode;return c(a)?null:x(a.previousSibling)}function y(a){for(;!c(a)&&null===a.nextSibling;)a=a.parentNode;return c(a)?null:h(a.nextSibling)}function u(a){for(var b=!1;a;)if(a.nodeType===Node.TEXT_NODE)if(0===a.length)a=w(a);else return!m(a.data.substr(a.length-1,1));else r(a)?
(b=!1===d(a),a=null):a=w(a);return b}function s(a){var b=!1,d;for(a=a&&h(a);a;){d=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<d&&!m(a.data)){b=!0;break}if(r(a)){b=!0;break}a=y(a)}return b}function z(a,b){return m(a.data.substr(b))?!s(y(a)):!1}function v(a,b){var d=a.data,c;if(!m(d[b])||r(a.parentNode))return!1;0<b?m(d[b-1])||(c=!0):u(w(a))&&(c=!0);return!0===c?z(a,b)?!1:!0:!1}function H(a){return(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?
{value:parseFloat(a[1]),unit:a[3]}:null}function J(a){return(a=H(a))&&(0>a.value||"%"===a.unit)?null:a}function E(a){return(a=H(a))&&"%"!==a.unit?null:a}function F(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(a.localName){case "cursor":case "editinfo":return!1}}return!0}
function D(a,b){for(;0<b.length&&!B.rangeContainsNode(a,b[0]);)b.shift();for(;0<b.length&&!B.rangeContainsNode(a,b[b.length-1]);)b.pop()}function L(a,b,d){var c;c=B.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;if(p(a.parentNode)||e(a))b=NodeFilter.FILTER_REJECT;else if(a.nodeType===Node.TEXT_NODE){if(d||Boolean(k(a)&&(!m(a.textContent)||v(a,0))))b=NodeFilter.FILTER_ACCEPT}else if(r(a))b=NodeFilter.FILTER_ACCEPT;else if(F(a)||q(a))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT|
NodeFilter.SHOW_TEXT);b||D(a,c);return c}function V(a,b,d){for(;a;){if(d(a)){b[0]!==a&&b.unshift(a);break}if(e(a))break;a=a.parentNode}}function Y(a,b){var d=a;if(b<d.childNodes.length-1)d=d.childNodes[b+1];else{for(;!d.nextSibling;)d=d.parentNode;d=d.nextSibling}for(;d.firstChild;)d=d.firstChild;return d}var G=odf.Namespaces.textns,aa=odf.Namespaces.drawns,T=odf.Namespaces.xlinkns,t=/^\s*$/,B=new core.DomUtils,ea=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,
odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns];this.isImage=g;this.isCharacterFrame=l;this.isInlineRoot=e;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===G};this.isHyperlink=b;this.getHyperlinkTarget=function(a){return a.getAttributeNS(T,"href")||""};this.isParagraph=c;this.getParagraphElement=k;this.isWithinTrackedChanges=
function(a,b){for(;a&&a!==b;){if(a.namespaceURI===G&&"tracked-changes"===a.localName)return!0;a=a.parentNode}return!1};this.getParentAnnotation=f;this.isWithinAnnotation=function(a,b){return Boolean(f(a,b))};this.getAnnotationCreator=function(a){return a.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(a){return"list-item"===(a&&a.localName)&&a.namespaceURI===G};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===G};this.isODFWhitespace=
m;this.isGroupingElement=q;this.isCharacterElement=p;this.isAnchoredAsCharacterElement=r;this.isSpaceElement=d;this.isODFNode=a;this.hasNoODFContent=n;this.firstChild=h;this.lastChild=x;this.previousNode=w;this.nextNode=y;this.scanLeftForNonSpace=u;this.lookLeftForCharacter=function(a){var b,d=b=0;a.nodeType===Node.TEXT_NODE&&(d=a.length);0<d?(b=a.data,b=m(b.substr(d-1,1))?1===d?u(w(a))?2:0:m(b.substr(d-2,1))?0:2:1):r(a)&&(b=1);return b};this.lookRightForCharacter=function(a){var b=!1,d=0;a&&a.nodeType===
Node.TEXT_NODE&&(d=a.length);0<d?b=!m(a.data.substr(0,1)):r(a)&&(b=!0);return b};this.scanLeftForAnyCharacter=function(a){var b=!1,d;for(a=a&&x(a);a;){d=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<d&&!m(a.data)){b=!0;break}if(r(a)){b=!0;break}a=w(a)}return b};this.scanRightForAnyCharacter=s;this.isTrailingWhitespace=z;this.isSignificantWhitespace=v;this.isDowngradableSpaceElement=function(a){return d(a)?u(w(a))&&s(y(a)):!1};this.getFirstNonWhitespaceChild=function(a){for(a=a&&a.firstChild;a&&a.nodeType===
Node.TEXT_NODE&&t.test(a.nodeValue);)a=a.nextSibling;return a};this.parseLength=H;this.parseNonNegativeLength=J;this.parseFoFontSize=function(a){var b;b=(b=H(a))&&(0>=b.value||"%"===b.unit)?null:b;return b||E(a)};this.parseFoLineHeight=function(a){return J(a)||E(a)};this.isTextContentContainingNode=F;this.getTextNodes=function(a,b){var d;d=B.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;a.nodeType===Node.TEXT_NODE?Boolean(k(a)&&(!m(a.textContent)||v(a,0)))&&(b=NodeFilter.FILTER_ACCEPT):
F(a)&&(b=NodeFilter.FILTER_SKIP);return b},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);b||D(a,d);return d};this.getTextElements=L;this.getParagraphElements=function(a){var b;b=B.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;if(c(a))b=NodeFilter.FILTER_ACCEPT;else if(F(a)||q(a))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT);V(a.startContainer,b,c);return b};this.getImageElements=function(a){var b;b=B.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_SKIP;g(a)&&(b=
NodeFilter.FILTER_ACCEPT);return b},NodeFilter.SHOW_ELEMENT);V(a.startContainer,b,g);return b};this.getHyperlinkElements=function(a){var d=[],e=a.cloneRange();a.collapsed&&a.endContainer.nodeType===Node.ELEMENT_NODE&&(a=Y(a.endContainer,a.endOffset),a.nodeType===Node.TEXT_NODE&&e.setEnd(a,1));L(e,!0,!1).forEach(function(a){for(a=a.parentNode;!c(a);){if(b(a)&&-1===d.indexOf(a)){d.push(a);break}a=a.parentNode}});e.detach();return d};this.getNormalizedFontFamilyName=function(a){/^(["'])(?:.|[\n\r])*?\1$/.test(a)||
(a=a.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(a)&&(a="'"+a.replace(/[ \t\r\n\f]+/g," ")+"'"));return a}};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(g,l,e,b){function c(b){var d=b.annotationEndElement,c=p.createRange(),e=b.getAttributeNS(odf.Namespaces.officens,"name");d&&(c.setStart(b,b.childNodes.length),c.setEnd(d,0),b=r.getTextNodes(c,!1),b.forEach(function(b){var d;a:{for(d=b.parentElement;d.namespaceURI!==odf.Namespaces.officens||"body"!==d.localName;){if(d.namespaceURI===a&&"webodf-annotationHighlight"===d.className&&d.getAttribute("annotation")===e){d=!0;break a}d=d.parentNode}d=!1}d||(d=p.createElement("span"),
d.className="webodf-annotationHighlight",d.setAttribute("annotation",e),b.parentNode.replaceChild(d,b),d.appendChild(b))}));c.detach()}function k(a){var b=g.getSizer();a?(e.style.display="inline-block",b.style.paddingRight=d.getComputedStyle(e).width):(e.style.display="none",b.style.paddingRight=0);g.refreshSize()}function f(){q.sort(function(a,b){return 0!==(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function m(){var a;for(a=0;a<q.length;a+=1){var b=q[a],d=b.parentNode,
c=d.nextElementSibling,f=c.nextElementSibling,k=d.parentNode,m=0,m=q[q.indexOf(b)-1],l=void 0,b=g.getZoomLevel();d.style.left=(e.getBoundingClientRect().left-k.getBoundingClientRect().left)/b+"px";d.style.width=e.getBoundingClientRect().width/b+"px";c.style.width=parseFloat(d.style.left)-30+"px";m&&(l=m.parentNode.getBoundingClientRect(),20>=(k.getBoundingClientRect().top-l.bottom)/b?d.style.top=Math.abs(k.getBoundingClientRect().top-l.bottom)/b+20+"px":d.style.top="0px");f.style.left=c.getBoundingClientRect().width/
b+"px";var c=f.style,k=f.getBoundingClientRect().left/b,m=f.getBoundingClientRect().top/b,l=d.getBoundingClientRect().left/b,r=d.getBoundingClientRect().top/b,p=0,J=0,p=l-k,p=p*p,J=r-m,J=J*J,k=Math.sqrt(p+J);c.width=k+"px";m=Math.asin((d.getBoundingClientRect().top-f.getBoundingClientRect().top)/(b*parseFloat(f.style.width)));f.style.transform="rotate("+m+"rad)";f.style.MozTransform="rotate("+m+"rad)";f.style.WebkitTransform="rotate("+m+"rad)";f.style.msTransform="rotate("+m+"rad)"}}var q=[],p=l.ownerDocument,
r=new odf.OdfUtils,d=runtime.getWindow(),a="http://www.w3.org/1999/xhtml";runtime.assert(Boolean(d),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=m;this.rehighlightAnnotations=function(){q.forEach(function(a){c(a)})};this.getMinimumHeightForAnnotationPane=function(){return"none"!==e.style.display&&0<q.length?(q[q.length-1].parentNode.getBoundingClientRect().bottom-e.getBoundingClientRect().top)/g.getZoomLevel()+"px":null};this.addAnnotation=
function(a){k(!0);q.push(a);f();var d=p.createElement("div"),e=p.createElement("div"),g=p.createElement("div"),l=p.createElement("div"),u;d.className="annotationWrapper";d.setAttribute("creator",r.getAnnotationCreator(a));a.parentNode.insertBefore(d,a);e.className="annotationNote";e.appendChild(a);b&&(u=p.createElement("div"),u.className="annotationRemoveButton",e.appendChild(u));g.className="annotationConnector horizontal";l.className="annotationConnector angular";d.appendChild(e);d.appendChild(g);
d.appendChild(l);a.annotationEndElement&&c(a);m()};this.forgetAnnotations=function(){for(;q.length;){var a=q[0],b=q.indexOf(a),d=a.parentNode.parentNode;"div"===d.localName&&(d.parentNode.insertBefore(a,d),d.parentNode.removeChild(d));for(var a=a.getAttributeNS(odf.Namespaces.officens,"name"),a=p.querySelectorAll('span.webodf-annotationHighlight[annotation="'+a+'"]'),c=d=void 0,d=0;d<a.length;d+=1){for(c=a.item(d);c.firstChild;)c.parentNode.insertBefore(c.firstChild,c);c.parentNode.removeChild(c)}-1!==
b&&q.splice(b,1);0===q.length&&k(!1)}}};(function(){function g(c,e,f,m,l){var p,r=0,d;for(d in c)if(c.hasOwnProperty(d)){if(r===f){p=d;break}r+=1}p?e.getPartData(c[p].href,function(a,d){if(a)runtime.log(a);else if(d){var h="@font-face { font-family: "+(c[p].family||p)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+b.convertUTF8ArrayToBase64(d)+') format("truetype"); }';try{m.insertRule(h,m.cssRules.length)}catch(r){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(r)+"\nRule: "+h)}}else runtime.log("missing font data for "+
c[p].href);g(c,e,f+1,m,l)}):l&&l()}var l=xmldom.XPath,e=new odf.OdfUtils,b=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(b,k){for(var f=b.rootElement.fontFaceDecls;k.cssRules.length;)k.deleteRule(k.cssRules.length-1);if(f){var m={},q,p,r,d;if(f)for(f=l.getODFElementsWithXPath(f,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),q=0;q<f.length;q+=1)p=f[q],r=p.getAttributeNS(odf.Namespaces.stylens,"name"),d=e.getNormalizedFontFamilyName(p.getAttributeNS(odf.Namespaces.svgns,
"font-family")),p=l.getODFElementsWithXPath(p,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<p.length&&(p=p[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),m[r]={href:p,family:d});g(m,b,0,k)}}}})();odf.Formatting=function(){function g(a){return(a=H[a])?z.mergeObjects({},a):{}}function l(){for(var a=d.rootElement.fontFaceDecls,b={},c,e,a=a&&a.firstElementChild;a;){if(c=a.getAttributeNS(h,"name"))if((e=a.getAttributeNS(n,"font-family"))||0<a.getElementsByTagNameNS(n,"font-face-uri").length)b[c]=e;a=a.nextElementSibling}return b}function e(a){for(var b=d.rootElement.styles.firstElementChild;b;){if(b.namespaceURI===h&&"default-style"===b.localName&&b.getAttributeNS(h,"family")===a)return b;b=b.nextElementSibling}return null}
function b(a,b,c){var e,f,g;c=c||[d.rootElement.automaticStyles,d.rootElement.styles];for(g=0;g<c.length;g+=1)for(e=c[g],e=e.firstElementChild;e;){f=e.getAttributeNS(h,"name");if(e.namespaceURI===h&&"style"===e.localName&&e.getAttributeNS(h,"family")===b&&f===a||"list-style"===b&&e.namespaceURI===x&&"list-style"===e.localName&&f===a||"data"===b&&e.namespaceURI===w&&f===a)return e;e=e.nextElementSibling}return null}function c(a){for(var b,d,c,e,f={},g=a.firstElementChild;g;){if(g.namespaceURI===h)for(c=
f[g.nodeName]={},d=g.attributes,b=0;b<d.length;b+=1)e=d.item(b),c[e.name]=e.value;g=g.nextElementSibling}d=a.attributes;for(b=0;b<d.length;b+=1)e=d.item(b),f[e.name]=e.value;return f}function k(a,f){for(var n=d.rootElement.styles,k,m={},l=a.getAttributeNS(h,"family"),r=a;r;)k=c(r),m=z.mergeObjects(k,m),r=(k=r.getAttributeNS(h,"parent-style-name"))?b(k,l,[n]):null;if(r=e(l))k=c(r),m=z.mergeObjects(k,m);!1!==f&&(k=g(l),m=z.mergeObjects(k,m));return m}function f(b,d){function c(a){Object.keys(a).forEach(function(b){Object.keys(a[b]).forEach(function(a){g+=
"|"+b+":"+a+"|"})})}for(var e=b.nodeType===Node.TEXT_NODE?b.parentNode:b,h,f=[],g="",n=!1;e;)!n&&u.isGroupingElement(e)&&(n=!0),(h=a.determineStylesForNode(e))&&f.push(h),e=e.parentNode;n&&(f.forEach(c),d&&(d[g]=f));return n?f:void 0}function m(a){var c={orderedStyles:[]};a.forEach(function(a){Object.keys(a).forEach(function(e){var f=Object.keys(a[e])[0],g={name:f,family:e,displayName:void 0,isCommonStyle:!1},n;(n=b(f,e))?(e=k(n),c=z.mergeObjects(e,c),g.displayName=n.getAttributeNS(h,"display-name")||
void 0,g.isCommonStyle=n.parentNode===d.rootElement.styles):runtime.log("No style element found for '"+f+"' of family '"+e+"'");c.orderedStyles.push(g)})});return c}function q(a,b){var d={},c=[];b||(b={});a.forEach(function(a){f(a,d)});Object.keys(d).forEach(function(a){b[a]||(b[a]=m(d[a]));c.push(b[a])});return c}function p(a){for(var b=d.rootElement.masterStyles.firstElementChild;b&&(b.namespaceURI!==h||"master-page"!==b.localName||b.getAttributeNS(h,"name")!==a);)b=b.nextElementSibling;return b}
function r(a,b){var d;a&&(d=v.convertMeasure(a,"px"));void 0===d&&b&&(d=v.convertMeasure(b,"px"));return d}var d,a=new odf.StyleInfo,n=odf.Namespaces.svgns,h=odf.Namespaces.stylens,x=odf.Namespaces.textns,w=odf.Namespaces.numberns,y=odf.Namespaces.fons,u=new odf.OdfUtils,s=new core.DomUtils,z=new core.Utils,v=new core.CSSUnits,H={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=g;this.setOdfContainer=function(a){d=a};this.getFontMap=l;this.getAvailableParagraphStyles=
function(){for(var a=d.rootElement.styles,b,c,e=[],a=a&&a.firstElementChild;a;)"style"===a.localName&&a.namespaceURI===h&&(b=a.getAttributeNS(h,"family"),"paragraph"===b&&(b=a.getAttributeNS(h,"name"),c=a.getAttributeNS(h,"display-name")||b,b&&c&&e.push({name:b,displayName:c}))),a=a.nextElementSibling;return e};this.isStyleUsed=function(b){var c,e=d.rootElement;c=a.hasDerivedStyles(e,odf.Namespaces.lookupNamespaceURI,b);b=(new a.UsedStyleList(e.styles)).uses(b)||(new a.UsedStyleList(e.automaticStyles)).uses(b)||
(new a.UsedStyleList(e.body)).uses(b);return c||b};this.getDefaultStyleElement=e;this.getStyleElement=b;this.getStyleAttributes=c;this.getInheritedStyleAttributes=k;this.getFirstCommonParentStyleNameOrSelf=function(a){var c=d.rootElement.styles,e;if(e=b(a,"paragraph",[d.rootElement.automaticStyles]))if(a=e.getAttributeNS(h,"parent-style-name"),!a)return null;return(e=b(a,"paragraph",[c]))?a:null};this.hasParagraphStyle=function(a){return Boolean(b(a,"paragraph"))};this.getAppliedStyles=q;this.getAppliedStylesForElement=
function(a,b){return q([a],b)[0]};this.updateStyle=function(a,b){var c,e;s.mapObjOntoNode(a,b,odf.Namespaces.lookupNamespaceURI);(c=b["style:text-properties"]&&b["style:text-properties"]["style:font-name"])&&!l().hasOwnProperty(c)&&(e=a.ownerDocument.createElementNS(h,"style:font-face"),e.setAttributeNS(h,"style:name",c),e.setAttributeNS(n,"svg:font-family",c),d.rootElement.fontFaceDecls.appendChild(e))};this.createDerivedStyleObject=function(a,e,h){var f=b(a,e);runtime.assert(Boolean(f),"No style element found for '"+
a+"' of family '"+e+"'");a=f.parentNode===d.rootElement.styles?{"style:parent-style-name":a}:c(f);a["style:family"]=e;z.mergeObjects(a,h);return a};this.getDefaultTabStopDistance=function(){for(var a=e("paragraph"),a=a&&a.firstElementChild,b;a;)a.namespaceURI===h&&"paragraph-properties"===a.localName&&(b=a.getAttributeNS(h,"tab-stop-distance")),a=a.nextElementSibling;b||(b="1.25cm");return u.parseNonNegativeLength(b)};this.getMasterPageElement=p;this.getContentSize=function(a,c){var e,f,g,n,k,m,l,
q,x,w;a:{f=b(a,c);runtime.assert("paragraph"===c||"table"===c,"styleFamily must be either paragraph or table");if(f){if(f=f.getAttributeNS(h,"master-page-name"))(e=p(f))||runtime.log("WARN: No master page definition found for "+f);e||(e=p("Standard"));e||(e=d.rootElement.masterStyles.getElementsByTagNameNS(h,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(e)for(f=e.getAttributeNS(h,"page-layout-name"),g=s.getElementsByTagNameNS(d.rootElement.automaticStyles,h,"page-layout"),
n=0;n<g.length;n+=1)if(e=g[n],e.getAttributeNS(h,"name")===f)break a}e=null}e||(e=s.getDirectChild(d.rootElement.styles,h,"default-page-layout"));(e=s.getDirectChild(e,h,"page-layout-properties"))?("landscape"===e.getAttributeNS(h,"print-orientation")?(f="29.7cm",g="21.001cm"):(f="21.001cm",g="29.7cm"),f=r(e.getAttributeNS(y,"page-width"),f),g=r(e.getAttributeNS(y,"page-height"),g),n=r(e.getAttributeNS(y,"margin")),void 0===n?(n=r(e.getAttributeNS(y,"margin-left"),"2cm"),k=r(e.getAttributeNS(y,"margin-right"),
"2cm"),m=r(e.getAttributeNS(y,"margin-top"),"2cm"),l=r(e.getAttributeNS(y,"margin-bottom"),"2cm")):n=k=m=l=n,q=r(e.getAttributeNS(y,"padding")),void 0===q?(q=r(e.getAttributeNS(y,"padding-left"),"0cm"),x=r(e.getAttributeNS(y,"padding-right"),"0cm"),w=r(e.getAttributeNS(y,"padding-top"),"0cm"),e=r(e.getAttributeNS(y,"padding-bottom"),"0cm")):q=x=w=e=q):(f=r("21.001cm"),g=r("29.7cm"),n=k=m=l=n=r("2cm"),q=x=w=e=q=r("0cm"));return{width:f-n-k-q-x,height:g-m-l-w-e}}};(function(){var g=odf.Namespaces.stylens,l=odf.Namespaces.textns,e={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(b){this.derivedStyles={};this.element=b};odf.StyleTree=function(b,c){function k(b){var d,a,c,e={};if(!b)return e;for(b=b.firstElementChild;b;){if(a=b.namespaceURI!==g||"style"!==b.localName&&
"default-style"!==b.localName?b.namespaceURI===l&&"list-style"===b.localName?"list":b.namespaceURI!==g||"page-layout"!==b.localName&&"default-page-layout"!==b.localName?void 0:"page":b.getAttributeNS(g,"family"))(d=b.getAttributeNS(g,"name"))||(d=""),e.hasOwnProperty(a)?c=e[a]:e[a]=c={},c[d]=b;b=b.nextElementSibling}return e}function f(b,d){if(b.hasOwnProperty(d))return b[d];var a=null,c=Object.keys(b),e;for(e=0;e<c.length&&!(a=f(b[c[e]].derivedStyles,d));e+=1);return a}function m(b,d,a){var c,e,
k;if(!d.hasOwnProperty(b))return null;c=new odf.StyleTreeNode(d[b]);e=c.element.getAttributeNS(g,"parent-style-name");k=null;e&&(k=f(a,e)||m(e,d,a));k?k.derivedStyles[b]=c:a[b]=c;delete d[b];return c}function q(b,d){b&&Object.keys(b).forEach(function(a){m(a,b,d)})}var p={};this.getStyleTree=function(){return p};(function(){var f,d,a;d=k(b);a=k(c);Object.keys(e).forEach(function(b){f=p[b]={};q(d[b],f);q(a[b],f)})})()}})();(function(){var g=odf.Namespaces.fons,l=odf.Namespaces.stylens,e=odf.Namespaces.textns,b={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function c(b){var d=p.parseLength(b);return d?q.convert(d.value,d.unit,"px"):(runtime.log("Could not parse value '"+b+"'."),0)}function k(b,d){try{b.insertRule(d,b.cssRules.length)}catch(a){runtime.log("cannot load rule: "+d+" - "+a)}}function f(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function m(b,
d,a,f){d='text|list[text|style-name="'+d+'"]';var h=a.getAttributeNS(e,"level"),m;m=a.getElementsByTagNameNS(l,"list-level-properties")[0];a=m.getAttributeNS(e,"list-level-position-and-space-mode");for(var p=m.getElementsByTagNameNS(l,"list-level-label-alignment")[0],q,u,s,z,v,h=h&&parseInt(h,10);1<h;)d+=" > text|list-item > text|list",h-=1;h=m.getAttributeNS(g,"text-align")||"left";switch(h){case "end":h="right";break;case "start":h="left"}"label-alignment"===a?(q=p.getAttributeNS(g,"margin-left")||
"0px",z=p.getAttributeNS(g,"text-indent")||"0px",v=p.getAttributeNS(e,"label-followed-by"),p=c(q)):(q=m.getAttributeNS(e,"space-before")||"0px",u=m.getAttributeNS(e,"min-label-width")||"0px",s=m.getAttributeNS(e,"min-label-distance")||"0px",p=c(q)+c(u));m=d+" > text|list-item{";m+="margin-left: "+p+"px;";m+="}";k(b,m);m=d+" > text|list-item > text|list{";m+="margin-left: "+-p+"px;";m+="}";k(b,m);m=d+" > text|list-item > *:not(text|list):first-child:before{";m+="text-align: "+h+";";m+="counter-increment:list;";
m+="display: inline-block;";"label-alignment"===a?(m+="margin-left: "+z+";","space"===v?f+=" '\\a0'":"listtab"===v&&(m+="padding-right: 0.2cm;")):(m+="min-width: "+u+";",m+="margin-left: -"+u+";",m+="padding-right: "+s+";");m+="\n"+f+";\n";m+="}";k(b,m)}var q=new core.CSSUnits,p=new odf.OdfUtils;this.applyListStyles=function(c,d){var a,g;(a=d.list)&&Object.keys(a).forEach(function(d){g=a[d];for(var k=g.element.firstChild,p,q;k;){if(k.namespaceURI===e)if(p=k,"list-level-style-number"===k.localName){var u=
p;q=u.getAttributeNS(l,"num-format");var s=u.getAttributeNS(l,"num-suffix")||"",u=u.getAttributeNS(l,"num-prefix")||"",z="";u&&(z+='"'+f(u)+'"\n');z=b.hasOwnProperty(q)?z+(" counter(list, "+b[q]+")"):q?z+(' "'+q+'"'):z+' ""';q="content:"+z+' "'+f(s)+'"';m(c,d,p,q)}else"list-level-style-image"===k.localName?(q="content: none",m(c,d,p,q)):"list-level-style-bullet"===k.localName&&(q=p.getAttributeNS(e,"bullet-char"),q='content: "'+f(q)+'"',m(c,d,p,q));k=k.nextSibling}})}}})();odf.Style2CSS=function(){function g(a,b,d){var c=[];d=d.derivedStyles;var e;var f=h[a],n;void 0===f?b=null:(n=b?"["+f+'|style-name="'+b+'"]':"","presentation"===f&&(f="draw",n=b?'[presentation|style-name="'+b+'"]':""),b=f+"|"+x[a].join(n+","+f+"|")+n);null!==b&&c.push(b);for(e in d)d.hasOwnProperty(e)&&(b=g(a,e,d[e]),c=c.concat(b));return c}function l(a,b){var d="",c,e,h;for(c=0;c<b.length;c+=1)if(e=b[c],h=a.getAttributeNS(e[0],e[1])){h=h.trim();if(D.hasOwnProperty(e[1])){var f=h.indexOf(" "),g=void 0,
n=void 0;-1!==f?(g=h.substring(0,f),n=h.substring(f)):(g=h,n="");(g=V.parseLength(g))&&"pt"===g.unit&&0.75>g.value&&(h="0.75pt"+n)}e[2]&&(d+=e[2]+":"+h+";")}return d}function e(a){return(a=n.getDirectChild(a,q,"text-properties"))?V.parseFoFontSize(a.getAttributeNS(f,"font-size")):null}function b(a,b,d,c){return b+b+d+d+c+c}function c(h,p,x,D){if("page"===p){var I=D.element;x="";var Q,A;A=Q="";var P=n.getDirectChild(I,q,"page-layout-properties"),O;if(P)if(O=I.getAttributeNS(q,"name"),x+=l(P,E),(Q=
n.getDirectChild(P,q,"background-image"))&&(A=Q.getAttributeNS(d,"href"))&&(x=x+("background-image: url('odfkit:"+A+"');")+l(Q,y)),"presentation"===Y)for(I=(I=n.getDirectChild(I.parentNode.parentNode,m,"master-styles"))&&I.firstElementChild;I;)I.namespaceURI===q&&"master-page"===I.localName&&I.getAttributeNS(q,"page-layout-name")===O&&(A=I.getAttributeNS(q,"name"),Q="draw|page[draw|master-page-name="+A+"] {"+x+"}",A="office|body, draw|page[draw|master-page-name="+A+"] {"+l(P,F)+" }",h.insertRule(Q,
h.cssRules.length),h.insertRule(A,h.cssRules.length)),I=I.nextElementSibling;else"text"===Y&&(Q="office|text {"+x+"}",A="office|body {width: "+P.getAttributeNS(f,"page-width")+";}",h.insertRule(Q,h.cssRules.length),h.insertRule(A,h.cssRules.length))}else{x=g(p,x,D).join(",");P="";if(O=n.getDirectChild(D.element,q,"text-properties")){A=O;var X,K,I=X="";Q=1;O=""+l(A,w);K=A.getAttributeNS(q,"text-underline-style");"solid"===K&&(X+=" underline");K=A.getAttributeNS(q,"text-line-through-style");"solid"===
K&&(X+=" line-through");X.length&&(O+="text-decoration:"+X+";");if(X=A.getAttributeNS(q,"font-name")||A.getAttributeNS(f,"font-family"))K=L[X],O+="font-family: "+(K||X)+";";K=A.parentNode;if(A=e(K)){for(;K;){if(A=e(K)){if("%"!==A.unit){I="font-size: "+A.value*Q+A.unit+";";break}Q*=A.value/100}A=K;X=K="";K=null;"default-style"===A.localName?K=null:(K=A.getAttributeNS(q,"parent-style-name"),X=A.getAttributeNS(q,"family"),K=T.getODFElementsWithXPath(G,K?"//style:*[@style:name='"+K+"'][@style:family='"+
X+"']":"//style:default-style[@style:family='"+X+"']",odf.Namespaces.lookupNamespaceURI)[0])}I||(I="font-size: "+parseFloat(aa)*Q+t.getUnits(aa)+";");O+=I}P+=O}if(O=n.getDirectChild(D.element,q,"paragraph-properties"))I=O,O=""+l(I,u),(Q=n.getDirectChild(I,q,"background-image"))&&(A=Q.getAttributeNS(d,"href"))&&(O=O+("background-image: url('odfkit:"+A+"');")+l(Q,y)),(I=I.getAttributeNS(f,"line-height"))&&"normal"!==I&&(I=V.parseFoLineHeight(I),O="%"!==I.unit?O+("line-height: "+I.value+I.unit+";"):
O+("line-height: "+I.value/100+";")),P+=O;if(O=n.getDirectChild(D.element,q,"graphic-properties"))A=O,O=""+l(A,s),I=A.getAttributeNS(k,"opacity"),Q=A.getAttributeNS(k,"fill"),A=A.getAttributeNS(k,"fill-color"),"solid"===Q||"hatch"===Q?A&&"none"!==A?(I=isNaN(parseFloat(I))?1:parseFloat(I)/100,Q=A.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,b),(A=(Q=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(Q))?{r:parseInt(Q[1],16),g:parseInt(Q[2],16),b:parseInt(Q[3],16)}:null)&&(O+="background-color: rgba("+
A.r+","+A.g+","+A.b+","+I+");")):O+="background: none;":"none"===Q&&(O+="background: none;"),P+=O;if(O=n.getDirectChild(D.element,q,"drawing-page-properties"))I=""+l(O,s),"true"===O.getAttributeNS(a,"background-visible")&&(I+="background: none;"),P+=I;if(O=n.getDirectChild(D.element,q,"table-cell-properties"))O=""+l(O,z),P+=O;if(O=n.getDirectChild(D.element,q,"table-row-properties"))O=""+l(O,H),P+=O;if(O=n.getDirectChild(D.element,q,"table-column-properties"))O=""+l(O,v),P+=O;if(O=n.getDirectChild(D.element,
q,"table-properties"))I=O,O=""+l(I,J),I=I.getAttributeNS(r,"border-model"),"collapsing"===I?O+="border-collapse:collapse;":"separating"===I&&(O+="border-collapse:separate;"),P+=O;0!==P.length&&h.insertRule(x+"{"+P+"}",h.cssRules.length)}for(var S in D.derivedStyles)D.derivedStyles.hasOwnProperty(S)&&c(h,p,S,D.derivedStyles[S])}var k=odf.Namespaces.drawns,f=odf.Namespaces.fons,m=odf.Namespaces.officens,q=odf.Namespaces.stylens,p=odf.Namespaces.svgns,r=odf.Namespaces.tablens,d=odf.Namespaces.xlinkns,
a=odf.Namespaces.presentationns,n=new core.DomUtils,h={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},x={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),
presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background",
"table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),
list:["list-item"]},w=[[f,"color","color"],[f,"background-color","background-color"],[f,"font-weight","font-weight"],[f,"font-style","font-style"]],y=[[q,"repeat","background-repeat"]],u=[[f,"background-color","background-color"],[f,"text-align","text-align"],[f,"text-indent","text-indent"],[f,"padding","padding"],[f,"padding-left","padding-left"],[f,"padding-right","padding-right"],[f,"padding-top","padding-top"],[f,"padding-bottom","padding-bottom"],[f,"border-left","border-left"],[f,"border-right",
"border-right"],[f,"border-top","border-top"],[f,"border-bottom","border-bottom"],[f,"margin","margin"],[f,"margin-left","margin-left"],[f,"margin-right","margin-right"],[f,"margin-top","margin-top"],[f,"margin-bottom","margin-bottom"],[f,"border","border"]],s=[[f,"background-color","background-color"],[f,"min-height","min-height"],[k,"stroke","border"],[p,"stroke-color","border-color"],[p,"stroke-width","border-width"],[f,"border","border"],[f,"border-left","border-left"],[f,"border-right","border-right"],
[f,"border-top","border-top"],[f,"border-bottom","border-bottom"]],z=[[f,"background-color","background-color"],[f,"border-left","border-left"],[f,"border-right","border-right"],[f,"border-top","border-top"],[f,"border-bottom","border-bottom"],[f,"border","border"]],v=[[q,"column-width","width"]],H=[[q,"row-height","height"],[f,"keep-together",null]],J=[[q,"width","width"],[f,"margin-left","margin-left"],[f,"margin-right","margin-right"],[f,"margin-top","margin-top"],[f,"margin-bottom","margin-bottom"]],
E=[[f,"background-color","background-color"],[f,"padding","padding"],[f,"padding-left","padding-left"],[f,"padding-right","padding-right"],[f,"padding-top","padding-top"],[f,"padding-bottom","padding-bottom"],[f,"border","border"],[f,"border-left","border-left"],[f,"border-right","border-right"],[f,"border-top","border-top"],[f,"border-bottom","border-bottom"],[f,"margin","margin"],[f,"margin-left","margin-left"],[f,"margin-right","margin-right"],[f,"margin-top","margin-top"],[f,"margin-bottom","margin-bottom"]],
F=[[f,"page-width","width"],[f,"page-height","height"]],D={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},L={},V=new odf.OdfUtils,Y,G,aa,T=xmldom.XPath,t=new core.CSSUnits;this.style2css=function(a,b,d,e,f){var g,n,k;for(G=b;d.cssRules.length;)d.deleteRule(d.cssRules.length-1);odf.Namespaces.forEachPrefix(function(a,b){g="@namespace "+a+" url("+b+");";try{d.insertRule(g,d.cssRules.length)}catch(c){}});L=e;Y=a;aa=runtime.getWindow().getComputedStyle(document.body,
null).getPropertyValue("font-size")||"12pt";for(k in h)if(h.hasOwnProperty(k))for(n in a=f[k],a)a.hasOwnProperty(n)&&c(d,k,n,a[n])}};(function(){function g(l,e){var b=this;this.getDistance=function(c){var e=b.x-c.x;c=b.y-c.y;return Math.sqrt(e*e+c*c)};this.getCenter=function(c){return new g((b.x+c.x)/2,(b.y+c.y)/2)};b.x=l;b.y=e}gui.ZoomHelper=function(){function l(b,d,c,e){b=e?"translate3d("+b+"px, "+d+"px, 0) scale3d("+c+", "+c+", 1)":"translate("+b+"px, "+d+"px) scale("+c+")";a.style.WebkitTransform=b;a.style.MozTransform=b;a.style.msTransform=b;a.style.OTransform=b;a.style.transform=b}function e(a){a?l(-n.x,-n.y,w,!0):(l(0,
0,w,!0),l(0,0,w,!1))}function b(a){if(s&&E){var b=s.style.overflow,d=s.classList.contains("webodf-customScrollbars");a&&d||!a&&!d||(a?(s.classList.add("webodf-customScrollbars"),s.style.overflow="hidden",runtime.requestAnimationFrame(function(){s.style.overflow=b})):s.classList.remove("webodf-customScrollbars"))}}function c(){l(-n.x,-n.y,w,!0);s.scrollLeft=0;s.scrollTop=0;F=z.style.overflow;z.style.overflow="visible";b(!1)}function k(){l(0,0,w,!0);s.scrollLeft=n.x;s.scrollTop=n.y;z.style.overflow=
F||"";b(!0)}function f(b){return new g(b.pageX-a.offsetLeft,b.pageY-a.offsetTop)}function m(b){h&&(n.x-=b.x-h.x,n.y-=b.y-h.y,n=new g(Math.min(Math.max(n.x,a.offsetLeft),(a.offsetLeft+a.offsetWidth)*w-s.clientWidth),Math.min(Math.max(n.y,a.offsetTop),(a.offsetTop+a.offsetHeight)*w-s.clientHeight)));h=b}function q(a){var b=a.touches.length,d=0<b?f(a.touches[0]):null;a=1<b?f(a.touches[1]):null;d&&a?(x=d.getDistance(a),y=w,h=d.getCenter(a),c(),J=H.PINCH):d&&(h=d,J=H.SCROLL)}function p(b){var d=b.touches.length,
h=0<d?f(b.touches[0]):null,d=1<d?f(b.touches[1]):null;if(h&&d)if(b.preventDefault(),J===H.SCROLL)J=H.PINCH,c(),x=h.getDistance(d);else{b=h.getCenter(d);h=h.getDistance(d)/x;m(b);var d=w,g=Math.min(u,a.offsetParent.clientWidth/a.offsetWidth);w=y*h;w=Math.min(Math.max(w,g),u);h=w/d;n.x+=(h-1)*(b.x+n.x);n.y+=(h-1)*(b.y+n.y);e(!0)}else h&&(J===H.PINCH?(J=H.SCROLL,k()):m(h))}function r(){J===H.PINCH&&(v.emit(gui.ZoomHelper.signalZoomChanged,w),k(),e(!1));J=H.NONE}function d(){s&&(s.removeEventListener("touchstart",
q,!1),s.removeEventListener("touchmove",p,!1),s.removeEventListener("touchend",r,!1))}var a,n,h,x,w,y,u=4,s,z,v=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),H={NONE:0,SCROLL:1,PINCH:2},J=H.NONE,E=runtime.getWindow().hasOwnProperty("ontouchstart"),F="";this.subscribe=function(a,b){v.subscribe(a,b)};this.unsubscribe=function(a,b){v.unsubscribe(a,b)};this.getZoomLevel=function(){return w};this.setZoomLevel=function(b){a&&(w=b,e(!1),v.emit(gui.ZoomHelper.signalZoomChanged,w))};this.destroy=
function(a){d();b(!1);a()};this.setZoomableElement=function(c){d();a=c;s=a.offsetParent;z=a.parentElement;e(!1);s&&(s.addEventListener("touchstart",q,!1),s.addEventListener("touchmove",p,!1),s.addEventListener("touchend",r,!1));b(!0)};y=w=1;n=new g(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};(function(){function g(){function a(c){d=!0;runtime.setTimeout(function(){try{c()}catch(e){runtime.log(String(e)+"\n"+e.stack)}d=!1;0<b.length&&a(b.pop())},10)}var b=[],d=!1;this.clearQueue=function(){b.length=0};this.addToQueue=function(c){if(0===b.length&&!d)return a(c);b.push(c)}}function l(a){function b(){for(;0<d.cssRules.length;)d.deleteRule(0);d.insertRule("#shadowContent draw|page {display:none;}",0);d.insertRule("office|presentation draw|page {display:none;}",1);d.insertRule("#shadowContent draw|page:nth-of-type("+
c+") {display:block;}",2);d.insertRule("office|presentation draw|page:nth-of-type("+c+") {display:block;}",3)}var d=a.sheet,c=1;this.showFirstPage=function(){c=1;b()};this.showNextPage=function(){c+=1;b()};this.showPreviousPage=function(){1<c&&(c-=1,b())};this.showPage=function(a){0<a&&(c=a,b())};this.css=a;this.destroy=function(b){a.parentNode.removeChild(a);b()}}function e(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function b(a){a=a.sheet;for(var b=a.cssRules;b.length;)a.deleteRule(b.length-
1)}function c(a,b,d){var c=new odf.Style2CSS,e=new odf.ListStyleToCss;d=d.sheet;var h=(new odf.StyleTree(a.rootElement.styles,a.rootElement.automaticStyles)).getStyleTree();c.style2css(a.getDocumentType(),a.rootElement,d,b.getFontMap(),h);e.applyListStyles(d,h)}function k(a,b){(new odf.FontLoader).loadFonts(a,b.sheet)}function f(a,b,d){var c=null;a=a.rootElement.body.getElementsByTagNameNS(Y,d+"-decl");d=b.getAttributeNS(Y,"use-"+d+"-name");var e;if(d&&0<a.length)for(b=0;b<a.length;b+=1)if(e=a[b],
e.getAttributeNS(Y,"name")===d){c=e.textContent;break}return c}function m(a,b,d,c){var h=a.ownerDocument;b=a.getElementsByTagNameNS(b,d);for(a=0;a<b.length;a+=1)e(b[a]),c&&(d=b[a],d.appendChild(h.createTextNode(c)))}function q(a,b,d){b.setAttributeNS("urn:webodf:names:helper","styleid",a);var c,e=b.getAttributeNS(D,"anchor-type"),h=b.getAttributeNS(E,"x"),f=b.getAttributeNS(E,"y"),g=b.getAttributeNS(E,"width"),n=b.getAttributeNS(E,"height"),k=b.getAttributeNS(v,"min-height"),m=b.getAttributeNS(v,
"min-width");if("as-char"===e)c="display: inline-block;";else if(e||h||f)c="position: absolute;";else if(g||n||k||m)c="display: block;";h&&(c+="left: "+h+";");f&&(c+="top: "+f+";");g&&(c+="width: "+g+";");n&&(c+="height: "+n+";");k&&(c+="min-height: "+k+";");m&&(c+="min-width: "+m+";");c&&(c="draw|"+b.localName+'[webodfhelper|styleid="'+a+'"] {'+c+"}",d.insertRule(c,d.cssRules.length))}function p(a){for(a=a.firstChild;a;){if(a.namespaceURI===H&&"binary-data"===a.localName)return"data:image/png;base64,"+
a.textContent.replace(/[\r\n\s]/g,"");a=a.nextSibling}return""}function r(a,b,d,c){function e(b){b&&(b='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+b+");")+"}",c.insertRule(b,c.cssRules.length))}function h(a){e(a.url)}d.setAttributeNS("urn:webodf:names:helper","styleid",a);var f=d.getAttributeNS(L,"href"),g;if(f)try{g=b.getPart(f),g.onchange=h,g.load()}catch(n){runtime.log("slight problem: "+String(n))}else f=p(d),e(f)}function d(a){var b=a.ownerDocument;t.getElementsByTagNameNS(a,
D,"line-break").forEach(function(a){a.hasChildNodes()||a.appendChild(b.createElement("br"))})}function a(a){var b=a.ownerDocument;t.getElementsByTagNameNS(a,D,"s").forEach(function(a){for(var d,c;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b.createTextNode(" "));c=parseInt(a.getAttributeNS(D,"c"),10);if(1<c)for(a.removeAttributeNS(D,"c"),d=1;d<c;d+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function n(a){t.getElementsByTagNameNS(a,D,"tab").forEach(function(a){a.textContent="\t"})}
function h(a,b){function d(a,c){var f=g.documentElement.namespaceURI;"video/"===c.substr(0,6)?(e=g.createElementNS(f,"video"),e.setAttribute("controls","controls"),h=g.createElementNS(f,"source"),a&&h.setAttribute("src",a),h.setAttribute("type",c),e.appendChild(h),b.parentNode.appendChild(e)):b.innerHtml="Unrecognised Plugin"}function c(a){d(a.url,a.mimetype)}var e,h,f,g=b.ownerDocument,n;if(f=b.getAttributeNS(L,"href"))try{n=a.getPart(f),n.onchange=c,n.load()}catch(k){runtime.log("slight problem: "+
String(k))}else runtime.log("using MP4 data fallback"),f=p(b),d(f,"video/mp4")}function x(a,b){try{a.insertRule(b,a.cssRules.length)}catch(d){runtime.log("cannot load rule: "+b+" - "+d)}}function w(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function y(a){var b=a.getElementsByTagName("head")[0],d,c;d=a.styleSheets.length;for(c=b.firstElementChild;c&&("style"!==c.localName||!c.hasAttribute("webodfcss"));)c=c.nextElementSibling;if(c)return d=parseInt(c.getAttribute("webodfcss"),10),c.setAttribute("webodfcss",
d+1),c;"string"===String(typeof webodf_css)?d=webodf_css:(c="webodf.css",runtime.currentDirectory&&(c=runtime.currentDirectory(),0<c.length&&"/"!==c.substr(-1)&&(c+="/"),c+="../webodf.css"),d=runtime.readFileSync(c,"utf-8"));c=a.createElementNS(b.namespaceURI,"style");c.setAttribute("media","screen, print, handheld, projection");c.setAttribute("type","text/css");c.setAttribute("webodfcss","1");c.appendChild(a.createTextNode(d));b.appendChild(c);return c}function u(a){var b=parseInt(a.getAttribute("webodfcss"),
10);1===b?a.parentNode.removeChild(a):a.setAttribute("count",b-1)}function s(a){var b=a.getElementsByTagName("head")[0],d=a.createElementNS(b.namespaceURI,"style"),c="";d.setAttribute("type","text/css");d.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(a,b){c+="@namespace "+a+" url("+b+");\n"});c+="@namespace webodfhelper url(urn:webodf:names:helper);\n";d.appendChild(a.createTextNode(c));b.appendChild(d);return d}var z=odf.Namespaces.drawns,v=odf.Namespaces.fons,
H=odf.Namespaces.officens,J=odf.Namespaces.stylens,E=odf.Namespaces.svgns,F=odf.Namespaces.tablens,D=odf.Namespaces.textns,L=odf.Namespaces.xlinkns,V=odf.Namespaces.xmlns,Y=odf.Namespaces.presentationns,G=runtime.getWindow(),aa=xmldom.XPath,T=new odf.OdfUtils,t=new core.DomUtils;odf.OdfCanvas=function(p){function E(a,b,d){function c(a,b,d,e){la.addToQueue(function(){r(a,b,d,e)})}var e,h;e=b.getElementsByTagNameNS(z,"image");for(b=0;b<e.length;b+=1)h=e.item(b),c("image"+String(b),a,h,d)}function v(a,
b){function d(a,b){la.addToQueue(function(){h(a,b)})}var c,e,f;e=b.getElementsByTagNameNS(z,"plugin");for(c=0;c<e.length;c+=1)f=e.item(c),d(a,f)}function L(){var a;a=Z.firstChild;var b=ga.getZoomLevel();a&&(Z.style.WebkitTransformOrigin="0% 0%",Z.style.MozTransformOrigin="0% 0%",Z.style.msTransformOrigin="0% 0%",Z.style.OTransformOrigin="0% 0%",Z.style.transformOrigin="0% 0%",ca&&((a=ca.getMinimumHeightForAnnotationPane())?Z.style.minHeight=a:Z.style.removeProperty("min-height")),p.style.width=Math.round(b*
Z.offsetWidth)+"px",p.style.height=Math.round(b*Z.offsetHeight)+"px",p.style.display="inline-block")}function I(b,c){var h=ja.sheet;e(p);Z=X.createElementNS(p.namespaceURI,"div");Z.style.display="inline-block";Z.style.background="white";Z.style.setProperty("float","left","important");Z.appendChild(c);p.appendChild(Z);$=X.createElementNS(p.namespaceURI,"div");$.id="annotationsPane";ha=X.createElementNS(p.namespaceURI,"div");ha.id="shadowContent";ha.style.position="absolute";ha.style.top=0;ha.style.left=
0;b.getContentElement().appendChild(ha);var g=c.body,k,l=[],r;for(k=g.firstElementChild;k&&k!==g;)if(k.namespaceURI===z&&(l[l.length]=k),k.firstElementChild)k=k.firstElementChild;else{for(;k&&k!==g&&!k.nextElementSibling;)k=k.parentNode;k&&k.nextElementSibling&&(k=k.nextElementSibling)}for(r=0;r<l.length;r+=1)k=l[r],q("frame"+String(r),k,h);l=aa.getODFElementsWithXPath(g,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(k=0;k<l.length;k+=1)g=l[k],g.setAttributeNS&&g.setAttributeNS("urn:webodf:names:helper",
"containsparagraphanchor",!0);g=S;k=ha;var s,u,L,y;y=0;var t,A;r=b.rootElement.ownerDocument;if((l=c.body.firstElementChild)&&l.namespaceURI===H&&("presentation"===l.localName||"drawing"===l.localName))for(l=l.firstElementChild;l;){if(s=(s=l.getAttributeNS(z,"master-page-name"))?g.getMasterPageElement(s):null){u=l.getAttributeNS("urn:webodf:names:helper","styleid");L=r.createElementNS(z,"draw:page");A=s.firstElementChild;for(t=0;A;)"true"!==A.getAttributeNS(Y,"placeholder")&&(y=A.cloneNode(!0),L.appendChild(y),
q(u+"_"+t,y,h)),A=A.nextElementSibling,t+=1;A=t=y=void 0;var K=L.getElementsByTagNameNS(z,"frame");for(y=0;y<K.length;y+=1)t=K[y],(A=t.getAttributeNS(Y,"class"))&&!/^(date-time|footer|header|page-number)$/.test(A)&&t.parentNode.removeChild(t);k.appendChild(L);y=String(k.getElementsByTagNameNS(z,"page").length);m(L,D,"page-number",y);m(L,Y,"header",f(b,l,"header"));m(L,Y,"footer",f(b,l,"footer"));q(u,L,h);L.setAttributeNS(z,"draw:master-page-name",s.getAttributeNS(J,"name"))}l=l.nextElementSibling}g=
p.namespaceURI;l=c.body.getElementsByTagNameNS(F,"table-cell");for(k=0;k<l.length;k+=1)r=l.item(k),r.hasAttributeNS(F,"number-columns-spanned")&&r.setAttributeNS(g,"colspan",r.getAttributeNS(F,"number-columns-spanned")),r.hasAttributeNS(F,"number-rows-spanned")&&r.setAttributeNS(g,"rowspan",r.getAttributeNS(F,"number-rows-spanned"));d(c.body);a(c.body);n(c.body);E(b,c.body,h);v(b,c.body);s=c.body;g=p.namespaceURI;l={};r={};var C;u=G.document.getElementsByTagNameNS(D,"list-style");for(k=0;k<u.length;k+=
1)t=u.item(k),(A=t.getAttributeNS(J,"name"))&&(r[A]=t);s=s.getElementsByTagNameNS(D,"list");for(k=0;k<s.length;k+=1)if(t=s.item(k),u=t.getAttributeNS(V,"id")){L=t.getAttributeNS(D,"continue-list");t.setAttributeNS(g,"id",u);y="text|list#"+u+" > text|list-item > *:first-child:before {";if(A=t.getAttributeNS(D,"style-name")){t=r[A];C=T.getFirstNonWhitespaceChild(t);t=void 0;if(C)if("list-level-style-number"===C.localName){A=C;C=A.getAttributeNS(J,"num-format");t=A.getAttributeNS(J,"num-suffix")||"";
A=A.getAttributeNS(J,"num-prefix")||"";var K="",K={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"},I=void 0;A&&(I='"'+w(A)+'"\n');I=K.hasOwnProperty(C)?I+(" counter(list, "+K[C]+")"):C?I+("'"+C+"';"):I+' ""';t&&(I+=' "'+w(t)+'"');t=K="content:"+I+";"}else"list-level-style-image"===C.localName?t="content: none;":"list-level-style-bullet"===C.localName&&(C=C.getAttributeNS(D,"bullet-char"),t='content: "'+w(C)+'"\n;');C=t;C="\n"+C+"\n"}if(L){for(t=l[L];t;)t=l[t];y+="counter-increment:"+
L+";";C?(C=C.replace("list",L),y+=C):y+="content:counter("+L+");"}else L="",C?(C=C.replace("list",u),y+=C):y+="content: counter("+u+");",y+="counter-increment:"+u+";",x(h,"text|list#"+u+" {counter-reset:"+u+"}");y+="}";l[u]=L;y&&x(h,y)}Z.insertBefore(ha,Z.firstChild);ga.setZoomableElement(Z)}function Q(a){R?($.parentNode||Z.appendChild($),ca&&ca.forgetAnnotations(),ca=new gui.AnnotationViewManager(O,a.body,$,na),t.getElementsByTagNameNS(a.body,H,"annotation").forEach(ca.addAnnotation),ca.rerenderAnnotations(),
L()):$.parentNode&&(Z.removeChild($),ca.forgetAnnotations(),L())}function A(a){function d(){b(fa);b(qa);b(ja);e(p);p.style.display="inline-block";var h=K.rootElement;p.ownerDocument.importNode(h,!0);S.setOdfContainer(K);k(K,fa);c(K,S,qa);I(K,h);Q(h);a||la.addToQueue(function(){var a=[K];if(ka.hasOwnProperty("statereadychange")){var b=ka.statereadychange,d;for(d=0;d<b.length;d+=1)b[d].apply(null,a)}})}K.state===odf.OdfContainer.DONE?d():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),
oa=runtime.setTimeout(function N(){K.state===odf.OdfContainer.DONE?d():(runtime.log("will be back later..."),oa=runtime.setTimeout(N,500))},100))}function P(a){la.clearQueue();p.innerHTML=runtime.tr("Loading")+" "+a+"...";p.removeAttribute("style");K=new odf.OdfContainer(a,function(a){K=a;A(!1)})}runtime.assert(null!==p&&void 0!==p,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==p.ownerDocument&&void 0!==p.ownerDocument,"odf.OdfCanvas constructor needs DOM");var O=this,X=p.ownerDocument,
K,S=new odf.Formatting,ba,Z=null,$=null,R=!1,na=!1,ca=null,da,fa,qa,ja,ha,ka={},oa,pa,ia=!1,ma=!1,la=new g,ga=new gui.ZoomHelper;this.refreshCSS=function(){ia=!0;pa.trigger()};this.refreshSize=function(){pa.trigger()};this.odfContainer=function(){return K};this.setOdfContainer=function(a,b){K=a;A(!0===b)};this.load=this.load=P;this.save=function(a){K.save(a)};this.addListener=function(a,b){switch(a){case "click":var d=p,c=a;d.addEventListener?d.addEventListener(c,b,!1):d.attachEvent?d.attachEvent("on"+
c,b):d["on"+c]=b;break;default:d=ka.hasOwnProperty(a)?ka[a]:ka[a]=[],b&&-1===d.indexOf(b)&&d.push(b)}};this.getFormatting=function(){return S};this.getAnnotationViewManager=function(){return ca};this.refreshAnnotations=function(){Q(K.rootElement)};this.rerenderAnnotations=function(){ca&&(ma=!0,pa.trigger())};this.getSizer=function(){return Z};this.enableAnnotations=function(a,b){a!==R&&(R=a,na=b,K&&Q(K.rootElement))};this.addAnnotation=function(a){ca&&(ca.addAnnotation(a),L())};this.forgetAnnotations=
function(){ca&&(ca.forgetAnnotations(),L())};this.getZoomHelper=function(){return ga};this.setZoomLevel=function(a){ga.setZoomLevel(a)};this.getZoomLevel=function(){return ga.getZoomLevel()};this.fitToContainingElement=function(a,b){var d=ga.getZoomLevel(),c=p.offsetHeight/d,d=a/(p.offsetWidth/d);b/c<d&&(d=b/c);ga.setZoomLevel(d)};this.fitToWidth=function(a){var b=p.offsetWidth/ga.getZoomLevel();ga.setZoomLevel(a/b)};this.fitSmart=function(a,b){var d,c;c=ga.getZoomLevel();d=p.offsetWidth/c;c=p.offsetHeight/
c;d=a/d;void 0!==b&&b/c<d&&(d=b/c);ga.setZoomLevel(Math.min(1,d))};this.fitToHeight=function(a){var b=p.offsetHeight/ga.getZoomLevel();ga.setZoomLevel(a/b)};this.showFirstPage=function(){ba.showFirstPage()};this.showNextPage=function(){ba.showNextPage()};this.showPreviousPage=function(){ba.showPreviousPage()};this.showPage=function(a){ba.showPage(a);L()};this.getElement=function(){return p};this.addCssForFrameWithImage=function(a){var b=a.getAttributeNS(z,"name"),d=a.firstElementChild;q(b,a,ja.sheet);
d&&r(b+"img",K,d,ja.sheet)};this.destroy=function(a){var b=X.getElementsByTagName("head")[0],d=[ba.destroy,pa.destroy];runtime.clearTimeout(oa);$&&$.parentNode&&$.parentNode.removeChild($);ga.destroy(function(){Z&&(p.removeChild(Z),Z=null)});u(da);b.removeChild(fa);b.removeChild(qa);b.removeChild(ja);core.Async.destroyAll(d,a)};da=y(X);ba=new l(s(X));fa=s(X);qa=s(X);ja=s(X);pa=core.Task.createRedrawTask(function(){ia&&(c(K,S,qa),ia=!1);ma&&(ca&&ca.rerenderAnnotations(),ma=!1);L()});ga.subscribe(gui.ZoomHelper.signalZoomChanged,
L)}})();odf.StepUtils=function(){this.getContentBounds=function(g){var l=g.container(),e,b;runtime.assert(g.isStep(),"Step iterator must be on a step");l.nodeType===Node.TEXT_NODE&&0<g.offset()?e=g.offset():(l=g.leftNode())&&l.nodeType===Node.TEXT_NODE&&(e=l.length);l&&(l.nodeType===Node.TEXT_NODE?(runtime.assert(0<e,"Empty text node found"),b={container:l,startOffset:e-1,endOffset:e}):b={container:l,startOffset:0,endOffset:l.childNodes.length});return b}};ops.MemberProperties=function(){};
ops.Member=function(g,l){var e=new ops.MemberProperties;this.getMemberId=function(){return g};this.getProperties=function(){return e};this.setProperties=function(b){Object.keys(b).forEach(function(c){e[c]=b[c]})};this.removeProperties=function(b){Object.keys(b).forEach(function(b){"fullName"!==b&&"color"!==b&&"imageUrl"!==b&&e.hasOwnProperty(b)&&delete e[b]})};runtime.assert(Boolean(g),"No memberId was supplied!");l.fullName||(l.fullName=runtime.tr("Unknown Author"));l.color||(l.color="black");l.imageUrl||
(l.imageUrl="avatar-joe.png");e=l};gui.SelectionMover=function(g,l){function e(){r.setUnfilteredPosition(g.getNode(),0);return r}function b(a,b){var d,c=null;a&&0<a.length&&(d=b?a.item(a.length-1):a.item(0));d&&(c={top:d.top,left:b?d.right:d.left,bottom:d.bottom});return c}function c(a,d,e,f){var g=a.nodeType;e.setStart(a,d);e.collapse(!f);f=b(e.getClientRects(),!0===f);!f&&0<d&&(e.setStart(a,d-1),e.setEnd(a,d),f=b(e.getClientRects(),!0));f||(g===Node.ELEMENT_NODE&&0<d&&a.childNodes.length>=d?f=c(a,d-1,e,!0):a.nodeType===Node.TEXT_NODE&&
0<d?f=c(a,d-1,e,!0):a.previousSibling?f=c(a.previousSibling,a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling.textContent.length:a.previousSibling.childNodes.length,e,!0):a.parentNode&&a.parentNode!==l?f=c(a.parentNode,0,e,!1):(e.selectNode(l),f=b(e.getClientRects(),!1)));runtime.assert(Boolean(f),"No visible rectangle found");return f}function k(a,b,c){for(var f=e(),g=new core.LoopWatchDog(1E4),k=0,m=0;0<a&&f.nextPosition();)g.check(),c.acceptPosition(f)===d&&(k+=1,b.acceptPosition(f)===
d&&(m+=k,k=0,a-=1));return m}function f(a,b,c){for(var f=e(),g=new core.LoopWatchDog(1E4),k=0,m=0;0<a&&f.previousPosition();)g.check(),c.acceptPosition(f)===d&&(k+=1,b.acceptPosition(f)===d&&(m+=k,k=0,a-=1));return m}function m(a,b){var h=e(),f=0,g=0,k=0>a?-1:1;for(a=Math.abs(a);0<a;){for(var m=b,p=k,q=h,r=q.container(),H=0,J=null,E=void 0,F=10,D=void 0,L=0,V=void 0,Y=void 0,G=void 0,D=void 0,aa=l.ownerDocument.createRange(),T=new core.LoopWatchDog(1E4),D=c(r,q.unfilteredDomOffset(),aa),V=D.top,Y=
D.left,G=V;!0===(0>p?q.previousPosition():q.nextPosition());)if(T.check(),m.acceptPosition(q)===d&&(H+=1,r=q.container(),D=c(r,q.unfilteredDomOffset(),aa),D.top!==V)){if(D.top!==G&&G!==V)break;G=D.top;D=Math.abs(Y-D.left);if(null===J||D<F)J=r,E=q.unfilteredDomOffset(),F=D,L=H}null!==J?(q.setUnfilteredPosition(J,E),H=L):H=0;aa.detach();f+=H;if(0===f)break;g+=f;a-=1}return g*k}function q(a,b){var h,f,g,k,m=e(),q=p.getParagraphElement(m.getCurrentNode()),r=0,v=l.ownerDocument.createRange();0>a?(h=m.previousPosition,
f=-1):(h=m.nextPosition,f=1);for(g=c(m.container(),m.unfilteredDomOffset(),v);h.call(m);)if(b.acceptPosition(m)===d){if(p.getParagraphElement(m.getCurrentNode())!==q)break;k=c(m.container(),m.unfilteredDomOffset(),v);if(k.bottom!==g.bottom&&(g=k.top>=g.top&&k.bottom<g.bottom||k.top<=g.top&&k.bottom>g.bottom,!g))break;r+=f;g=k}v.detach();return r}var p=new odf.OdfUtils,r,d=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.getStepCounter=function(){return{convertForwardStepsBetweenFilters:k,convertBackwardStepsBetweenFilters:f,
countLinesSteps:m,countStepsToLineBoundary:q}};(function(){r=gui.SelectionMover.createPositionIterator(l);var a=l.ownerDocument.createRange();a.setStart(r.container(),r.unfilteredDomOffset());a.collapse(!0);g.setSelectedRange(a)})()};
gui.SelectionMover.createPositionIterator=function(g){var l=new function(){this.acceptNode=function(e){return e&&"urn:webodf:names:cursor"!==e.namespaceURI&&"urn:webodf:names:editinfo"!==e.namespaceURI?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}};return new core.PositionIterator(g,5,l,!1)};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(g){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(g){};ops.Document.prototype.subscribe=function(g,l){};ops.Document.prototype.unsubscribe=function(g,l){};
ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(g){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";ops.OdtCursor=function(g,l){var e=this,b={},c,k,f,m=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){f.remove()};this.subscribe=function(b,c){m.subscribe(b,c)};this.unsubscribe=function(b,c){m.unsubscribe(b,c)};this.getStepCounter=function(){return k.getStepCounter()};this.getMemberId=function(){return g};this.getNode=function(){return f.getNode()};this.getAnchorNode=function(){return f.getAnchorNode()};this.getSelectedRange=function(){return f.getSelectedRange()};
this.setSelectedRange=function(b,c){f.setSelectedRange(b,c);m.emit(ops.OdtCursor.signalCursorUpdated,e)};this.hasForwardSelection=function(){return f.hasForwardSelection()};this.getDocument=function(){return l};this.getSelectionType=function(){return c};this.setSelectionType=function(e){b.hasOwnProperty(e)?c=e:runtime.log("Invalid selection type: "+e)};this.resetSelectionType=function(){e.setSelectionType(ops.OdtCursor.RangeSelection)};f=new core.Cursor(l.getDOMDocument(),g);k=new gui.SelectionMover(f,
l.getRootNode());b[ops.OdtCursor.RangeSelection]=!0;b[ops.OdtCursor.RegionSelection]=!0;e.resetSelectionType()};ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";(function(){var g=0;ops.StepsCache=function(l,e,b){function c(a,d){var c=this;this.nodeId=a;this.steps=-1;this.node=d;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setPositionBeforeElement(d);b(c.steps,a)}}function k(a,d,c){var e=this;this.nodeId=a;this.steps=d;this.node=c;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setUnfilteredPosition(c,0);b(e.steps,a)}}function f(a,b){var d="["+a.nodeId;b&&(d+=" => "+b.nodeId);return d+
"]"}function m(){for(var a=y,b,d,c,e=new core.LoopWatchDog(0,1E5),g={};a;){e.check();(b=a.previousBookmark)?runtime.assert(b.nextBookmark===a,"Broken bookmark link to previous @"+f(b,a)):(runtime.assert(a===y,"Broken bookmark link @"+f(a)),runtime.assert(void 0===u||y===y||y.steps<=u,"Base point is damaged @"+f(a)));(d=a.nextBookmark)&&runtime.assert(d.previousBookmark===a,"Broken bookmark link to next @"+f(a,d));if(void 0===u||a===y||a.steps<=u)runtime.assert(w.containsNode(l,a.node),"Disconnected node is being reported as undamaged @"+
f(a)),b&&(c=a.node.compareDocumentPosition(b.node),runtime.assert(0===c||0!==(c&z),"Bookmark order with previous does not reflect DOM order @"+f(b,a))),d&&w.containsNode(l,d.node)&&(c=a.node.compareDocumentPosition(d.node),runtime.assert(0===c||0!==(c&s),"Bookmark order with next does not reflect DOM order @"+f(a,d)));a=a.nextBookmark}Object.keys(h).forEach(function(a){var b=h[a];(void 0===u||a<=u)&&runtime.assert(b.steps<=a,"Bookmark step of "+b.steps+" exceeds cached step lookup for "+a+" @"+f(b));
runtime.assert(!1===g.hasOwnProperty(b.nodeId),"Bookmark "+f(b)+" appears twice in cached step lookup at steps "+g[b.nodeId]+" and "+a);g[b.nodeId]=a})}function q(a){var b="";a.nodeType===Node.ELEMENT_NODE&&(b=a.getAttributeNS(n,"nodeId")||"");return b}function p(a){var b=g.toString();a.setAttributeNS(n,"nodeId",b);g+=1;return b}function r(a){var b,d,c=new core.LoopWatchDog(0,1E4);void 0!==u&&a>u&&(a=u);for(b=Math.floor(a/e)*e;!d&&0<=b;)d=h[b],b-=e;for(d=d||y;d.nextBookmark&&d.nextBookmark.steps<=
a;)c.check(),d=d.nextBookmark;runtime.assert(-1===a||d.steps<=a,"Bookmark @"+f(d)+" at step "+d.steps+" exceeds requested step of "+a);return d}function d(a){a.previousBookmark&&(a.previousBookmark.nextBookmark=a.nextBookmark);a.nextBookmark&&(a.nextBookmark.previousBookmark=a.previousBookmark)}function a(a){for(var b,d=null;!d&&a&&a!==l;)(b=q(a))&&(d=x[b])&&d.node!==a&&(runtime.log("Cloned node detected. Creating new bookmark"),d=null,a.removeAttributeNS(n,"nodeId")),a=a.parentNode;return d}var n=
"urn:webodf:names:steps",h={},x={},w=new core.DomUtils,y,u,s=Node.DOCUMENT_POSITION_FOLLOWING,z=Node.DOCUMENT_POSITION_PRECEDING,v;this.updateBookmark=function(a,b){var f,g=Math.ceil(a/e)*e,k,n,m;if(void 0!==u&&u<a){k=r(u);for(n=k.nextBookmark;n&&n.steps<=a;)f=n.nextBookmark,m=Math.ceil(n.steps/e)*e,h[m]===n&&delete h[m],w.containsNode(l,n.node)?n.steps=a+1:(d(n),delete x[n.nodeId]),n=f;u=a}else k=r(a);n=q(b)||p(b);f=x[n];f?f.node!==b&&(runtime.log("Cloned node detected. Creating new bookmark"),n=
p(b),f=x[n]=new c(n,b)):f=x[n]=new c(n,b);n=f;n.steps!==a&&(f=Math.ceil(n.steps/e)*e,f!==g&&h[f]===n&&delete h[f],n.steps=a);if(k!==n&&k.nextBookmark!==n){if(k.steps===n.steps)for(;0!==(n.node.compareDocumentPosition(k.node)&s)&&k!==y;)k=k.previousBookmark;k!==n&&k.nextBookmark!==n&&(d(n),f=k.nextBookmark,n.nextBookmark=k.nextBookmark,n.previousBookmark=k,k.nextBookmark=n,f&&(f.previousBookmark=n))}k=h[g];if(!k||n.steps>k.steps)h[g]=n;v()};this.setToClosestStep=function(a,b){var d;v();d=r(a);d.setIteratorPosition(b);
return d.steps};this.setToClosestDomPoint=function(b,d,c){var e,f;v();if(b===l&&0===d)e=y;else if(b===l&&d===l.childNodes.length)for(f in e=y,h)h.hasOwnProperty(f)&&(b=h[f],b.steps>e.steps&&(e=b));else if(e=a(b.childNodes.item(d)||b),!e)for(c.setUnfilteredPosition(b,d);!e&&c.previousNode();)e=a(c.getCurrentNode());e=e||y;void 0!==u&&e.steps>u&&(e=r(u));e.setIteratorPosition(c);return e.steps};this.damageCacheAfterStep=function(a){0>a&&(a=-1);void 0===u?u=a:a<u&&(u=a);v()};(function(){var a=q(l)||
p(l);y=new k(a,0,l);v=ops.StepsCache.ENABLE_CACHE_VERIFICATION?m:function(){}})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(g){}})();(function(){ops.OdtStepsTranslator=function(g,l,e,b){function c(a,b,d){var c=b.getCurrentNode();b.isBeforeNode()&&r.isParagraph(c)&&(d||(a+=1),p.updateBookmark(a,c))}function k(a,b){do{if(e.acceptPosition(b)===n){c(a,b,!0);break}c(a-1,b,!1)}while(b.nextPosition())}function f(){var d=g();d!==q&&(q&&runtime.log("Undo detected. Resetting steps cache"),q=d,p=new ops.StepsCache(q,b,k),a=l(q))}function m(a,b){if(!b||e.acceptPosition(a)===n)return!0;for(;a.previousPosition();)if(e.acceptPosition(a)===n){if(b(0,
a.container(),a.unfilteredDomOffset()))return!0;break}for(;a.nextPosition();)if(e.acceptPosition(a)===n){if(b(1,a.container(),a.unfilteredDomOffset()))return!0;break}return!1}var q,p,r=new odf.OdfUtils,d=new core.DomUtils,a,n=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.convertStepsToDomPoint=function(b){var d,g;if(isNaN(b))throw new TypeError("Requested steps is not numeric ("+b+")");if(0>b)throw new RangeError("Requested steps is negative ("+b+")");f();for(d=p.setToClosestStep(b,a);d<b&&
a.nextPosition();)(g=e.acceptPosition(a)===n)&&(d+=1),c(d,a,g);if(d!==b)throw new RangeError("Requested steps ("+b+") exceeds available steps ("+d+")");return{node:a.container(),offset:a.unfilteredDomOffset()}};this.convertDomPointToSteps=function(b,g,k){var l;f();d.containsNode(q,b)||(g=0>d.comparePoints(q,0,b,g),b=q,g=g?0:q.childNodes.length);a.setUnfilteredPosition(b,g);m(a,k)||a.setUnfilteredPosition(b,g);k=a.container();g=a.unfilteredDomOffset();b=p.setToClosestDomPoint(k,g,a);if(0>d.comparePoints(a.container(),
a.unfilteredDomOffset(),k,g))return 0<b?b-1:b;for(;(a.container()!==k||a.unfilteredDomOffset()!==g)&&a.nextPosition();)(l=e.acceptPosition(a)===n)&&(b+=1),c(b,a,l);return b+0};this.prime=function(){var b,d;f();for(b=p.setToClosestStep(0,a);a.nextPosition();)(d=e.acceptPosition(a)===n)&&(b+=1),c(b,a,d)};this.handleStepsInserted=function(a){f();p.damageCacheAfterStep(a.position)};this.handleStepsRemoved=function(a){f();p.damageCacheAfterStep(a.position-1)};f()};ops.OdtStepsTranslator.PREVIOUS_STEP=
0;ops.OdtStepsTranslator.NEXT_STEP=1})();ops.Operation=function(){};ops.Operation.prototype.init=function(g){};ops.Operation.prototype.execute=function(g){};ops.Operation.prototype.spec=function(){};ops.TextPositionFilter=function(g){function l(b,c,g){var l,d;if(c){if(e.isInlineRoot(c)&&e.isGroupingElement(g))return f;l=e.lookLeftForCharacter(c);if(1===l||2===l&&(e.scanRightForAnyCharacter(g)||e.scanRightForAnyCharacter(e.nextNode(b))))return k}else if(e.isInlineRoot(b.previousSibling)&&e.isGroupingElement(b))return k;l=null===c&&e.isParagraph(b);d=e.lookRightForCharacter(g);if(l)return d?k:e.scanRightForAnyCharacter(g)?f:k;if(!d)return f;c=c||e.previousNode(b);return e.scanLeftForAnyCharacter(c)?
f:k}var e=new odf.OdfUtils,b=Node.ELEMENT_NODE,c=Node.TEXT_NODE,k=core.PositionFilter.FilterResult.FILTER_ACCEPT,f=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(m){var q=m.container(),p=q.nodeType,r,d,a;if(p!==b&&p!==c)return f;if(p===c){if(!e.isGroupingElement(q.parentNode)||e.isWithinTrackedChanges(q.parentNode,g()))return f;p=m.unfilteredDomOffset();r=q.data;runtime.assert(p!==r.length,"Unexpected offset.");if(0<p){m=r[p-1];if(!e.isODFWhitespace(m))return k;if(1<p)if(m=
r[p-2],!e.isODFWhitespace(m))d=k;else{if(!e.isODFWhitespace(r.substr(0,p)))return f}else a=e.previousNode(q),e.scanLeftForNonSpace(a)&&(d=k);if(d===k)return e.isTrailingWhitespace(q,p)?f:k;d=r[p];return e.isODFWhitespace(d)?f:e.scanLeftForAnyCharacter(e.previousNode(q))?f:k}a=m.leftNode();d=q;q=q.parentNode;d=l(q,a,d)}else!e.isGroupingElement(q)||e.isWithinTrackedChanges(q,g())?d=f:(a=m.leftNode(),d=m.rightNode(),d=l(q,a,d));return d}};ops.OdtDocument=function(g){function l(){var a=g.odfContainer().getContentElement(),b=a&&a.localName;runtime.assert("text"===b,"Unsupported content element type '"+b+"' for OdtDocument");return a}function e(){return a.getDocumentElement().ownerDocument}function b(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}function c(a){this.acceptPosition=function(d){d=d.container();var c;
c="string"===typeof a?w[a].getNode():a;return b(d)===b(c)?s:z}}function k(a,b,d,c){c=gui.SelectionMover.createPositionIterator(c);var e;1===d.length?e=d[0]:(e=new core.PositionFilterChain,d.forEach(e.addFilter));d=new core.StepIterator(e,c);d.setPosition(a,b);return d}function f(a){var b=gui.SelectionMover.createPositionIterator(l());a=H.convertStepsToDomPoint(a);b.setUnfilteredPosition(a.node,a.offset);return b}function m(a){return h.getParagraphElement(a)}function q(a,b){return g.getFormatting().getStyleElement(a,
b)}function p(a){return q(a,"paragraph")}function r(a){var b,d=[],c,e=2;runtime.assert(a.isStep(),"positionIterator is not at a step");do{if(b=n.getContentBounds(a))if(b=b.container,h.isDowngradableSpaceElement(b)){for(c=b.lastChild;b.firstChild;)d.push(b.firstChild),b.parentNode.insertBefore(b.firstChild,b);b.parentNode.removeChild(b);a.setPosition(c,c.nodeType===Node.TEXT_NODE?c.length:c.childNodes.length);a.roundToPreviousStep()}e-=1}while(0<e&&a.nextStep());d.forEach(x.normalizeTextNodes)}function d(a,
b,d){a=a.childNodes.item(b)||a;return(a=m(a))&&x.containsNode(d,a)?a:d}var a=this,n,h,x,w={},y={},u=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,
ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated]),s=core.PositionFilter.FilterResult.FILTER_ACCEPT,z=core.PositionFilter.FilterResult.FILTER_REJECT,v,H,J;this.getDocumentElement=function(){return g.odfContainer().rootElement};this.getDOMDocument=
function(){return this.getDocumentElement().ownerDocument};this.cloneDocumentElement=function(){var b=a.getDocumentElement(),d=g.getAnnotationViewManager();d&&d.forgetAnnotations();b=b.cloneNode(!0);g.refreshAnnotations();return b};this.setDocumentElement=function(a){var b=g.odfContainer();b.setRootElement(a);g.setOdfContainer(b,!0);g.refreshCSS()};this.getDOMDocument=e;this.getRootElement=b;this.createStepIterator=k;this.getIteratorAtPosition=f;this.convertCursorStepToDomPoint=function(a){return H.convertStepsToDomPoint(a)};
this.convertDomPointToCursorStep=function(a,b,d){return H.convertDomPointToSteps(a,b,d)};this.convertDomToCursorRange=function(a){var b;b=H.convertDomPointToSteps(a.anchorNode,a.anchorOffset);a=a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset?b:H.convertDomPointToSteps(a.focusNode,a.focusOffset);return{position:b,length:a-b}};this.convertCursorToDomRange=function(a,b){var d=e().createRange(),c,f;c=H.convertStepsToDomPoint(a);b?(f=H.convertStepsToDomPoint(a+b),0<b?(d.setStart(c.node,c.offset),
d.setEnd(f.node,f.offset)):(d.setStart(f.node,f.offset),d.setEnd(c.node,c.offset))):d.setStart(c.node,c.offset);return d};this.getStyleElement=q;this.upgradeWhitespacesAtPosition=function(a){var b=f(a),b=new core.StepIterator(v,b),d,c=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+a+")");do{if(d=n.getContentBounds(b))if(a=d.container,d=d.startOffset,a.nodeType===Node.TEXT_NODE&&h.isSignificantWhitespace(a,d)){runtime.assert(" "===a.data[d],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");
var e=a.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),g=a.parentNode,k=a;e.appendChild(a.ownerDocument.createTextNode(" "));1===a.length?g.replaceChild(e,a):(a.deleteData(d,1),0<d&&(d<a.length&&a.splitText(d),k=a.nextSibling),g.insertBefore(e,k));a=e;b.setPosition(a,a.childNodes.length);b.roundToPreviousStep()}c-=1}while(0<c&&b.nextStep())};this.downgradeWhitespaces=r;this.downgradeWhitespacesAtPosition=function(a){a=f(a);a=new core.StepIterator(v,a);r(a)};this.getParagraphStyleElement=
p;this.getParagraphElement=m;this.getParagraphStyleAttributes=function(a){return(a=p(a))?g.getFormatting().getInheritedStyleAttributes(a,!1):null};this.getTextNodeAtStep=function(b,d){var c=f(b),h=c.container(),g,k=0,n=null;h.nodeType===Node.TEXT_NODE?(g=h,k=c.unfilteredDomOffset(),0<g.length&&(0<k&&(g=g.splitText(k)),g.parentNode.insertBefore(e().createTextNode(""),g),g=g.previousSibling,k=0)):(g=e().createTextNode(""),k=0,h.insertBefore(g,c.rightNode()));if(d){if(w[d]&&a.getCursorPosition(d)===
b){for(n=w[d].getNode();n.nextSibling&&"cursor"===n.nextSibling.localName;)n.parentNode.insertBefore(n.nextSibling,n);0<g.length&&g.nextSibling!==n&&(g=e().createTextNode(""),k=0);n.parentNode.insertBefore(g,n)}}else for(;g.nextSibling&&"cursor"===g.nextSibling.localName;)g.parentNode.insertBefore(g.nextSibling,g);for(;g.previousSibling&&g.previousSibling.nodeType===Node.TEXT_NODE;)c=g.previousSibling,c.appendData(g.data),k=c.length,g=c,g.parentNode.removeChild(g.nextSibling);for(;g.nextSibling&&
g.nextSibling.nodeType===Node.TEXT_NODE;)c=g.nextSibling,g.appendData(c.data),g.parentNode.removeChild(c);return{textNode:g,offset:k}};this.fixCursorPositions=function(){Object.keys(w).forEach(function(c){var e=w[c],f=b(e.getNode()),h=a.createRootFilter(f),g,n,m,l=!1;m=e.getSelectedRange();g=d(m.startContainer,m.startOffset,f);n=k(m.startContainer,m.startOffset,[v,h],g);m.collapsed?f=n:(g=d(m.endContainer,m.endOffset,f),f=k(m.endContainer,m.endOffset,[v,h],g));n.isStep()&&f.isStep()?n.container()!==
f.container()||n.offset()!==f.offset()||m.collapsed&&e.getAnchorNode()===e.getNode()||(l=!0,m.setStart(n.container(),n.offset()),m.collapse(!0)):(l=!0,runtime.assert(n.roundToClosestStep(),"No walkable step found for cursor owned by "+c),m.setStart(n.container(),n.offset()),runtime.assert(f.roundToClosestStep(),"No walkable step found for cursor owned by "+c),m.setEnd(f.container(),f.offset()));l&&(e.setSelectedRange(m,e.hasForwardSelection()),a.emit(ops.Document.signalCursorMoved,e))})};this.getCursorPosition=
function(a){return(a=w[a])?H.convertDomPointToSteps(a.getNode(),0):0};this.getCursorSelection=function(a){a=w[a];var b=0,d=0;a&&(b=H.convertDomPointToSteps(a.getNode(),0),d=H.convertDomPointToSteps(a.getAnchorNode(),0));return{position:d,length:b-d}};this.getPositionFilter=function(){return v};this.getOdfCanvas=function(){return g};this.getCanvas=function(){return g};this.getRootNode=l;this.addMember=function(a){runtime.assert(void 0===y[a.getMemberId()],"This member already exists");y[a.getMemberId()]=
a};this.getMember=function(a){return y.hasOwnProperty(a)?y[a]:null};this.removeMember=function(a){delete y[a]};this.getCursor=function(a){return w[a]};this.getMemberIds=function(){var a=[],b;for(b in w)w.hasOwnProperty(b)&&a.push(w[b].getMemberId());return a};this.addCursor=function(b){runtime.assert(Boolean(b),"OdtDocument::addCursor without cursor");var d=b.getMemberId(),c=a.convertCursorToDomRange(0,0);runtime.assert("string"===typeof d,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!w[d],
"OdtDocument::addCursor is adding a duplicate cursor with memberid "+d);b.setSelectedRange(c,!0);w[d]=b};this.removeCursor=function(b){var d=w[b];return d?(d.removeFromDocument(),delete w[b],a.emit(ops.Document.signalCursorRemoved,b),!0):!1};this.moveCursor=function(b,d,c,e){b=w[b];d=a.convertCursorToDomRange(d,c);b&&(b.setSelectedRange(d,0<=c),b.setSelectionType(e||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return g.getFormatting()};this.emit=function(a,b){u.emit(a,b)};this.subscribe=
function(a,b){u.subscribe(a,b)};this.unsubscribe=function(a,b){u.unsubscribe(a,b)};this.createRootFilter=function(a){return new c(a)};this.close=function(a){a()};this.destroy=function(a){a()};v=new ops.TextPositionFilter(l);h=new odf.OdfUtils;x=new core.DomUtils;n=new odf.StepUtils;H=new ops.OdtStepsTranslator(l,gui.SelectionMover.createPositionIterator,v,500);u.subscribe(ops.OdtDocument.signalStepsInserted,H.handleStepsInserted);u.subscribe(ops.OdtDocument.signalStepsRemoved,H.handleStepsRemoved);
u.subscribe(ops.OdtDocument.signalOperationEnd,function(b){var d=b.spec(),c=d.memberid,e=(new Date(d.timestamp)).toISOString(),f=g.odfContainer(),h={setProperties:{},removedProperties:[]};b.isEdit&&("UpdateMetadata"===d.optype&&(h.setProperties=JSON.parse(JSON.stringify(d.setProperties)),d.removedProperties&&(h.removedProperties=d.removedProperties.attributes.split(","))),d=a.getMember(c).getProperties().fullName,f.setMetadata({"dc:creator":d,"dc:date":e},null),h.setProperties["dc:creator"]=d,h.setProperties["dc:date"]=
e,J||(h.setProperties["meta:editing-cycles"]=f.incrementEditingCycles(),f.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),J=b,a.emit(ops.OdtDocument.signalMetadataUpdated,h))});u.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";
ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OpAddAnnotation=function(){function g(b,c,e){var f=b.getTextNodeAtStep(e,l);f&&(b=f.textNode,e=b.parentNode,f.offset!==b.length&&b.splitText(f.offset),e.insertBefore(c,b.nextSibling),0===b.length&&e.removeChild(b))}var l,e,b,c,k,f;this.init=function(f){l=f.memberid;e=parseInt(f.timestamp,10);b=parseInt(f.position,10);c=parseInt(f.length,10)||0;k=f.name};this.isEdit=!0;this.group=void 0;this.execute=function(m){var q=m.getCursor(l),p,r;r=new core.DomUtils;f=m.getDOMDocument();var d=new Date(e),
a,n,h,x;a=f.createElementNS(odf.Namespaces.officens,"office:annotation");a.setAttributeNS(odf.Namespaces.officens,"office:name",k);p=f.createElementNS(odf.Namespaces.dcns,"dc:creator");p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",l);p.textContent=m.getMember(l).getProperties().fullName;n=f.createElementNS(odf.Namespaces.dcns,"dc:date");n.appendChild(f.createTextNode(d.toISOString()));d=f.createElementNS(odf.Namespaces.textns,"text:list");h=f.createElementNS(odf.Namespaces.textns,
"text:list-item");x=f.createElementNS(odf.Namespaces.textns,"text:p");h.appendChild(x);d.appendChild(h);a.appendChild(p);a.appendChild(n);a.appendChild(d);c&&(p=f.createElementNS(odf.Namespaces.officens,"office:annotation-end"),p.setAttributeNS(odf.Namespaces.officens,"office:name",k),a.annotationEndElement=p,g(m,p,b+c));g(m,a,b);m.emit(ops.OdtDocument.signalStepsInserted,{position:b});q&&(p=f.createRange(),r=r.getElementsByTagNameNS(a,odf.Namespaces.textns,"p")[0],p.selectNodeContents(r),q.setSelectedRange(p,
!1),q.setSelectionType(ops.OdtCursor.RangeSelection),m.emit(ops.Document.signalCursorMoved,q));m.getOdfCanvas().addAnnotation(a);m.fixCursorPositions();return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:l,timestamp:e,position:b,length:c,name:k}}};ops.OpAddCursor=function(){var g,l;this.init=function(e){g=e.memberid;l=e.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(e){var b=e.getCursor(g);if(b)return!1;b=new ops.OdtCursor(g,e);e.addCursor(b);e.emit(ops.Document.signalCursorAdded,b);return!0};this.spec=function(){return{optype:"AddCursor",memberid:g,timestamp:l}}};ops.OpAddMember=function(){var g,l,e;this.init=function(b){g=b.memberid;l=parseInt(b.timestamp,10);e=b.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(b){var c;if(b.getMember(g))return!1;c=new ops.Member(g,e);b.addMember(c);b.emit(ops.Document.signalMemberAdded,c);return!0};this.spec=function(){return{optype:"AddMember",memberid:g,timestamp:l,setProperties:e}}};ops.OpAddStyle=function(){var g,l,e,b,c,k,f=odf.Namespaces.stylens;this.init=function(f){g=f.memberid;l=f.timestamp;e=f.styleName;b=f.styleFamily;c="true"===f.isAutomaticStyle||!0===f.isAutomaticStyle;k=f.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(g){var l=g.getOdfCanvas().odfContainer(),p=g.getFormatting(),r=g.getDOMDocument().createElementNS(f,"style:style");if(!r)return!1;k&&p.updateStyle(r,k);r.setAttributeNS(f,"style:family",b);r.setAttributeNS(f,"style:name",e);c?
l.rootElement.automaticStyles.appendChild(r):l.rootElement.styles.appendChild(r);g.getOdfCanvas().refreshCSS();c||g.emit(ops.OdtDocument.signalCommonStyleCreated,{name:e,family:b});return!0};this.spec=function(){return{optype:"AddStyle",memberid:g,timestamp:l,styleName:e,styleFamily:b,isAutomaticStyle:c,setProperties:k}}};odf.ObjectNameGenerator=function(g,l){function e(a,b){var d={};this.generateName=function(){var c=b(),e=0,f;do f=a+e,e+=1;while(d[f]||c[f]);d[f]=!0;return f}}function b(){var a={};[g.rootElement.automaticStyles,g.rootElement.styles].forEach(function(b){for(b=b.firstElementChild;b;)b.namespaceURI===c&&"style"===b.localName&&(a[b.getAttributeNS(c,"name")]=!0),b=b.nextElementSibling});return a}var c=odf.Namespaces.stylens,k=odf.Namespaces.drawns,f=odf.Namespaces.xlinkns,m=new core.DomUtils,q=(new core.Utils).hashString(l),
p=null,r=null,d=null,a={},n={};this.generateStyleName=function(){null===p&&(p=new e("auto"+q+"_",function(){return b()}));return p.generateName()};this.generateFrameName=function(){null===r&&(m.getElementsByTagNameNS(g.rootElement.body,k,"frame").forEach(function(b){a[b.getAttributeNS(k,"name")]=!0}),r=new e("fr"+q+"_",function(){return a}));return r.generateName()};this.generateImageName=function(){null===d&&(m.getElementsByTagNameNS(g.rootElement.body,k,"image").forEach(function(a){a=a.getAttributeNS(f,
"href");a=a.substring(9,a.lastIndexOf("."));n[a]=!0}),d=new e("img"+q+"_",function(){return n}));return d.generateName()}};odf.TextStyleApplicator=function(g,l,e){function b(b){function c(a,b){return"object"===typeof a&&"object"===typeof b?Object.keys(a).every(function(d){return c(a[d],b[d])}):a===b}var d={};this.isStyleApplied=function(a){a=l.getAppliedStylesForElement(a,d);return c(b,a)}}function c(b){var c={};this.applyStyleToContainer=function(d){var a;a=d.getAttributeNS(m,"style-name");var f=d.ownerDocument;a=a||"";if(!c.hasOwnProperty(a)){var h=a,k;k=a?l.createDerivedStyleObject(a,"text",b):b;f=f.createElementNS(q,
"style:style");l.updateStyle(f,k);f.setAttributeNS(q,"style:name",g.generateStyleName());f.setAttributeNS(q,"style:family","text");f.setAttributeNS("urn:webodf:names:scope","scope","document-content");e.appendChild(f);c[h]=f}a=c[a].getAttributeNS(q,"name");d.setAttributeNS(m,"text:style-name",a)}}function k(b,c){var d=b.ownerDocument,a=b.parentNode,e,h,g,k=new core.LoopWatchDog(1E4);h=[];h.push(b);for(g=b.nextSibling;g&&f.rangeContainsNode(c,g);)k.check(),h.push(g),g=g.nextSibling;"span"!==a.localName||
a.namespaceURI!==m?(e=d.createElementNS(m,"text:span"),a.insertBefore(e,b),d=!1):(b.previousSibling&&!f.rangeContainsNode(c,a.firstChild)?(e=a.cloneNode(!1),a.parentNode.insertBefore(e,a.nextSibling)):e=a,d=!0);h.forEach(function(a){a.parentNode!==e&&e.appendChild(a)});if(g&&d)for(h=e.cloneNode(!1),e.parentNode.insertBefore(h,e.nextSibling);g;)k.check(),d=g.nextSibling,h.appendChild(g),g=d;return e}var f=new core.DomUtils,m=odf.Namespaces.textns,q=odf.Namespaces.stylens;this.applyStyle=function(e,
f,d){var a={},g,h,m,l;runtime.assert(d&&d.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");a["style:text-properties"]=d["style:text-properties"];m=new c(a);l=new b(a);e.forEach(function(a){g=l.isStyleApplied(a);!1===g&&(h=k(a,f),m.applyStyleToContainer(h))})}};ops.OpApplyDirectStyling=function(){function g(b,c,e){var d=b.getOdfCanvas().odfContainer(),a=m.splitBoundaries(c),g=f.getTextNodes(c,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(d,l),b.getFormatting(),d.rootElement.automaticStyles)).applyStyle(g,c,e);a.forEach(m.normalizeTextNodes)}var l,e,b,c,k,f=new odf.OdfUtils,m=new core.DomUtils;this.init=function(f){l=f.memberid;e=f.timestamp;b=parseInt(f.position,10);c=parseInt(f.length,10);k=f.setProperties};this.isEdit=!0;this.group=void 0;
this.execute=function(m){var p=m.convertCursorToDomRange(b,c),r=f.getParagraphElements(p);g(m,p,k);p.detach();m.getOdfCanvas().refreshCSS();m.fixCursorPositions();r.forEach(function(b){m.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:l,timeStamp:e})});m.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:l,timestamp:e,position:b,length:c,setProperties:k}}};ops.OpApplyHyperlink=function(){function g(b){for(;b;){if(m.isHyperlink(b))return!0;b=b.parentNode}return!1}var l,e,b,c,k,f=new core.DomUtils,m=new odf.OdfUtils;this.init=function(f){l=f.memberid;e=f.timestamp;b=f.position;c=f.length;k=f.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(q){var p=q.getDOMDocument(),r=q.convertCursorToDomRange(b,c),d=f.splitBoundaries(r),a=[],n=m.getTextNodes(r,!1);if(0===n.length)return!1;n.forEach(function(b){var d=m.getParagraphElement(b);runtime.assert(!1===
g(b),"The given range should not contain any link.");var c=k,e=p.createElementNS(odf.Namespaces.textns,"text:a");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",c);b.parentNode.insertBefore(e,b);e.appendChild(b);-1===a.indexOf(d)&&a.push(d)});d.forEach(f.normalizeTextNodes);r.detach();q.fixCursorPositions();q.getOdfCanvas().refreshSize();q.getOdfCanvas().rerenderAnnotations();a.forEach(function(a){q.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:a,memberId:l,timeStamp:e})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:l,timestamp:e,position:b,length:c,hyperlink:k}}};ops.OpInsertImage=function(){var g,l,e,b,c,k,f,m,q=odf.Namespaces.drawns,p=odf.Namespaces.svgns,r=odf.Namespaces.textns,d=odf.Namespaces.xlinkns;this.init=function(a){g=a.memberid;l=a.timestamp;e=a.position;b=a.filename;c=a.frameWidth;k=a.frameHeight;f=a.frameStyleName;m=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(a){var n=a.getOdfCanvas(),h=a.getTextNodeAtStep(e,g),x,w;if(!h)return!1;x=h.textNode;w=a.getParagraphElement(x);var h=h.offset!==x.length?x.splitText(h.offset):x.nextSibling,
y=a.getDOMDocument(),u=y.createElementNS(q,"draw:image"),y=y.createElementNS(q,"draw:frame");u.setAttributeNS(d,"xlink:href",b);u.setAttributeNS(d,"xlink:type","simple");u.setAttributeNS(d,"xlink:show","embed");u.setAttributeNS(d,"xlink:actuate","onLoad");y.setAttributeNS(q,"draw:style-name",f);y.setAttributeNS(q,"draw:name",m);y.setAttributeNS(r,"text:anchor-type","as-char");y.setAttributeNS(p,"svg:width",c);y.setAttributeNS(p,"svg:height",k);y.appendChild(u);x.parentNode.insertBefore(y,h);a.emit(ops.OdtDocument.signalStepsInserted,
{position:e});0===x.length&&x.parentNode.removeChild(x);n.addCssForFrameWithImage(y);n.refreshCSS();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:w,memberId:g,timeStamp:l});n.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:g,timestamp:l,filename:b,position:e,frameWidth:c,frameHeight:k,frameStyleName:f,frameName:m}}};ops.OpInsertTable=function(){function g(e,d){var a;if(1===p.length)a=p[0];else if(3===p.length)switch(e){case 0:a=p[0];break;case b-1:a=p[2];break;default:a=p[1]}else a=p[e];if(1===a.length)return a[0];if(3===a.length)switch(d){case 0:return a[0];case c-1:return a[2];default:return a[1]}return a[d]}var l,e,b,c,k,f,m,q,p;this.init=function(g){l=g.memberid;e=g.timestamp;k=g.position;b=g.initialRows;c=g.initialColumns;f=g.tableName;m=g.tableStyleName;q=g.tableColumnStyleName;p=g.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(p){var d=p.getTextNodeAtStep(k),a=p.getRootNode();if(d){var n=p.getDOMDocument(),h=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),x=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),w,y,u,s;m&&h.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",m);f&&h.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",f);x.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",c);q&&x.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",q);h.appendChild(x);for(u=0;u<b;u+=1){x=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(s=0;s<c;s+=1)w=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(y=g(u,s))&&w.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",y),y=n.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),w.appendChild(y),x.appendChild(w);h.appendChild(x)}d=p.getParagraphElement(d.textNode);a.insertBefore(h,d.nextSibling);p.emit(ops.OdtDocument.signalStepsInserted,{position:k});p.getOdfCanvas().refreshSize();p.emit(ops.OdtDocument.signalTableAdded,{tableElement:h,memberId:l,timeStamp:e});p.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:l,timestamp:e,position:k,initialRows:b,initialColumns:c,tableName:f,tableStyleName:m,tableColumnStyleName:q,
tableCellStyleMatrix:p}}};ops.OpInsertText=function(){var g,l,e,b,c,k=new odf.OdfUtils;this.init=function(f){g=f.memberid;l=f.timestamp;e=f.position;c=f.text;b="true"===f.moveCursor||!0===f.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(f){var m,q,p,r=null,d=f.getDOMDocument(),a,n=0,h,x=f.getCursor(g),w;f.upgradeWhitespacesAtPosition(e);if(m=f.getTextNodeAtStep(e)){q=m.textNode;r=q.nextSibling;p=q.parentNode;a=f.getParagraphElement(q);for(w=0;w<c.length;w+=1)if("\t"===c[w]||"\t"!==c[w]&&k.isODFWhitespace(c[w])&&
(0===w||w===c.length-1||"\t"!==c[w-1]&&k.isODFWhitespace(c[w-1])))0===n?(m.offset!==q.length&&(r=q.splitText(m.offset)),0<w&&q.appendData(c.substring(0,w))):n<w&&(n=c.substring(n,w),p.insertBefore(d.createTextNode(n),r)),n=w+1,"\t"===c[w]?(h=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),h.appendChild(d.createTextNode("\t"))):(" "!==c[w]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+c.charCodeAt(w)+")"),
h=d.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),h.appendChild(d.createTextNode(" "))),p.insertBefore(h,r);0===n?q.insertData(m.offset,c):n<c.length&&(m=c.substring(n),p.insertBefore(d.createTextNode(m),r));p=q.parentNode;r=q.nextSibling;p.removeChild(q);p.insertBefore(q,r);0===q.length&&q.parentNode.removeChild(q);f.emit(ops.OdtDocument.signalStepsInserted,{position:e});x&&b&&(f.moveCursor(g,e+c.length,0),f.emit(ops.Document.signalCursorMoved,x));f.downgradeWhitespacesAtPosition(e);
f.downgradeWhitespacesAtPosition(e+c.length);f.getOdfCanvas().refreshSize();f.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,memberId:g,timeStamp:l});f.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:g,timestamp:l,position:e,text:c,moveCursor:b}}};odf.CollapsingRules=function(g){function l(c){return b.isODFNode(c)||"br"===c.localName&&b.isLineBreak(c.parentNode)||c.nodeType===Node.TEXT_NODE&&b.isODFNode(c.parentNode)}function e(k){var f;k.nodeType===Node.TEXT_NODE?(f=k.parentNode,f.removeChild(k)):f=c.removeUnwantedNodes(k,l);return f&&!b.isParagraph(f)&&f!==g&&b.hasNoODFContent(f)?e(f):f}var b=new odf.OdfUtils,c=new core.DomUtils;this.mergeChildrenIntoParent=e};ops.OpMergeParagraph=function(){function g(a){a.collapsed||(r.splitBoundaries(a),a=p.getTextElements(a,!1,!0),a.forEach(function(a){runtime.assert(a.nodeType===Node.TEXT_NODE,"Expected node type 3 (Node.TEXT_NODE), found node type "+a.nodeType);0<a.length?(runtime.assert(p.isODFWhitespace(a.data),"Non-whitespace node found between paragraph boundary and first or last step"),runtime.assert(!1===p.isSignificantWhitespace(a,0),"Significant whitespace node found between paragraph boundary and first or last step")):
runtime.log("WARN: Empty text node found during merge operation");a.parentNode.removeChild(a)}))}function l(a,b){var d=b.ownerDocument.createRange();a.setPosition(b,0);a.roundToNextStep();d.setStart(b,0);d.setEnd(a.container(),a.offset());g(d);a.setPosition(b,b.childNodes.length);a.roundToPreviousStep();d.setStart(a.container(),a.offset());d.setEnd(b,b.childNodes.length);g(d)}function e(a,b){var d=a.convertCursorStepToDomPoint(b),d=p.getParagraphElement(d.node,d.offset);runtime.assert(Boolean(d),
"Paragraph not found at step "+b);return d}var b,c,k,f,m,q,p=new odf.OdfUtils,r=new core.DomUtils,d=odf.Namespaces.textns;this.init=function(a){b=a.memberid;c=a.timestamp;k=a.moveCursor;f=a.paragraphStyleName;m=parseInt(a.sourceStartPosition,10);q=parseInt(a.destinationStartPosition,10)};this.isEdit=!0;this.group=void 0;this.execute=function(a){var g,h,x=a.getCursor(b);g=a.getRootNode();var w=new odf.CollapsingRules(g),y=a.createStepIterator(g,0,[a.getPositionFilter()],g),u;runtime.assert(q<m,"Destination paragraph ("+
q+") must be before source paragraph ("+m+")");h=e(a,q);g=e(a,m);y.setPosition(g,0);y.previousStep();runtime.assert(r.containsNode(h,y.container()),"Destination paragraph must be adjacent to the source paragraph");l(y,h);u=h.childNodes.length;l(y,g);var s;for(s=g.firstChild;s;)"editinfo"===s.localName||p.isGroupingElement(s)&&p.hasNoODFContent(s)?g.removeChild(s):h.appendChild(s),s=g.firstChild;w.mergeChildrenIntoParent(g);a.emit(ops.OdtDocument.signalStepsRemoved,{position:m-1});y.setPosition(h,
u);y.roundToClosestStep();y.previousStep()||y.roundToNextStep();a.downgradeWhitespaces(y);f?h.setAttributeNS(d,"text:style-name",f):h.removeAttributeNS(d,"style-name");x&&k&&(a.moveCursor(b,m-1,0),a.emit(ops.Document.signalCursorMoved,x));a.fixCursorPositions();a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:h,memberId:b,timeStamp:c});a.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"MergeParagraph",memberid:b,timestamp:c,
moveCursor:k,paragraphStyleName:f,sourceStartPosition:m,destinationStartPosition:q}}};ops.OpMoveCursor=function(){var g,l,e,b,c;this.init=function(k){g=k.memberid;l=k.timestamp;e=k.position;b=k.length||0;c=k.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(k){var f=k.getCursor(g),m;if(!f)return!1;m=k.convertCursorToDomRange(e,b);f.setSelectedRange(m,0<=b);f.setSelectionType(c);k.emit(ops.Document.signalCursorMoved,f);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:g,timestamp:l,position:e,length:b,selectionType:c}}};ops.OpRemoveAnnotation=function(){var g,l,e,b,c;this.init=function(k){g=k.memberid;l=k.timestamp;e=parseInt(k.position,10);b=parseInt(k.length,10);c=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(b){function f(b){l.parentNode.insertBefore(b,l)}for(var g=b.getIteratorAtPosition(e).container(),l;g.namespaceURI!==odf.Namespaces.officens||"annotation"!==g.localName;)g=g.parentNode;if(null===g)return!1;l=g;g=l.annotationEndElement;b.getOdfCanvas().forgetAnnotations();c.getElementsByTagNameNS(l,
"urn:webodf:names:cursor","cursor").forEach(f);c.getElementsByTagNameNS(l,"urn:webodf:names:cursor","anchor").forEach(f);l.parentNode.removeChild(l);g&&g.parentNode.removeChild(g);b.emit(ops.OdtDocument.signalStepsRemoved,{position:0<e?e-1:e});b.fixCursorPositions();b.getOdfCanvas().refreshAnnotations();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:g,timestamp:l,position:e,length:b}}};ops.OpRemoveBlob=function(){var g,l,e;this.init=function(b){g=b.memberid;l=b.timestamp;e=b.filename};this.isEdit=!0;this.group=void 0;this.execute=function(b){b.getOdfCanvas().odfContainer().removeBlob(e);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:g,timestamp:l,filename:e}}};ops.OpRemoveCursor=function(){var g,l;this.init=function(e){g=e.memberid;l=e.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(e){return e.removeCursor(g)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:g,timestamp:l}}};ops.OpRemoveHyperlink=function(){var g,l,e,b,c=new core.DomUtils,k=new odf.OdfUtils;this.init=function(c){g=c.memberid;l=c.timestamp;e=c.position;b=c.length};this.isEdit=!0;this.group=void 0;this.execute=function(f){var m=f.convertCursorToDomRange(e,b),q=k.getHyperlinkElements(m);runtime.assert(1===q.length,"The given range should only contain a single link.");q=c.mergeIntoParent(q[0]);m.detach();f.fixCursorPositions();f.getOdfCanvas().refreshSize();f.getOdfCanvas().rerenderAnnotations();f.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:k.getParagraphElement(q),memberId:g,timeStamp:l});return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:g,timestamp:l,position:e,length:b}}};ops.OpRemoveMember=function(){var g,l;this.init=function(e){g=e.memberid;l=parseInt(e.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(e){if(!e.getMember(g))return!1;e.removeMember(g);e.emit(ops.Document.signalMemberRemoved,g);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:g,timestamp:l}}};ops.OpRemoveStyle=function(){var g,l,e,b;this.init=function(c){g=c.memberid;l=c.timestamp;e=c.styleName;b=c.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(c){var g=c.getStyleElement(e,b);if(!g)return!1;g.parentNode.removeChild(g);c.getOdfCanvas().refreshCSS();c.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:e,family:b});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:g,timestamp:l,styleName:e,styleFamily:b}}};ops.OpRemoveText=function(){var g,l,e,b,c,k;this.init=function(f){runtime.assert(0<=f.length,"OpRemoveText only supports positive lengths");g=f.memberid;l=f.timestamp;e=parseInt(f.position,10);b=parseInt(f.length,10);c=new odf.OdfUtils;k=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(f){var m,q,p,r=f.getCursor(g),d=new odf.CollapsingRules(f.getRootNode());f.upgradeWhitespacesAtPosition(e);f.upgradeWhitespacesAtPosition(e+b);m=f.convertCursorToDomRange(e,b);k.splitBoundaries(m);
q=c.getTextElements(m,!1,!0);p=c.getParagraphElement(m.startContainer,m.startOffset);runtime.assert(void 0!==p,"Attempting to remove text outside a paragraph element");m.detach();q.forEach(function(a){a.parentNode?(runtime.assert(k.containsNode(p,a),"RemoveText only supports removing elements within the same paragraph"),d.mergeChildrenIntoParent(a)):runtime.log("WARN: text element has already been removed from it's container")});f.emit(ops.OdtDocument.signalStepsRemoved,{position:e});f.downgradeWhitespacesAtPosition(e);
f.fixCursorPositions();f.getOdfCanvas().refreshSize();f.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,memberId:g,timeStamp:l});r&&(r.resetSelectionType(),f.emit(ops.Document.signalCursorMoved,r));f.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:g,timestamp:l,position:e,length:b}}};ops.OpSetBlob=function(){var g,l,e,b,c;this.init=function(k){g=k.memberid;l=k.timestamp;e=k.filename;b=k.mimetype;c=k.content};this.isEdit=!0;this.group=void 0;this.execute=function(g){g.getOdfCanvas().odfContainer().setBlob(e,b,c);return!0};this.spec=function(){return{optype:"SetBlob",memberid:g,timestamp:l,filename:e,mimetype:b,content:c}}};ops.OpSetParagraphStyle=function(){function g(b,c,e){var g=[b.getPositionFilter()],l=e.container();e=e.unfilteredDomOffset();return!1===b.createStepIterator(l,e,g,c).previousStep()}var l,e,b,c;this.init=function(g){l=g.memberid;e=g.timestamp;b=g.position;c=g.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(k){var f,m;f=k.getIteratorAtPosition(b);return(m=k.getParagraphElement(f.container()))?(runtime.assert(g(k,m,f),"SetParagraphStyle position should be the first position in the paragraph"),
c?m.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",c):m.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),k.getOdfCanvas().refreshSize(),k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m,timeStamp:e,memberId:l}),k.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:l,timestamp:e,position:b,styleName:c}}};ops.OpSplitParagraph=function(){var g,l,e,b,c,k,f,m=odf.Namespaces.textns;this.init=function(m){g=m.memberid;l=m.timestamp;b=m.position;e=m.sourceParagraphPosition;k=m.paragraphStyleName;c="true"===m.moveCursor||!0===m.moveCursor;f=new odf.OdfUtils};this.isEdit=!0;this.group=void 0;this.execute=function(e){var p,r,d,a,n,h,x,w=e.getCursor(g);e.upgradeWhitespacesAtPosition(b);p=e.getTextNodeAtStep(b);if(!p)return!1;r=e.getParagraphElement(p.textNode);if(!r)return!1;d=f.isListItem(r.parentNode)?r.parentNode:
r;0===p.offset?(x=p.textNode.previousSibling,h=null):(x=p.textNode,h=p.offset>=p.textNode.length?null:p.textNode.splitText(p.offset));for(a=p.textNode;a!==d;){a=a.parentNode;n=a.cloneNode(!1);h&&n.appendChild(h);if(x)for(;x&&x.nextSibling;)n.appendChild(x.nextSibling);else for(;a.firstChild;)n.appendChild(a.firstChild);a.parentNode.insertBefore(n,a.nextSibling);x=a;h=n}f.isListItem(h)&&(h=h.childNodes.item(0));k?h.setAttributeNS(m,"text:style-name",k):h.removeAttributeNS(m,"style-name");0===p.textNode.length&&
p.textNode.parentNode.removeChild(p.textNode);e.emit(ops.OdtDocument.signalStepsInserted,{position:b});w&&c&&(e.moveCursor(g,b+1,0),e.emit(ops.Document.signalCursorMoved,w));e.fixCursorPositions();e.getOdfCanvas().refreshSize();e.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:r,memberId:g,timeStamp:l});e.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:h,memberId:g,timeStamp:l});e.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",
memberid:g,timestamp:l,position:b,sourceParagraphPosition:e,paragraphStyleName:k,moveCursor:c}}};ops.OpUpdateMember=function(){function g(c){var e="//dc:creator[@editinfo:memberid='"+l+"']";c=xmldom.XPath.getODFElementsWithXPath(c.getRootNode(),e,function(b){return"editinfo"===b?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(b)});for(e=0;e<c.length;e+=1)c[e].textContent=b.fullName}var l,e,b,c;this.init=function(g){l=g.memberid;e=parseInt(g.timestamp,10);b=g.setProperties;c=g.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(e){var f=e.getMember(l);if(!f)return!1;
c&&f.removeProperties(c);b&&(f.setProperties(b),b.fullName&&g(e));e.emit(ops.Document.signalMemberUpdated,f);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:l,timestamp:e,setProperties:b,removedProperties:c}}};ops.OpUpdateMetadata=function(){var g,l,e,b;this.init=function(c){g=c.memberid;l=parseInt(c.timestamp,10);e=c.setProperties;b=c.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(c){c=c.getOdfCanvas().odfContainer();var g=null;b&&(g=b.attributes.split(","));c.setMetadata(e,g);return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:g,timestamp:l,setProperties:e,removedProperties:b}}};ops.OpUpdateParagraphStyle=function(){function g(b,c){var e,f,d=c?c.split(","):[];for(e=0;e<d.length;e+=1)f=d[e].split(":"),b.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(f[0]),f[1])}var l,e,b,c,k,f=odf.Namespaces.stylens;this.init=function(f){l=f.memberid;e=f.timestamp;b=f.styleName;c=f.setProperties;k=f.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(e){var l=e.getFormatting(),p,r,d;return(p=""!==b?e.getParagraphStyleElement(b):l.getDefaultStyleElement("paragraph"))?
(r=p.getElementsByTagNameNS(f,"paragraph-properties").item(0),d=p.getElementsByTagNameNS(f,"text-properties").item(0),c&&l.updateStyle(p,c),k&&(l=k["style:paragraph-properties"],r&&l&&(g(r,l.attributes),0===r.attributes.length&&p.removeChild(r)),l=k["style:text-properties"],d&&l&&(g(d,l.attributes),0===d.attributes.length&&p.removeChild(d)),g(p,k.attributes)),e.getOdfCanvas().refreshCSS(),e.emit(ops.OdtDocument.signalParagraphStyleModified,b),e.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:l,timestamp:e,styleName:b,setProperties:c,removedProperties:k}}};ops.OperationFactory=function(){function g(e){return function(b){return new e}}var l;this.register=function(e,b){l[e]=b};this.create=function(e){var b=null,c=l[e.optype];c&&(b=c(e),b.init(e));return b};l={AddMember:g(ops.OpAddMember),UpdateMember:g(ops.OpUpdateMember),RemoveMember:g(ops.OpRemoveMember),AddCursor:g(ops.OpAddCursor),ApplyDirectStyling:g(ops.OpApplyDirectStyling),SetBlob:g(ops.OpSetBlob),RemoveBlob:g(ops.OpRemoveBlob),InsertImage:g(ops.OpInsertImage),InsertTable:g(ops.OpInsertTable),
InsertText:g(ops.OpInsertText),RemoveText:g(ops.OpRemoveText),MergeParagraph:g(ops.OpMergeParagraph),SplitParagraph:g(ops.OpSplitParagraph),SetParagraphStyle:g(ops.OpSetParagraphStyle),UpdateParagraphStyle:g(ops.OpUpdateParagraphStyle),AddStyle:g(ops.OpAddStyle),RemoveStyle:g(ops.OpRemoveStyle),MoveCursor:g(ops.OpMoveCursor),RemoveCursor:g(ops.OpRemoveCursor),AddAnnotation:g(ops.OpAddAnnotation),RemoveAnnotation:g(ops.OpRemoveAnnotation),UpdateMetadata:g(ops.OpUpdateMetadata),ApplyHyperlink:g(ops.OpApplyHyperlink),
RemoveHyperlink:g(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(g){};ops.OperationRouter.prototype.setPlaybackFunction=function(g){};ops.OperationRouter.prototype.push=function(g){};ops.OperationRouter.prototype.close=function(g){};ops.OperationRouter.prototype.subscribe=function(g,l){};ops.OperationRouter.prototype.unsubscribe=function(g,l){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};
ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";ops.TrivialOperationRouter=function(){var g=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),l,e,b=0;this.setOperationFactory=function(b){l=b};this.setPlaybackFunction=function(b){e=b};this.push=function(c){b+=1;g.emit(ops.OperationRouter.signalProcessingBatchStart,{});c.forEach(function(c){c=c.spec();c.timestamp=Date.now();c=l.create(c);c.group="g"+b;e(c)});g.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(b){b()};
this.subscribe=function(b,e){g.subscribe(b,e)};this.unsubscribe=function(b,e){g.unsubscribe(b,e)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};ops.Session=function(g){function l(b){c.emit(ops.OdtDocument.signalProcessingBatchStart,b)}function e(b){c.emit(ops.OdtDocument.signalProcessingBatchEnd,b)}var b=new ops.OperationFactory,c=new ops.OdtDocument(g),k=null;this.setOperationFactory=function(c){b=c;k&&k.setOperationFactory(b)};this.setOperationRouter=function(f){k&&(k.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,l),k.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,e));k=f;k.subscribe(ops.OperationRouter.signalProcessingBatchStart,
l);k.subscribe(ops.OperationRouter.signalProcessingBatchEnd,e);f.setPlaybackFunction(function(b){c.emit(ops.OdtDocument.signalOperationStart,b);return b.execute(c)?(c.emit(ops.OdtDocument.signalOperationEnd,b),!0):!1});f.setOperationFactory(b)};this.getOperationFactory=function(){return b};this.getOdtDocument=function(){return c};this.enqueue=function(b){k.push(b)};this.close=function(b){k.close(function(e){e?b(e):c.close(b)})};this.destroy=function(b){c.destroy(b)};this.setOperationRouter(new ops.TrivialOperationRouter)};gui.AnnotationController=function(g,l,e){function b(){var b=m.getCursor(e),b=b&&b.getNode(),a=!1;b&&(a=!r.isWithinAnnotation(b,m.getRootNode()));a!==q&&(q=a,p.emit(gui.AnnotationController.annotatableChanged,q))}function c(d){d.getMemberId()===e&&b()}function k(d){d===e&&b()}function f(d){d.getMemberId()===e&&b()}var m=g.getOdtDocument(),q=!1,p=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),r=new odf.OdfUtils;this.isAnnotatable=function(){return q};this.addAnnotation=function(){var b=
new ops.OpAddAnnotation,a=m.getCursorSelection(e),c=a.length,a=a.position;q&&(a=0<=c?a:a+c,c=Math.abs(c),b.init({memberid:e,position:a,length:c,name:e+Date.now()}),g.enqueue([b]))};this.removeAnnotation=function(b){var a,c;a=m.getMember(e).getProperties().fullName;if(!0!==l.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||a===r.getAnnotationCreator(b))a=m.convertDomPointToCursorStep(b,0)+1,c=m.convertDomPointToCursorStep(b,b.childNodes.length),b=new ops.OpRemoveAnnotation,b.init({memberid:e,
position:a,length:c-a}),c=new ops.OpMoveCursor,c.init({memberid:e,position:0<a?a-1:a,length:0}),g.enqueue([b,c])};this.subscribe=function(b,a){p.subscribe(b,a)};this.unsubscribe=function(b,a){p.unsubscribe(b,a)};this.destroy=function(b){m.unsubscribe(ops.Document.signalCursorAdded,c);m.unsubscribe(ops.Document.signalCursorRemoved,k);m.unsubscribe(ops.Document.signalCursorMoved,f);b()};l.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);m.subscribe(ops.Document.signalCursorAdded,
c);m.subscribe(ops.Document.signalCursorRemoved,k);m.subscribe(ops.Document.signalCursorMoved,f);b()};gui.AnnotationController.annotatableChanged="annotatable/changed";gui.Avatar=function(g,l){var e=this,b,c,k;this.setColor=function(b){c.style.borderColor=b};this.setImageUrl=function(b){e.isVisible()?c.src=b:k=b};this.isVisible=function(){return"block"===b.style.display};this.show=function(){k&&(c.src=k,k=void 0);b.style.display="block"};this.hide=function(){b.style.display="none"};this.markAsFocussed=function(c){c?b.classList.add("active"):b.classList.remove("active")};this.destroy=function(c){g.removeChild(b);c()};(function(){var e=g.ownerDocument,k=e.documentElement.namespaceURI;
b=e.createElementNS(k,"div");c=e.createElementNS(k,"img");c.width=64;c.height=64;b.appendChild(c);b.style.width="64px";b.style.height="70px";b.style.position="absolute";b.style.top="-80px";b.style.left="-34px";b.style.display=l?"block":"none";b.className="handle";g.appendChild(b)})()};gui.GuiStepUtils=function(){var g=new odf.OdfUtils,l=new odf.StepUtils,e=new core.DomUtils;this.getContentRect=function(b){b=l.getContentBounds(b);var c,k=null;if(b)if(b.container.nodeType===Node.TEXT_NODE)c=b.container.ownerDocument.createRange(),c.setStart(b.container,b.startOffset),c.setEnd(b.container,b.endOffset),(k=0<c.getClientRects().length?c.getBoundingClientRect():null)&&" "===b.container.data.substring(b.startOffset,b.endOffset)&&1>=k.width&&(k=null),c.detach();else if(g.isCharacterElement(b.container)||
g.isCharacterFrame(b.container))k=e.getBoundingClientRect(b.container);return k}};gui.Caret=function(g,l,e){function b(){p.style.opacity="0"===p.style.opacity?"1":"0";s.trigger()}function c(){n.selectNodeContents(a);return n.getBoundingClientRect()}function k(){Object.keys(J).forEach(function(a){E[a]=J[a]})}function f(){var a,b,f,n;if(!1===J.isShown||g.getSelectionType()!==ops.OdtCursor.RangeSelection||!e&&!g.getSelectedRange().collapsed)J.visibility="hidden",p.style.visibility="hidden",s.cancel();else{J.visibility="visible";p.style.visibility="visible";if(!1===J.isFocused)p.style.opacity=
"1",s.cancel();else{if(z||E.visibility!==J.visibility)p.style.opacity="1",s.cancel();s.trigger()}if(H||v||E.visibility!==J.visibility){a=g.getNode();var m;f=x.getBoundingClientRect(h.getSizer());n=!1;if(0<a.getClientRects().length)m=c(),n=!0;else if(y.setPosition(a,0),m=w.getContentRect(y),!m&&y.nextStep()&&(b=w.getContentRect(y))&&(m=b,n=!0),m||(a.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),m=c(),n=!0),!m)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+
g.getMemberId());a;){if(0<a.getClientRects().length){m=x.getBoundingClientRect(a);n=!0;break}a=a.parentNode}m=x.translateRect(m,f,h.getZoomLevel());a={top:m.top,height:m.height,right:n?m.left:m.right};8>a.height&&(a={top:a.top-(8-a.height)/2,height:8,right:a.right});q.style.height=a.height+"px";q.style.top=a.top+"px";q.style.left=a.right+"px";d&&(a=runtime.getWindow().getComputedStyle(p,null),a.font?d.style.font=a.font:(d.style.fontStyle=a.fontStyle,d.style.fontVariant=a.fontVariant,d.style.fontWeight=
a.fontWeight,d.style.fontSize=a.fontSize,d.style.lineHeight=a.lineHeight,d.style.fontFamily=a.fontFamily))}if(v){m=g.getDocument().getCanvas().getElement().parentNode;var l;f=m.offsetWidth-m.clientWidth+5;n=m.offsetHeight-m.clientHeight+5;l=p.getBoundingClientRect();a=l.left-f;b=l.top-n;f=l.right+f;n=l.bottom+n;l=m.getBoundingClientRect();b<l.top?m.scrollTop-=l.top-b:n>l.bottom&&(m.scrollTop+=n-l.bottom);a<l.left?m.scrollLeft-=l.left-a:f>l.right&&(m.scrollLeft+=f-l.right)}}E.isFocused!==J.isFocused&&
r.markAsFocussed(J.isFocused);k();H=v=z=!1}function m(b){q.parentNode.removeChild(q);a.parentNode.removeChild(a);b()}var q,p,r,d,a,n,h=g.getDocument().getCanvas(),x=new core.DomUtils,w=new gui.GuiStepUtils,y,u,s,z=!1,v=!1,H=!1,J={isFocused:!1,isShown:!0,visibility:"hidden"},E={isFocused:!J.isFocused,isShown:!J.isShown,visibility:"hidden"};this.handleUpdate=function(){H=!0;"hidden"!==J.visibility&&(J.visibility="hidden",p.style.visibility="hidden",g.getNode().removeAttributeNS("urn:webodf:names:cursor",
"caret-sizer-active"));u.trigger()};this.refreshCursorBlinking=function(){z=!0;u.trigger()};this.setFocus=function(){J.isFocused=!0;u.trigger()};this.removeFocus=function(){J.isFocused=!1;u.trigger()};this.show=function(){J.isShown=!0;u.trigger()};this.hide=function(){J.isShown=!1;u.trigger()};this.setAvatarImageUrl=function(a){r.setImageUrl(a)};this.setColor=function(a){p.style.borderColor=a;r.setColor(a)};this.getCursor=function(){return g};this.getFocusElement=function(){return p};this.toggleHandleVisibility=
function(){r.isVisible()?r.hide():r.show()};this.showHandle=function(){r.show()};this.hideHandle=function(){r.hide()};this.setOverlayElement=function(a){d=a;q.appendChild(a);H=!0;u.trigger()};this.ensureVisible=function(){v=!0;u.trigger()};this.destroy=function(a){core.Async.destroyAll([u.destroy,s.destroy,r.destroy,m],a)};(function(){var d=g.getDocument(),c=[d.createRootFilter(g.getMemberId()),d.getPositionFilter()],e=d.getDOMDocument();n=e.createRange();a=e.createElement("span");a.className="webodf-caretSizer";
a.textContent="|";g.getNode().appendChild(a);q=e.createElement("div");q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",g.getMemberId());q.className="webodf-caretOverlay";p=e.createElement("div");p.className="caret";q.appendChild(p);r=new gui.Avatar(q,l);h.getSizer().appendChild(q);y=d.createStepIterator(g.getNode(),0,c,d.getRootNode());u=core.Task.createRedrawTask(f);s=core.Task.createTimeoutTask(b,500);u.triggerImmediate()})()};odf.TextSerializer=function(){function g(b){var c="",k=l.filter?l.filter.acceptNode(b):NodeFilter.FILTER_ACCEPT,f=b.nodeType,m;if((k===NodeFilter.FILTER_ACCEPT||k===NodeFilter.FILTER_SKIP)&&e.isTextContentContainingNode(b))for(m=b.firstChild;m;)c+=g(m),m=m.nextSibling;k===NodeFilter.FILTER_ACCEPT&&(f===Node.ELEMENT_NODE&&e.isParagraph(b)?c+="\n":f===Node.TEXT_NODE&&b.textContent&&(c+=b.textContent));return c}var l=this,e=new odf.OdfUtils;this.filter=null;this.writeToString=function(b){if(!b)return"";
b=g(b);"\n"===b[b.length-1]&&(b=b.substr(0,b.length-1));return b}};gui.MimeDataExporter=function(){var g;this.exportRangeToDataTransfer=function(l,e){var b;b=e.startContainer.ownerDocument.createElement("span");b.appendChild(e.cloneContents());b=g.writeToString(b);try{l.setData("text/plain",b)}catch(c){l.setData("Text",b)}};g=new odf.TextSerializer;g.filter=new odf.OdfNodeFilter};gui.Clipboard=function(g){this.setDataFromRange=function(l,e){var b,c=l.clipboardData;b=runtime.getWindow();!c&&b&&(c=b.clipboardData);c?(b=!0,g.exportRangeToDataTransfer(c,e),l.preventDefault()):b=!1;return b}};gui.SessionContext=function(g,l){var e=g.getOdtDocument(),b=new odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var c=e.getCursor(l),g;if(!c)return!1;g=c&&c.getNode();c=e.getMember(l).getProperties().fullName;return(g=b.getParentAnnotation(g,e.getRootNode()))&&b.getAnnotationCreator(g)===c?!0:!1}};gui.StyleSummary=function(g){function l(b,e){var m=b+"|"+e,l;c.hasOwnProperty(m)||(l=[],g.forEach(function(c){c=(c=c[b])&&c[e];-1===l.indexOf(c)&&l.push(c)}),c[m]=l);return c[m]}function e(b,c,e){return function(){var g=l(b,c);return e.length>=g.length&&g.every(function(b){return-1!==e.indexOf(b)})}}function b(b,c){var e=l(b,c);return 1===e.length?e[0]:void 0}var c={};this.getPropertyValues=l;this.getCommonValue=b;this.isBold=e("style:text-properties","fo:font-weight",["bold"]);this.isItalic=e("style:text-properties",
"fo:font-style",["italic"]);this.hasUnderline=e("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=e("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var c=b("style:text-properties","fo:font-size");return c&&parseFloat(c)};this.fontName=function(){return b("style:text-properties","style:font-name")};this.isAlignedLeft=e("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=e("style:paragraph-properties",
"fo:text-align",["center"]);this.isAlignedRight=e("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=e("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}};gui.DirectFormattingController=function(g,l,e,b,c,k,f){function m(){return P.value().styleSummary}function q(a){var b;a.collapsed?(b=a.startContainer,b.hasChildNodes()&&a.startOffset<b.childNodes.length&&(b=b.childNodes.item(a.startOffset)),a=[b]):a=ea.getTextElements(a,!0,!1);return a}function p(){var a=t.getCursor(b),a=a&&a.getSelectedRange(),d=[],d=[],c=!0;a&&(d=q(a),0===d.length&&(d=[a.startContainer,a.endContainer],c=!1),d=t.getFormatting().getAppliedStyles(d));void 0!==d[0]&&Q&&(d[0]=B.mergeObjects(d[0],
Q));return{containsText:c,appliedStyles:d,styleSummary:new gui.StyleSummary(d)}}function r(a,b){var d={};Object.keys(a).forEach(function(c){var e=a[c](),f=b[c]();e!==f&&(d[c]=f)});return d}function d(){var a,b,d=m();a=r(A.text,d.text);b=r(A.paragraph,d.paragraph);A=d;0<Object.keys(a).length&&W.emit(gui.DirectFormattingController.textStylingChanged,a);0<Object.keys(b).length&&W.emit(gui.DirectFormattingController.paragraphStylingChanged,b)}function a(){var a={directTextStyling:!0,directParagraphStyling:!0};
!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a.directTextStyling=a.directParagraphStyling=e.isLocalCursorWithinOwnAnnotation());a.directTextStyling&&(a.directTextStyling=P.value().containsText);if(a.directTextStyling!==O.directTextStyling||a.directParagraphStyling!==O.directParagraphStyling)O=a,W.emit(gui.DirectFormattingController.enabledChanged,O)}function n(d){("string"===typeof d?d:d.getMemberId())===b&&(P.reset(),a())}function h(){P.reset()}function x(a){var d=t.getCursor(b);a=a.paragraphElement;
d&&t.getParagraphElement(d.getNode())===a&&P.reset()}function w(a,b){b(!a());return!0}function y(a){if(O.directTextStyling){var d=t.getCursorSelection(b),c={"style:text-properties":a};0!==d.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:b,position:d.position,length:d.length,setProperties:c}),g.enqueue([a])):(Q=B.mergeObjects(Q||{},c),P.reset())}}function u(a,b){var d={};d[a]=b;y(d)}function s(a){a=a.spec();Q&&a.memberid===b&&"SplitParagraph"!==a.optype&&(Q=null,P.reset())}function z(a){u("fo:font-weight",
a?"bold":"normal")}function v(a){u("fo:font-style",a?"italic":"normal")}function H(a){u("style:text-underline-style",a?"solid":"none")}function J(a){u("style:text-line-through-style",a?"solid":"none")}function E(a){return a===ops.OdtStepsTranslator.NEXT_STEP}function F(a){if(O.directParagraphStyling){var d=t.getCursor(b).getSelectedRange(),d=ea.getParagraphElements(d),e=t.getFormatting(),f=[],h={},n;d.forEach(function(d){var g=t.convertDomPointToCursorStep(d,0,E),k=d.getAttributeNS(odf.Namespaces.textns,
"style-name"),m;d=k?h.hasOwnProperty(k)?h[k]:void 0:n;d||(d=c.generateStyleName(),k?(h[k]=d,m=e.createDerivedStyleObject(k,"paragraph",{})):(n=d,m={}),m=a(m),k=new ops.OpAddStyle,k.init({memberid:b,styleName:d.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:m}),f.push(k));k=new ops.OpSetParagraphStyle;k.init({memberid:b,styleName:d.toString(),position:g});f.push(k)});g.enqueue(f)}}function D(a){F(function(b){return B.mergeObjects(b,a)})}function L(a){D({"style:paragraph-properties":{"fo:text-align":a}})}
function V(a,b){var d=t.getFormatting().getDefaultTabStopDistance(),c=b["style:paragraph-properties"],e;c&&(c=c["fo:margin-left"],e=ea.parseLength(c));return B.mergeObjects(b,{"style:paragraph-properties":{"fo:margin-left":e&&e.unit===d.unit?e.value+a*d.value+e.unit:a*d.value+d.unit}})}function Y(a,b){var d=q(a),c=t.getFormatting().getAppliedStyles(d)[0],e=t.getFormatting().getAppliedStylesForElement(b);if(!c||"text"!==c["style:family"]||!c["style:text-properties"])return!1;if(!e||!e["style:text-properties"])return!0;
c=c["style:text-properties"];e=e["style:text-properties"];return!Object.keys(c).every(function(a){return c[a]===e[a]})}function G(){}function aa(){return!1}var T=this,t=g.getOdtDocument(),B=new core.Utils,ea=new odf.OdfUtils,W=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),C=odf.Namespaces.textns,I=core.PositionFilter.FilterResult.FILTER_ACCEPT,Q,A,P,O={directTextStyling:!1,
directParagraphStyling:!1};this.enabledFeatures=function(){return O};this.formatTextSelection=y;this.createCursorStyleOp=function(a,d,c){var e=null;(c=c?P.value().appliedStyles[0]:Q)&&c["style:text-properties"]&&(e=new ops.OpApplyDirectStyling,e.init({memberid:b,position:a,length:d,setProperties:{"style:text-properties":c["style:text-properties"]}}),Q=null,P.reset());return e};this.setBold=z;this.setItalic=v;this.setHasUnderline=H;this.setHasStrikethrough=J;this.setFontSize=function(a){u("fo:font-size",
a+"pt")};this.setFontName=function(a){u("style:font-name",a)};this.getAppliedStyles=function(){return P.value().appliedStyles};this.toggleBold=w.bind(T,function(){return m().isBold()},z);this.toggleItalic=w.bind(T,function(){return m().isItalic()},v);this.toggleUnderline=w.bind(T,function(){return m().hasUnderline()},H);this.toggleStrikethrough=w.bind(T,function(){return m().hasStrikeThrough()},J);this.isBold=function(){return m().isBold()};this.isItalic=function(){return m().isItalic()};this.hasUnderline=
function(){return m().hasUnderline()};this.hasStrikeThrough=function(){return m().hasStrikeThrough()};this.fontSize=function(){return m().fontSize()};this.fontName=function(){return m().fontName()};this.isAlignedLeft=function(){return m().isAlignedLeft()};this.isAlignedCenter=function(){return m().isAlignedCenter()};this.isAlignedRight=function(){return m().isAlignedRight()};this.isAlignedJustified=function(){return m().isAlignedJustified()};this.alignParagraphLeft=function(){L("left");return!0};
this.alignParagraphCenter=function(){L("center");return!0};this.alignParagraphRight=function(){L("right");return!0};this.alignParagraphJustified=function(){L("justify");return!0};this.indent=function(){F(V.bind(null,1));return!0};this.outdent=function(){F(V.bind(null,-1));return!0};this.createParagraphStyleOps=function(a){if(!O.directParagraphStyling)return[];var d=t.getCursor(b),e=d.getSelectedRange(),f=[],g,h;d.hasForwardSelection()?(g=d.getAnchorNode(),h=d.getNode()):(g=d.getNode(),h=d.getAnchorNode());
d=t.getParagraphElement(h);runtime.assert(Boolean(d),"DirectFormattingController: Cursor outside paragraph");var k;a:{k=d;var n=gui.SelectionMover.createPositionIterator(k),m=new core.PositionFilterChain;m.addFilter(t.getPositionFilter());m.addFilter(t.createRootFilter(b));for(n.setUnfilteredPosition(e.endContainer,e.endOffset);n.nextPosition();)if(m.acceptPosition(n)===I){k=t.getParagraphElement(n.getCurrentNode())!==k;break a}k=!0}if(!k)return f;h!==g&&(d=t.getParagraphElement(g));if(!Q&&!Y(e,d))return f;
e=P.value().appliedStyles[0];if(!e)return f;if(g=d.getAttributeNS(C,"style-name"))e={"style:text-properties":e["style:text-properties"]},e=t.getFormatting().createDerivedStyleObject(g,"paragraph",e);d=c.generateStyleName();g=new ops.OpAddStyle;g.init({memberid:b,styleName:d,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:e});f.push(g);g=new ops.OpSetParagraphStyle;g.init({memberid:b,styleName:d,position:a});f.push(g);return f};this.subscribe=function(a,b){W.subscribe(a,b)};this.unsubscribe=
function(a,b){W.unsubscribe(a,b)};this.destroy=function(b){t.unsubscribe(ops.Document.signalCursorAdded,n);t.unsubscribe(ops.Document.signalCursorRemoved,n);t.unsubscribe(ops.Document.signalCursorMoved,n);t.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,h);t.unsubscribe(ops.OdtDocument.signalParagraphChanged,x);t.unsubscribe(ops.OdtDocument.signalOperationEnd,s);t.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,d);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a);b()};(function(){t.subscribe(ops.Document.signalCursorAdded,
n);t.subscribe(ops.Document.signalCursorRemoved,n);t.subscribe(ops.Document.signalCursorMoved,n);t.subscribe(ops.OdtDocument.signalParagraphStyleModified,h);t.subscribe(ops.OdtDocument.signalParagraphChanged,x);t.subscribe(ops.OdtDocument.signalOperationEnd,s);t.subscribe(ops.OdtDocument.signalProcessingBatchEnd,d);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a);P=new core.LazyProperty(p);A=m();a();k||(T.formatTextSelection=G,T.setBold=G,T.setItalic=G,T.setHasUnderline=G,T.setHasStrikethrough=
G,T.setFontSize=G,T.setFontName=G,T.toggleBold=aa,T.toggleItalic=aa,T.toggleUnderline=aa,T.toggleStrikethrough=aa);f||(T.alignParagraphCenter=G,T.alignParagraphJustified=G,T.alignParagraphLeft=G,T.alignParagraphRight=G,T.createParagraphStyleOps=function(){return[]},T.indent=G,T.outdent=G)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.KeyboardHandler=function(){function g(b,e){e||(e=l.None);switch(b){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:e|=l.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:e|=l.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:e|=l.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:e|=l.Shift}return b+":"+e}var l=gui.KeyboardHandler.Modifier,e=null,b={};this.setDefault=function(b){e=b};this.bind=function(c,e,f,m){c=g(c,
e);runtime.assert(m||!1===b.hasOwnProperty(c),"tried to overwrite the callback handler of key combo: "+c);b[c]=f};this.unbind=function(c,e){var f=g(c,e);delete b[f]};this.reset=function(){e=null;b={}};this.handleEvent=function(c){var k=c.keyCode,f=l.None;c.metaKey&&(f|=l.Meta);c.ctrlKey&&(f|=l.Ctrl);c.altKey&&(f|=l.Alt);c.shiftKey&&(f|=l.Shift);k=g(k,f);k=b[k];f=!1;k?f=k():null!==e&&(f=e(c));f&&(c.preventDefault?c.preventDefault():c.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};gui.HyperlinkClickHandler=function(g,l,e){function b(){var a=g();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.remove("webodf-inactiveLinks")}function c(){var a=g();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.add("webodf-inactiveLinks")}function k(){d.removeEventListener("focus",c,!1);n.forEach(function(a){l.unbind(a.keyCode,a.modifier);e.unbind(a.keyCode,a.modifier)});n.length=0}function f(a){k();
if(a!==m.None){d.addEventListener("focus",c,!1);switch(a){case m.Ctrl:n.push({keyCode:q.Ctrl,modifier:m.None});break;case m.Meta:n.push({keyCode:q.LeftMeta,modifier:m.None}),n.push({keyCode:q.RightMeta,modifier:m.None}),n.push({keyCode:q.MetaInMozilla,modifier:m.None})}n.forEach(function(a){l.bind(a.keyCode,a.modifier,b);e.bind(a.keyCode,a.modifier,c)})}}var m=gui.KeyboardHandler.Modifier,q=gui.KeyboardHandler.KeyCode,p=xmldom.XPath,r=new odf.OdfUtils,d=runtime.getWindow(),a=m.None,n=[];runtime.assert(null!==
d,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(b){var c=b.target||b.srcElement,e,f;b.ctrlKey?e=m.Ctrl:b.metaKey&&(e=m.Meta);if(a===m.None||a===e){a:{for(;null!==c;){if(r.isHyperlink(c))break a;if(r.isParagraph(c))break;c=c.parentNode}c=null}c&&(c=r.getHyperlinkTarget(c),""!==c&&("#"===c[0]?(c=c.substring(1),e=g(),f=p.getODFElementsWithXPath(e,"//text:bookmark-start[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI),0===f.length&&
(f=p.getODFElementsWithXPath(e,"//text:bookmark[@text:name='"+c+"']",odf.Namespaces.lookupNamespaceURI)),0<f.length&&f[0].scrollIntoView(!0)):d.open(c),b.preventDefault?b.preventDefault():b.returnValue=!1))}};this.setModifier=function(d){a!==d&&(runtime.assert(d===m.None||d===m.Ctrl||d===m.Meta,"Unsupported KeyboardHandler.Modifier value: "+d),a=d,a!==m.None?c():b(),f(a))};this.getModifier=function(){return a};this.destroy=function(a){c();k();a()}};gui.EventManager=function(g){function l(a){function b(a,d,c){var e,f=!1;e="on"+d;a.attachEvent&&(a.attachEvent(e,c),f=!0);!f&&a.addEventListener&&(a.addEventListener(d,c,!1),f=!0);f&&!z[d]||!a.hasOwnProperty(e)||(a[e]=c)}function d(a,b,c){var e="on"+b;a.detachEvent&&a.detachEvent(e,c);a.removeEventListener&&a.removeEventListener(b,c,!1);a[e]===c&&(a[e]=null)}function c(b){if(-1===f.indexOf(b)){f.push(b);if(e.filters.every(function(a){return a(b)}))try{g.emit(a,b)}catch(d){runtime.log("Error occurred while processing "+
a+":\n"+d.message+"\n"+d.stack)}runtime.setTimeout(function(){f.splice(f.indexOf(b),1)},0)}}var e=this,f=[],g=new core.EventNotifier([a]);this.filters=[];this.subscribe=function(b){g.subscribe(a,b)};this.unsubscribe=function(b){g.unsubscribe(a,b)};this.destroy=function(){d(s,a,c);d(E,a,c);d(F,a,c)};v[a]&&b(s,a,c);b(E,a,c);b(F,a,c)}function e(a,b,d){function c(b){d(b,e,function(b){b.type=a;f.emit(a,b)})}var e={},f=new core.EventNotifier([a]);this.subscribe=function(b){f.subscribe(a,b)};this.unsubscribe=
function(b){f.unsubscribe(a,b)};this.destroy=function(){b.forEach(function(a){D.unsubscribe(a,c)})};(function(){b.forEach(function(a){D.subscribe(a,c)})})()}function b(a){runtime.clearTimeout(a);delete L[a]}function c(a,d){var c=runtime.setTimeout(function(){a();b(c)},d);L[c]=!0;return c}function k(a,d,e){var f=a.touches.length,g=a.touches[0],h=d.timer;"touchmove"===a.type||"touchend"===a.type?h&&b(h):"touchstart"===a.type&&(1!==f?runtime.clearTimeout(h):h=c(function(){e({clientX:g.clientX,clientY:g.clientY,
pageX:g.pageX,pageY:g.pageY,target:a.target||a.srcElement||null,detail:1})},400));d.timer=h}function f(a,b,d){var c=a.touches[0],e=a.target||a.srcElement||null,f=b.target;1!==a.touches.length||"touchend"===a.type?f=null:"touchstart"===a.type&&"webodf-draggable"===e.getAttribute("class")?f=e:"touchmove"===a.type&&f&&(a.preventDefault(),a.stopPropagation(),d({clientX:c.clientX,clientY:c.clientY,pageX:c.pageX,pageY:c.pageY,target:f,detail:1}));b.target=f}function m(a,b,d){var c=a.target||a.srcElement||
null,e=b.dragging;"drag"===a.type?e=!0:"touchend"===a.type&&e&&(e=!1,a=a.changedTouches[0],d({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:c,detail:1}));b.dragging=e}function q(){F.classList.add("webodf-touchEnabled");D.unsubscribe("touchstart",q)}function p(a){var b=a.scrollX,d=a.scrollY;this.restore=function(){a.scrollX===b&&a.scrollY===d||a.scrollTo(b,d)}}function r(a){var b=a.scrollTop,d=a.scrollLeft;this.restore=function(){if(a.scrollTop!==b||a.scrollLeft!==d)a.scrollTop=
b,a.scrollLeft=d}}function d(a,b){var d=J[a]||H[a]||null;!d&&b&&(d=J[a]=new l(a));return d}function a(a,b){d(a,!0).subscribe(b)}function n(a,b){var c=d(a,!1);c&&c.unsubscribe(b)}function h(){return g.getDOMDocument().activeElement===E}function x(){h()&&E.blur();E.setAttribute("disabled","true")}function w(){E.removeAttribute("disabled")}function y(a){for(var b=[];a;)(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight)&&b.push(new r(a)),a=a.parentNode;b.push(new p(s));return b}function u(){var a;
h()||(a=y(E),w(),E.focus(),a.forEach(function(a){a.restore()}))}var s=runtime.getWindow(),z={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},v={mousedown:!0,mouseup:!0,focus:!0},H={},J={},E,F=g.getCanvas().getElement(),D=this,L={};this.addFilter=function(a,b){d(a,!0).filters.push(b)};this.removeFilter=function(a,b){var c=d(a,!0),e=c.filters.indexOf(b);-1!==e&&c.filters.splice(e,1)};this.subscribe=a;this.unsubscribe=n;this.hasFocus=h;this.focus=u;this.getEventTrap=function(){return E};
this.setEditing=function(a){var b=h();b&&E.blur();a?E.removeAttribute("readOnly"):E.setAttribute("readOnly","true");b&&u()};this.destroy=function(a){n("touchstart",q);Object.keys(L).forEach(function(a){b(parseInt(a,10))});L.length=0;Object.keys(H).forEach(function(a){H[a].destroy()});H={};n("mousedown",x);n("mouseup",w);n("contextmenu",w);Object.keys(J).forEach(function(a){J[a].destroy()});J={};E.parentNode.removeChild(E);a()};(function(){var b=g.getOdfCanvas().getSizer(),d=b.ownerDocument;runtime.assert(Boolean(s),
"EventManager requires a window object to operate correctly");E=d.createElement("input");E.id="eventTrap";E.setAttribute("tabindex","-1");E.setAttribute("readOnly","true");b.appendChild(E);a("mousedown",x);a("mouseup",w);a("contextmenu",w);H.longpress=new e("longpress",["touchstart","touchmove","touchend"],k);H.drag=new e("drag",["touchstart","touchmove","touchend"],f);H.dragstop=new e("dragstop",["drag","touchend"],m);a("touchstart",q)})()};gui.IOSSafariSupport=function(g){function l(){e.innerHeight!==e.outerHeight&&(b.style.display="none",runtime.requestAnimationFrame(function(){b.style.display="block"}))}var e=runtime.getWindow(),b=g.getEventTrap();this.destroy=function(c){g.unsubscribe("focus",l);b.removeAttribute("autocapitalize");b.style.WebkitTransform="";c()};g.subscribe("focus",l);b.setAttribute("autocapitalize","off");b.style.WebkitTransform="translateX(-10000px)"};gui.HyperlinkController=function(g,l,e,b){function c(){var b=!0;!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=e.isLocalCursorWithinOwnAnnotation());b!==p&&(p=b,q.emit(gui.HyperlinkController.enabledChanged,p))}function k(e){e.getMemberId()===b&&c()}var f=new odf.OdfUtils,m=g.getOdtDocument(),q=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),p=!1;this.isEnabled=function(){return p};this.subscribe=function(b,d){q.subscribe(b,d)};this.unsubscribe=function(b,d){q.unsubscribe(b,
d)};this.addHyperlink=function(c,d){if(p){var a=m.getCursorSelection(b),e=new ops.OpApplyHyperlink,f=[];if(0===a.length||d)d=d||c,e=new ops.OpInsertText,e.init({memberid:b,position:a.position,text:d}),a.length=d.length,f.push(e);e=new ops.OpApplyHyperlink;e.init({memberid:b,position:a.position,length:a.length,hyperlink:c});f.push(e);g.enqueue(f)}};this.removeHyperlinks=function(){if(p){var c=gui.SelectionMover.createPositionIterator(m.getRootNode()),d=m.getCursor(b).getSelectedRange(),a=f.getHyperlinkElements(d),
e=d.collapsed&&1===a.length,h=m.getDOMDocument().createRange(),k=[],l,q;0!==a.length&&(a.forEach(function(a){h.selectNodeContents(a);l=m.convertDomToCursorRange({anchorNode:h.startContainer,anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset});q=new ops.OpRemoveHyperlink;q.init({memberid:b,position:l.position,length:l.length});k.push(q)}),e||(e=a[0],-1===d.comparePoint(e,0)&&(h.setStart(e,0),h.setEnd(d.startContainer,d.startOffset),l=m.convertDomToCursorRange({anchorNode:h.startContainer,
anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset}),0<l.length&&(q=new ops.OpApplyHyperlink,q.init({memberid:b,position:l.position,length:l.length,hyperlink:f.getHyperlinkTarget(e)}),k.push(q))),a=a[a.length-1],c.moveToEndOfNode(a),c=c.unfilteredDomOffset(),1===d.comparePoint(a,c)&&(h.setStart(d.endContainer,d.endOffset),h.setEnd(a,c),l=m.convertDomToCursorRange({anchorNode:h.startContainer,anchorOffset:h.startOffset,focusNode:h.endContainer,focusOffset:h.endOffset}),0<l.length&&
(q=new ops.OpApplyHyperlink,q.init({memberid:b,position:l.position,length:l.length,hyperlink:f.getHyperlinkTarget(a)}),k.push(q)))),g.enqueue(k),h.detach())}};this.destroy=function(b){m.unsubscribe(ops.Document.signalCursorMoved,k);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);b()};m.subscribe(ops.Document.signalCursorMoved,k);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);c()};gui.HyperlinkController.enabledChanged="enabled/changed";gui.ImageController=function(g,l,e,b,c){function k(){var b=!0;!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=e.isLocalCursorWithinOwnAnnotation());b!==a&&(a=b,d.emit(gui.ImageController.enabledChanged,a))}function f(a){a.getMemberId()===b&&k()}var m={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},q=odf.Namespaces.textns,p=g.getOdtDocument(),r=p.getFormatting(),d=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),a=!1;this.isEnabled=function(){return a};this.subscribe=
function(a,b){d.subscribe(a,b)};this.unsubscribe=function(a,b){d.unsubscribe(a,b)};this.insertImage=function(d,e,f,k){if(a){runtime.assert(0<f&&0<k,"Both width and height of the image should be greater than 0px.");k={width:f,height:k};if(f=p.getParagraphElement(p.getCursor(b).getNode()).getAttributeNS(q,"style-name")){f=r.getContentSize(f,"paragraph");var l=1,u=1;k.width>f.width&&(l=f.width/k.width);k.height>f.height&&(u=f.height/k.height);f=Math.min(l,u);k={width:k.width*f,height:k.height*f}}f=k.width+
"px";k=k.height+"px";var s=p.getOdfCanvas().odfContainer().rootElement.styles,l=d.toLowerCase(),u=m.hasOwnProperty(l)?m[l]:null,z,l=[];runtime.assert(null!==u,"Image type is not supported: "+d);u="Pictures/"+c.generateImageName()+u;z=new ops.OpSetBlob;z.init({memberid:b,filename:u,mimetype:d,content:e});l.push(z);r.getStyleElement("Graphics","graphic",[s])||(d=new ops.OpAddStyle,d.init({memberid:b,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph",
"svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),l.push(d));d=c.generateStyleName();e=new ops.OpAddStyle;e.init({memberid:b,styleName:d,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline",
"style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});l.push(e);z=new ops.OpInsertImage;z.init({memberid:b,position:p.getCursorPosition(b),
filename:u,frameWidth:f,frameHeight:k,frameStyleName:d,frameName:c.generateFrameName()});l.push(z);g.enqueue(l)}};this.destroy=function(a){p.unsubscribe(ops.Document.signalCursorMoved,f);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,k);a()};p.subscribe(ops.Document.signalCursorMoved,f);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,k);k()};gui.ImageController.enabledChanged="enabled/changed";gui.ImageSelector=function(g){function l(){var e=g.getSizer(),k=c.createElement("div");k.id="imageSelector";k.style.borderWidth="1px";e.appendChild(k);b.forEach(function(b){var e=c.createElement("div");e.className=b;k.appendChild(e)});return k}var e=odf.Namespaces.svgns,b="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),c=g.getElement().ownerDocument,k=!1;this.select=function(b){var m,q,p=c.getElementById("imageSelector");p||(p=l());k=!0;m=p.parentNode;
q=b.getBoundingClientRect();var r=m.getBoundingClientRect(),d=g.getZoomLevel();m=(q.left-r.left)/d-1;q=(q.top-r.top)/d-1;p.style.display="block";p.style.left=m+"px";p.style.top=q+"px";p.style.width=b.getAttributeNS(e,"width");p.style.height=b.getAttributeNS(e,"height")};this.clearSelection=function(){var b;k&&(b=c.getElementById("imageSelector"))&&(b.style.display="none");k=!1};this.isSelectorElement=function(b){var e=c.getElementById("imageSelector");return e?b===e||b.parentNode===e:!1}};(function(){function g(g){function e(b){f=b.which&&String.fromCharCode(b.which)===k;k=void 0;return!1===f}function b(){f=!1}function c(b){k=b.data;f=!1}var k,f=!1;this.destroy=function(f){g.unsubscribe("textInput",b);g.unsubscribe("compositionend",c);g.removeFilter("keypress",e);f()};g.subscribe("textInput",b);g.subscribe("compositionend",c);g.addFilter("keypress",e)}gui.InputMethodEditor=function(l,e){function b(b){a&&(b?a.getNode().setAttributeNS(d,"composing","true"):(a.getNode().removeAttributeNS(d,
"composing"),x.textContent=""))}function c(){u&&(u=!1,b(!1),z.emit(gui.InputMethodEditor.signalCompositionEnd,{data:s}),s="")}function k(){c();a&&a.getSelectedRange().collapsed?n.value="":n.value=w;n.setSelectionRange(0,n.value.length)}function f(){e.hasFocus()&&y.trigger()}function m(){v=void 0;y.cancel();b(!0);u||z.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function q(a){a=v=a.data;u=!0;s+=a;y.trigger()}function p(a){a.data!==v&&(a=a.data,u=!0,s+=a,y.trigger());v=void 0}function r(){x.textContent=
n.value}var d="urn:webodf:names:cursor",a=null,n=e.getEventTrap(),h=n.ownerDocument,x,w="b",y,u=!1,s="",z=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),v,H=[],J;this.subscribe=z.subscribe;this.unsubscribe=z.unsubscribe;this.registerCursor=function(b){b.getMemberId()===l&&(a=b,a.getNode().appendChild(x),b.subscribe(ops.OdtCursor.signalCursorUpdated,f),e.subscribe("input",r),e.subscribe("compositionupdate",r))};this.removeCursor=function(b){a&&
b===l&&(a.getNode().removeChild(x),a.unsubscribe(ops.OdtCursor.signalCursorUpdated,f),e.unsubscribe("input",r),e.unsubscribe("compositionupdate",r),a=null)};this.destroy=function(a){e.unsubscribe("compositionstart",m);e.unsubscribe("compositionend",q);e.unsubscribe("textInput",p);e.unsubscribe("keypress",c);e.unsubscribe("focus",k);core.Async.destroyAll(J,a)};(function(){e.subscribe("compositionstart",m);e.subscribe("compositionend",q);e.subscribe("textInput",p);e.subscribe("keypress",c);e.subscribe("focus",
k);H.push(new g(e));J=H.map(function(a){return a.destroy});x=h.createElement("span");x.setAttribute("id","composer");y=core.Task.createTimeoutTask(k,1);J.push(y.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();gui.MetadataController=function(g,l){function e(b){k.emit(gui.MetadataController.signalMetadataChanged,b)}function b(b){var c=-1===f.indexOf(b);c||runtime.log("Setting "+b+" is restricted.");return c}var c=g.getOdtDocument(),k=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),f=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(c,e){var f={},k="",d;c&&Object.keys(c).filter(b).forEach(function(a){f[a]=c[a]});
e&&(k=e.filter(b).join(","));if(0<k.length||0<Object.keys(f).length)d=new ops.OpUpdateMetadata,d.init({memberid:l,setProperties:f,removedProperties:0<k.length?{attributes:k}:null}),g.enqueue([d])};this.getMetadata=function(b){var e;runtime.assert("string"===typeof b,"Property must be a string");e=b.split(":");runtime.assert(2===e.length,"Property must be a namespace-prefixed string");b=odf.Namespaces.lookupNamespaceURI(e[0]);runtime.assert(Boolean(b),"Prefix must be for an ODF namespace.");return c.getOdfCanvas().odfContainer().getMetadata(b,
e[1])};this.subscribe=function(b,c){k.subscribe(b,c)};this.unsubscribe=function(b,c){k.unsubscribe(b,c)};this.destroy=function(b){c.unsubscribe(ops.OdtDocument.signalMetadataUpdated,e);b()};c.subscribe(ops.OdtDocument.signalMetadataUpdated,e)};gui.MetadataController.signalMetadataChanged="metadata/changed";gui.PasteController=function(g,l,e,b){function c(){q=!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?e.isLocalCursorWithinOwnAnnotation():!0}function k(e){e.getMemberId()===b&&c()}function f(b){return b===ops.OdtStepsTranslator.NEXT_STEP}var m=g.getOdtDocument(),q=!1,p=odf.Namespaces.textns;this.isEnabled=function(){return q};this.paste=function(c){if(q){var d=m.getCursorPosition(b),a=m.getCursor(b).getNode(),a=m.getParagraphElement(a),e=a.getAttributeNS(p,"style-name")||"",h=d,k=[],l=m.convertDomPointToCursorStep(a,
0,f);c.replace(/\r/g,"").split("\n").forEach(function(a){var d=new ops.OpInsertText,c=new ops.OpSplitParagraph;d.init({memberid:b,position:h,text:a,moveCursor:!0});k.push(d);h+=a.length;c.init({memberid:b,position:h,paragraphStyleName:e,sourceParagraphPosition:l,moveCursor:!0});k.push(c);l=h+=1});k.pop();g.enqueue(k)}};this.destroy=function(b){m.unsubscribe(ops.Document.signalCursorMoved,k);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);b()};m.subscribe(ops.Document.signalCursorMoved,k);
l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,c);c()};odf.WordBoundaryFilter=function(g,l){function e(a,b,d){for(var c=null,e=g.getRootNode(),f;a!==e&&null!==a&&null===c;)f=0>b?a.previousSibling:a.nextSibling,d(f)===NodeFilter.FILTER_ACCEPT&&(c=f),a=a.parentNode;return c}function b(a,b){var d;return null===a?n.NO_NEIGHBOUR:f.isCharacterElement(a)?n.SPACE_CHAR:a.nodeType===c||f.isTextSpan(a)||f.isHyperlink(a)?(d=a.textContent.charAt(b()),q.test(d)?n.SPACE_CHAR:m.test(d)?n.PUNCTUATION_CHAR:n.WORD_CHAR):n.OTHER}var c=Node.TEXT_NODE,k=Node.ELEMENT_NODE,
f=new odf.OdfUtils,m=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
q=/\s/,p=core.PositionFilter.FilterResult.FILTER_ACCEPT,r=core.PositionFilter.FilterResult.FILTER_REJECT,d=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,a=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,n={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(c){var f=c.container(),g=c.leftNode(),m=c.rightNode(),q=c.unfilteredDomOffset,s=function(){return c.unfilteredDomOffset()-1};f.nodeType===k&&(null===m&&(m=e(f,1,c.getNodeFilter())),null===g&&(g=
e(f,-1,c.getNodeFilter())));f!==m&&(q=function(){return 0});f!==g&&null!==g&&(s=function(){return g.textContent.length-1});f=b(g,s);m=b(m,q);return f===n.WORD_CHAR&&m===n.WORD_CHAR||f===n.PUNCTUATION_CHAR&&m===n.PUNCTUATION_CHAR||l===d&&f!==n.NO_NEIGHBOUR&&m===n.SPACE_CHAR||l===a&&f===n.SPACE_CHAR&&m!==n.NO_NEIGHBOUR?r:p}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};gui.SelectionController=function(g,l){function e(a,b,d){d=new odf.WordBoundaryFilter(w,d);var c=w.getRootElement(a)||w.getRootNode(),e=w.createRootFilter(c);return w.createStepIterator(a,b,[s,e,d],c)}function b(a,b){return b?{anchorNode:a.startContainer,anchorOffset:a.startOffset,focusNode:a.endContainer,focusOffset:a.endOffset}:{anchorNode:a.endContainer,anchorOffset:a.endOffset,focusNode:a.startContainer,focusOffset:a.startOffset}}function c(a,b,d){var c=new ops.OpMoveCursor;c.init({memberid:l,
position:a,length:b||0,selectionType:d});return c}function k(a,d,e){var f;f=w.getCursor(l);f=b(f.getSelectedRange(),f.hasForwardSelection());f.focusNode=a;f.focusOffset=d;e||(f.anchorNode=f.focusNode,f.anchorOffset=f.focusOffset);a=w.convertDomToCursorRange(f);g.enqueue([c(a.position,a.length)])}function f(a){var b;b=e(a.startContainer,a.startOffset,H);b.roundToPreviousStep()&&a.setStart(b.container(),b.offset());b=e(a.endContainer,a.endOffset,J);b.roundToNextStep()&&a.setEnd(b.container(),b.offset())}
function m(a){var b=u.getParagraphElements(a),d=b[0],b=b[b.length-1];d&&a.setStart(d,0);b&&(u.isParagraph(a.endContainer)&&0===a.endOffset?a.setEndBefore(b):a.setEnd(b,b.childNodes.length))}function q(a,b,d,c){var e,f;c?(e=d.startContainer,f=d.startOffset):(e=d.endContainer,f=d.endOffset);y.containsNode(a,e)||(f=0>y.comparePoints(a,0,e,f)?0:a.childNodes.length,e=a);a=w.createStepIterator(e,f,b,u.getParagraphElement(e)||a);a.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");
c?d.setStart(a.container(),a.offset()):d.setEnd(a.container(),a.offset())}function p(a){var b=w.getCursorSelection(l),d=w.getCursor(l).getStepCounter();0!==a&&(a=0<a?d.convertForwardStepsBetweenFilters(a,z,s):-d.convertBackwardStepsBetweenFilters(-a,z,s),a=b.length+a,g.enqueue([c(b.position,a)]))}function r(a){var b=w.getCursorPosition(l),d=w.getCursor(l).getStepCounter();0!==a&&(a=0<a?d.convertForwardStepsBetweenFilters(a,z,s):-d.convertBackwardStepsBetweenFilters(-a,z,s),g.enqueue([c(b+a,0)]))}
function d(a,b){var d;d=w.getCursor(l).getNode();d=w.createStepIterator(d,0,[s,v],w.getRootElement(d));d.advanceStep(a)&&k(d.container(),d.offset(),b)}function a(a,b){var d=w.getParagraphElement(w.getCursor(l).getNode()),c=a===F?1:-1;runtime.assert(Boolean(d),"SelectionController: Cursor outside paragraph");d=w.getCursor(l).getStepCounter().countLinesSteps(c,z);b?p(d):r(d)}function n(a,b){var d=a===core.StepDirection.NEXT?1:-1,d=w.getCursor(l).getStepCounter().countStepsToLineBoundary(d,z);b?p(d):
r(d)}function h(a,d){var c=w.getCursor(l),c=b(c.getSelectedRange(),c.hasForwardSelection()),c=e(c.focusNode,c.focusOffset,H);c.advanceStep(a)&&k(c.container(),c.offset(),d)}function x(a,d,c){var e=!1,f=w.getCursor(l),f=b(f.getSelectedRange(),f.hasForwardSelection()),e=w.getRootElement(f.focusNode);runtime.assert(Boolean(e),"SelectionController: Cursor outside root");f=w.createStepIterator(f.focusNode,f.focusOffset,[s,v],e);f.roundToClosestStep();f.advanceStep(a)&&(c=c(f.container()))&&(a===E?(f.setPosition(c,
0),e=f.roundToNextStep()):(f.setPosition(c,c.childNodes.length),e=f.roundToPreviousStep()),e&&k(f.container(),f.offset(),d))}var w=g.getOdtDocument(),y=new core.DomUtils,u=new odf.OdfUtils,s=w.getPositionFilter(),z=new core.PositionFilterChain,v=w.createRootFilter(l),H=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,J=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,E=core.StepDirection.PREVIOUS,F=core.StepDirection.NEXT;this.selectionToRange=function(a){var b=0<=y.comparePoints(a.anchorNode,a.anchorOffset,
a.focusNode,a.focusOffset),d=a.focusNode.ownerDocument.createRange();b?(d.setStart(a.anchorNode,a.anchorOffset),d.setEnd(a.focusNode,a.focusOffset)):(d.setStart(a.focusNode,a.focusOffset),d.setEnd(a.anchorNode,a.anchorOffset));return{range:d,hasForwardSelection:b}};this.rangeToSelection=b;this.selectImage=function(a){var b=w.getRootElement(a),d=w.createRootFilter(b),b=w.createStepIterator(a,0,[d,w.getPositionFilter()],b),e;b.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");
d=b.container();e=b.offset();b.setPosition(a,a.childNodes.length);b.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");a=w.convertDomToCursorRange({anchorNode:d,anchorOffset:e,focusNode:b.container(),focusOffset:b.offset()});a=c(a.position,a.length,ops.OdtCursor.RegionSelection);g.enqueue([a])};this.expandToWordBoundaries=f;this.expandToParagraphBoundaries=m;this.selectRange=function(a,d,e){var h=w.getOdfCanvas().getElement(),k,n=[s];k=y.containsNode(h,a.startContainer);h=y.containsNode(h,
a.endContainer);if(k||h)if(k&&h&&(2===e?f(a):3<=e&&m(a)),(e=d?w.getRootElement(a.startContainer):w.getRootElement(a.endContainer))||(e=w.getRootNode()),n.push(w.createRootFilter(e)),q(e,n,a,!0),q(e,n,a,!1),a=b(a,d),d=w.convertDomToCursorRange(a),a=w.getCursorSelection(l),d.position!==a.position||d.length!==a.length)a=c(d.position,d.length,ops.OdtCursor.RangeSelection),g.enqueue([a])};this.moveCursorToLeft=function(){d(E,!1);return!0};this.moveCursorToRight=function(){d(F,!1);return!0};this.extendSelectionToLeft=
function(){d(E,!0);return!0};this.extendSelectionToRight=function(){d(F,!0);return!0};this.moveCursorUp=function(){a(E,!1);return!0};this.moveCursorDown=function(){a(F,!1);return!0};this.extendSelectionUp=function(){a(E,!0);return!0};this.extendSelectionDown=function(){a(F,!0);return!0};this.moveCursorBeforeWord=function(){h(E,!1);return!0};this.moveCursorPastWord=function(){h(F,!1);return!0};this.extendSelectionBeforeWord=function(){h(E,!0);return!0};this.extendSelectionPastWord=function(){h(F,!0);
return!0};this.moveCursorToLineStart=function(){n(E,!1);return!0};this.moveCursorToLineEnd=function(){n(F,!1);return!0};this.extendSelectionToLineStart=function(){n(E,!0);return!0};this.extendSelectionToLineEnd=function(){n(F,!0);return!0};this.extendSelectionToParagraphStart=function(){x(E,!0,w.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){x(F,!0,w.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){x(E,!1,w.getParagraphElement);return!0};this.moveCursorToParagraphEnd=
function(){x(F,!1,w.getParagraphElement);return!0};this.moveCursorToDocumentStart=function(){x(E,!1,w.getRootElement);return!0};this.moveCursorToDocumentEnd=function(){x(F,!1,w.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){x(E,!0,w.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){x(F,!0,w.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var a=w.getCursor(l),a=w.getRootElement(a.getNode()),b,d,e;runtime.assert(Boolean(a),"SelectionController: Cursor outside root");
e=w.createStepIterator(a,0,[s,v],a);e.roundToClosestStep();b=e.container();d=e.offset();e.setPosition(a,a.childNodes.length);e.roundToClosestStep();a=w.convertDomToCursorRange({anchorNode:b,anchorOffset:d,focusNode:e.container(),focusOffset:e.offset()});g.enqueue([c(a.position,a.length)]);return!0};z.addFilter(s);z.addFilter(w.createRootFilter(l))};gui.TextController=function(g,l,e,b,c,k){function f(){w=!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?e.isLocalCursorWithinOwnAnnotation():!0}function m(a){a.getMemberId()===b&&f()}function q(a){return a===ops.OdtStepsTranslator.NEXT_STEP}function p(a,b,d){var c=[n.getPositionFilter()];d&&c.push(n.createRootFilter(a.startContainer));d=n.createStepIterator(a.startContainer,a.startOffset,c,b);d.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");
b=n.convertDomPointToCursorStep(d.container(),d.offset());a.collapsed?a=b:(d.setPosition(a.endContainer,a.endOffset),d.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),a=n.convertDomPointToCursorStep(d.container(),d.offset()));return{position:b,length:a-b}}function r(a){var d,c,e,f=h.getParagraphElements(a),g=a.cloneRange(),k=[];d=f[0];1<f.length&&(h.hasNoODFContent(d)&&(d=f[f.length-1]),c=d.getAttributeNS(odf.Namespaces.textns,"style-name")||"");
f.forEach(function(d,f){var h,n;g.setStart(d,0);g.collapse(!0);h=p(g,d,!1).position;0<f&&(n=new ops.OpMergeParagraph,n.init({memberid:b,paragraphStyleName:c,destinationStartPosition:e,sourceStartPosition:h,moveCursor:1===f}),k.unshift(n));e=h;g.selectNodeContents(d);if(h=x.rangeIntersection(g,a))h=p(h,d,!0),0<h.length&&(n=new ops.OpRemoveText,n.init({memberid:b,position:h.position,length:h.length}),k.unshift(n))});return k}function d(a){0>a.length&&(a.position+=a.length,a.length=-a.length);return a}
function a(a){if(!w)return!1;var c,e=n.getCursor(b).getSelectedRange().cloneRange(),f=d(n.getCursorSelection(b)),h;if(0===f.length){f=void 0;c=n.getCursor(b).getNode();h=n.getRootElement(c);var k=[n.getPositionFilter(),n.createRootFilter(h)];h=n.createStepIterator(c,0,k,h);h.roundToClosestStep()&&(a?h.nextStep():h.previousStep())&&(f=d(n.convertDomToCursorRange({anchorNode:c,anchorOffset:0,focusNode:h.container(),focusOffset:h.offset()})),a?(e.setStart(c,0),e.setEnd(h.container(),h.offset())):(e.setStart(h.container(),
h.offset()),e.setEnd(c,0)))}f&&g.enqueue(r(e));return void 0!==f}var n=g.getOdtDocument(),h=new odf.OdfUtils,x=new core.DomUtils,w=!1,y=odf.Namespaces.textns;this.isEnabled=function(){return w};this.enqueueParagraphSplittingOps=function(){if(!w)return!1;var a=n.getCursor(b),c=a.getSelectedRange(),e=d(n.getCursorSelection(b)),f=[],a=n.getParagraphElement(a.getNode()),h=a.getAttributeNS(y,"style-name")||"";0<e.length&&(f=f.concat(r(c)));c=new ops.OpSplitParagraph;c.init({memberid:b,position:e.position,
paragraphStyleName:h,sourceParagraphPosition:n.convertDomPointToCursorStep(a,0,q),moveCursor:!0});f.push(c);k&&(e=k(e.position+1),f=f.concat(e));g.enqueue(f);return!0};this.removeTextByBackspaceKey=function(){return a(!1)};this.removeTextByDeleteKey=function(){return a(!0)};this.removeCurrentSelection=function(){if(!w)return!1;var a=n.getCursor(b).getSelectedRange();g.enqueue(r(a));return!0};this.insertText=function(a){if(w){var e=n.getCursor(b).getSelectedRange(),f=d(n.getCursorSelection(b)),h=[],
k=!1;0<f.length&&(h=h.concat(r(e)),k=!0);e=new ops.OpInsertText;e.init({memberid:b,position:f.position,text:a,moveCursor:!0});h.push(e);c&&(a=c(f.position,a.length,k))&&h.push(a);g.enqueue(h)}};this.destroy=function(a){n.unsubscribe(ops.Document.signalCursorMoved,m);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f);a()};n.subscribe(ops.Document.signalCursorMoved,m);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f);f()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(g,l){};gui.UndoManager.prototype.unsubscribe=function(g,l){};gui.UndoManager.prototype.setDocument=function(g){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(g){};gui.UndoManager.prototype.hasUndoStates=function(){};
gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(g){};gui.UndoManager.prototype.moveBackward=function(g){};gui.UndoManager.prototype.onOperationExecuted=function(g){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var g=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(l,e,b,c){function k(a){return a.target||a.srcElement||null}function f(a,b){var d=t.getDOMDocument(),c=null;d.caretRangeFromPoint?(d=d.caretRangeFromPoint(a,b),c={container:d.startContainer,offset:d.startOffset}):d.caretPositionFromPoint&&(d=d.caretPositionFromPoint(a,b))&&d.offsetNode&&(c={container:d.offsetNode,offset:d.offset});return c}function m(a){var b=t.getCursor(e).getSelectedRange();b.collapsed?
a.preventDefault():Q.setDataFromRange(a,b)?fa.removeCurrentSelection():runtime.log("Cut operation failed")}function q(){return!1!==t.getCursor(e).getSelectedRange().collapsed}function p(a){var b=t.getCursor(e).getSelectedRange();b.collapsed?a.preventDefault():Q.setDataFromRange(a,b)||runtime.log("Copy operation failed")}function r(a){var b;T.clipboardData&&T.clipboardData.getData?b=T.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(b=a.clipboardData.getData("text/plain"));
b&&(fa.removeCurrentSelection(),pa.paste(b));a.preventDefault?a.preventDefault():a.returnValue=!1}function d(){return!1}function a(a){if($)$.onOperationExecuted(a)}function n(a){t.emit(ops.OdtDocument.signalUndoStackChanged,a)}function h(){var a;return $?(a=R.hasFocus(),$.moveBackward(1),a&&R.focus(),!0):!1}function x(){var a;return $?(a=R.hasFocus(),$.moveForward(1),a&&R.focus(),!0):!1}function w(a){var d=t.getCursor(e).getSelectedRange(),c=k(a).getAttribute("end");d&&c&&(a=f(a.clientX,a.clientY))&&
(ha.setUnfilteredPosition(a.container,a.offset),ba.acceptPosition(ha)===g&&(d=d.cloneRange(),"left"===c?d.setStart(ha.container(),ha.unfilteredDomOffset()):d.setEnd(ha.container(),ha.unfilteredDomOffset()),b.setSelectedRange(d,"right"===c),t.emit(ops.Document.signalCursorMoved,b)))}function y(){U.selectRange(b.getSelectedRange(),b.hasForwardSelection(),1)}function u(){var a=T.getSelection(),d=0<a.rangeCount&&U.selectionToRange(a);X&&d&&(S=!0,ja.clearSelection(),ha.setUnfilteredPosition(a.focusNode,
a.focusOffset),ba.acceptPosition(ha)===g&&(2===ma?U.expandToWordBoundaries(d.range):3<=ma&&U.expandToParagraphBoundaries(d.range),b.setSelectedRange(d.range,d.hasForwardSelection),t.emit(ops.Document.signalCursorMoved,b)))}function s(a){var b=k(a),d=t.getCursor(e);if(X=null!==b&&W.containsNode(t.getOdfCanvas().getElement(),b))S=!1,b=t.getRootElement(b)||t.getRootNode(),ba=t.createRootFilter(b),ma=0===a.button?a.detail:0,d&&a.shiftKey?T.getSelection().collapse(d.getAnchorNode(),0):(a=T.getSelection(),
b=d.getSelectedRange(),a.extend?d.hasForwardSelection()?(a.collapse(b.startContainer,b.startOffset),a.extend(b.endContainer,b.endOffset)):(a.collapse(b.endContainer,b.endOffset),a.extend(b.startContainer,b.startOffset)):(a.removeAllRanges(),a.addRange(b.cloneRange()))),1<ma&&u()}function z(a){var b=t.getRootElement(a),d=t.createRootFilter(b),b=t.createStepIterator(a,0,[d,t.getPositionFilter()],b);b.setPosition(a,a.childNodes.length);return b.roundToNextStep()?{container:b.container(),offset:b.offset()}:
null}function v(a){var b;b=(b=T.getSelection())?{anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}:null;var d=T.getSelection().isCollapsed,c,e;b.anchorNode||b.focusNode||!(c=f(a.clientX,a.clientY))||(b.anchorNode=c.container,b.anchorOffset=c.offset,b.focusNode=b.anchorNode,b.focusOffset=b.anchorOffset);if(C.isImage(b.focusNode)&&0===b.focusOffset&&C.isCharacterFrame(b.focusNode.parentNode)){if(e=b.focusNode.parentNode,c=e.getBoundingClientRect(),
a.clientX>c.left&&(c=z(e)))b.focusNode=c.container,b.focusOffset=c.offset,d&&(b.anchorNode=b.focusNode,b.anchorOffset=b.focusOffset)}else C.isImage(b.focusNode.firstChild)&&1===b.focusOffset&&C.isCharacterFrame(b.focusNode)&&(c=z(b.focusNode))&&(b.anchorNode=b.focusNode=c.container,b.anchorOffset=b.focusOffset=c.offset);b.anchorNode&&b.focusNode&&(b=U.selectionToRange(b),U.selectRange(b.range,b.hasForwardSelection,0===a.button?a.detail:0));R.focus()}function H(a){var b;if(b=f(a.clientX,a.clientY))a=
b.container,b=b.offset,a={anchorNode:a,anchorOffset:b,focusNode:a,focusOffset:b},a=U.selectionToRange(a),U.selectRange(a.range,a.hasForwardSelection,2),R.focus()}function J(a){var d=k(a),c,e;ka.processRequests();X&&(C.isImage(d)&&C.isCharacterFrame(d.parentNode)&&T.getSelection().isCollapsed?(U.selectImage(d.parentNode),R.focus()):ja.isSelectorElement(d)?R.focus():S?(d=b.getSelectedRange(),c=d.collapsed,C.isImage(d.endContainer)&&0===d.endOffset&&C.isCharacterFrame(d.endContainer.parentNode)&&(e=
d.endContainer.parentNode,e=z(e))&&(d.setEnd(e.container,e.offset),c&&d.collapse(!1)),U.selectRange(d,b.hasForwardSelection(),0===a.button?a.detail:0),R.focus()):ua?v(a):Z=runtime.setTimeout(function(){v(a)},0),ma=0,S=X=!1)}function E(a){var b=t.getCursor(e).getSelectedRange();b.collapsed||I.exportRangeToDataTransfer(a.dataTransfer,b)}function F(){X&&R.focus();ma=0;S=X=!1}function D(a){J(a)}function L(a){var b=k(a),d=null;"annotationRemoveButton"===b.className?(runtime.assert(na,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),
d=W.getElementsByTagNameNS(b.parentNode,odf.Namespaces.officens,"annotation")[0],ca.removeAnnotation(d),R.focus()):"webodf-draggable"!==b.getAttribute("class")&&J(a)}function V(a){(a=a.data)&&(-1===a.indexOf("\n")?fa.insertText(a):pa.paste(a))}function Y(a){return function(){a();return!0}}function G(a){return function(b){return t.getCursor(e).getSelectionType()===ops.OdtCursor.RangeSelection?a(b):!0}}function aa(b){R.unsubscribe("keydown",A.handleEvent);R.unsubscribe("keypress",P.handleEvent);R.unsubscribe("keyup",
O.handleEvent);R.unsubscribe("copy",p);R.unsubscribe("mousedown",s);R.unsubscribe("mousemove",ka.trigger);R.unsubscribe("mouseup",L);R.unsubscribe("contextmenu",D);R.unsubscribe("dragstart",E);R.unsubscribe("dragend",F);R.unsubscribe("click",la.handleClick);R.unsubscribe("longpress",H);R.unsubscribe("drag",w);R.unsubscribe("dragstop",y);t.unsubscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);t.unsubscribe(ops.Document.signalCursorAdded,ia.registerCursor);t.unsubscribe(ops.Document.signalCursorRemoved,
ia.removeCursor);t.unsubscribe(ops.OdtDocument.signalOperationEnd,a);b()}var T=runtime.getWindow(),t=l.getOdtDocument(),B=new gui.SessionConstraints,ea=new gui.SessionContext(l,e),W=new core.DomUtils,C=new odf.OdfUtils,I=new gui.MimeDataExporter,Q=new gui.Clipboard(I),A=new gui.KeyboardHandler,P=new gui.KeyboardHandler,O=new gui.KeyboardHandler,X=!1,K=new odf.ObjectNameGenerator(t.getOdfCanvas().odfContainer(),e),S=!1,ba=null,Z,$=null,R=new gui.EventManager(t),na=c.annotationsEnabled,ca=new gui.AnnotationController(l,
B,e),da=new gui.DirectFormattingController(l,B,ea,e,K,c.directTextStylingEnabled,c.directParagraphStylingEnabled),fa=new gui.TextController(l,B,ea,e,da.createCursorStyleOp,da.createParagraphStyleOps),qa=new gui.ImageController(l,B,ea,e,K),ja=new gui.ImageSelector(t.getOdfCanvas()),ha=gui.SelectionMover.createPositionIterator(t.getRootNode()),ka,oa,pa=new gui.PasteController(l,B,ea,e),ia=new gui.InputMethodEditor(e,R),ma=0,la=new gui.HyperlinkClickHandler(t.getOdfCanvas().getElement,A,O),ga=new gui.HyperlinkController(l,
B,ea,e),U=new gui.SelectionController(l,e),ta=new gui.MetadataController(l,e),M=gui.KeyboardHandler.Modifier,N=gui.KeyboardHandler.KeyCode,ra=-1!==T.navigator.appVersion.toLowerCase().indexOf("mac"),ua=-1!==["iPad","iPod","iPhone"].indexOf(T.navigator.platform),sa;runtime.assert(null!==T,"Expected to be run in an environment which has a global window, like a browser.");this.undo=h;this.redo=x;this.insertLocalCursor=function(){runtime.assert(void 0===l.getOdtDocument().getCursor(e),"Inserting local cursor a second time.");
var a=new ops.OpAddCursor;a.init({memberid:e});l.enqueue([a]);R.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==l.getOdtDocument().getCursor(e),"Removing local cursor without inserting before.");var a=new ops.OpRemoveCursor;a.init({memberid:e});l.enqueue([a])};this.startEditing=function(){ia.subscribe(gui.InputMethodEditor.signalCompositionStart,fa.removeCurrentSelection);ia.subscribe(gui.InputMethodEditor.signalCompositionEnd,V);R.subscribe("beforecut",q);R.subscribe("cut",m);
R.subscribe("beforepaste",d);R.subscribe("paste",r);$&&$.initialize();R.setEditing(!0);la.setModifier(ra?M.Meta:M.Ctrl);A.bind(N.Backspace,M.None,Y(fa.removeTextByBackspaceKey),!0);A.bind(N.Delete,M.None,fa.removeTextByDeleteKey);A.bind(N.Tab,M.None,G(function(){fa.insertText("\t");return!0}));ra?(A.bind(N.Clear,M.None,fa.removeCurrentSelection),A.bind(N.B,M.Meta,G(da.toggleBold)),A.bind(N.I,M.Meta,G(da.toggleItalic)),A.bind(N.U,M.Meta,G(da.toggleUnderline)),A.bind(N.L,M.MetaShift,G(da.alignParagraphLeft)),
A.bind(N.E,M.MetaShift,G(da.alignParagraphCenter)),A.bind(N.R,M.MetaShift,G(da.alignParagraphRight)),A.bind(N.J,M.MetaShift,G(da.alignParagraphJustified)),na&&A.bind(N.C,M.MetaShift,ca.addAnnotation),A.bind(N.Z,M.Meta,h),A.bind(N.Z,M.MetaShift,x)):(A.bind(N.B,M.Ctrl,G(da.toggleBold)),A.bind(N.I,M.Ctrl,G(da.toggleItalic)),A.bind(N.U,M.Ctrl,G(da.toggleUnderline)),A.bind(N.L,M.CtrlShift,G(da.alignParagraphLeft)),A.bind(N.E,M.CtrlShift,G(da.alignParagraphCenter)),A.bind(N.R,M.CtrlShift,G(da.alignParagraphRight)),
A.bind(N.J,M.CtrlShift,G(da.alignParagraphJustified)),na&&A.bind(N.C,M.CtrlAlt,ca.addAnnotation),A.bind(N.Z,M.Ctrl,h),A.bind(N.Z,M.CtrlShift,x));P.setDefault(G(function(a){var b;b=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!b||a.altKey||a.ctrlKey||a.metaKey?!1:(fa.insertText(b),!0)}));P.bind(N.Enter,M.None,G(fa.enqueueParagraphSplittingOps))};this.endEditing=function(){ia.unsubscribe(gui.InputMethodEditor.signalCompositionStart,
fa.removeCurrentSelection);ia.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,V);R.unsubscribe("cut",m);R.unsubscribe("beforecut",q);R.unsubscribe("paste",r);R.unsubscribe("beforepaste",d);R.setEditing(!1);la.setModifier(M.None);A.bind(N.Backspace,M.None,function(){return!0},!0);A.unbind(N.Delete,M.None);A.unbind(N.Tab,M.None);ra?(A.unbind(N.Clear,M.None),A.unbind(N.B,M.Meta),A.unbind(N.I,M.Meta),A.unbind(N.U,M.Meta),A.unbind(N.L,M.MetaShift),A.unbind(N.E,M.MetaShift),A.unbind(N.R,M.MetaShift),
A.unbind(N.J,M.MetaShift),na&&A.unbind(N.C,M.MetaShift),A.unbind(N.Z,M.Meta),A.unbind(N.Z,M.MetaShift)):(A.unbind(N.B,M.Ctrl),A.unbind(N.I,M.Ctrl),A.unbind(N.U,M.Ctrl),A.unbind(N.L,M.CtrlShift),A.unbind(N.E,M.CtrlShift),A.unbind(N.R,M.CtrlShift),A.unbind(N.J,M.CtrlShift),na&&A.unbind(N.C,M.CtrlAlt),A.unbind(N.Z,M.Ctrl),A.unbind(N.Z,M.CtrlShift));P.setDefault(null);P.unbind(N.Enter,M.None)};this.getInputMemberId=function(){return e};this.getSession=function(){return l};this.getSessionConstraints=function(){return B};
this.setUndoManager=function(a){$&&$.unsubscribe(gui.UndoManager.signalUndoStackChanged,n);if($=a)$.setDocument(t),$.setPlaybackFunction(l.enqueue),$.subscribe(gui.UndoManager.signalUndoStackChanged,n)};this.getUndoManager=function(){return $};this.getMetadataController=function(){return ta};this.getAnnotationController=function(){return ca};this.getDirectFormattingController=function(){return da};this.getHyperlinkClickHandler=function(){return la};this.getHyperlinkController=function(){return ga};
this.getImageController=function(){return qa};this.getSelectionController=function(){return U};this.getTextController=function(){return fa};this.getEventManager=function(){return R};this.getKeyboardHandlers=function(){return{keydown:A,keypress:P}};this.destroy=function(a){var b=[ka.destroy,oa.destroy,da.destroy,ia.destroy,R.destroy,la.destroy,ga.destroy,ta.destroy,fa.destroy,aa];sa&&b.unshift(sa.destroy);runtime.clearTimeout(Z);core.Async.destroyAll(b,a)};ka=core.Task.createRedrawTask(u);oa=core.Task.createRedrawTask(function(){var a=
t.getCursor(e);if(a&&a.getSelectionType()===ops.OdtCursor.RegionSelection&&(a=C.getImageElements(a.getSelectedRange())[0])){ja.select(a.parentNode);return}ja.clearSelection()});A.bind(N.Left,M.None,G(U.moveCursorToLeft));A.bind(N.Right,M.None,G(U.moveCursorToRight));A.bind(N.Up,M.None,G(U.moveCursorUp));A.bind(N.Down,M.None,G(U.moveCursorDown));A.bind(N.Left,M.Shift,G(U.extendSelectionToLeft));A.bind(N.Right,M.Shift,G(U.extendSelectionToRight));A.bind(N.Up,M.Shift,G(U.extendSelectionUp));A.bind(N.Down,
M.Shift,G(U.extendSelectionDown));A.bind(N.Home,M.None,G(U.moveCursorToLineStart));A.bind(N.End,M.None,G(U.moveCursorToLineEnd));A.bind(N.Home,M.Ctrl,G(U.moveCursorToDocumentStart));A.bind(N.End,M.Ctrl,G(U.moveCursorToDocumentEnd));A.bind(N.Home,M.Shift,G(U.extendSelectionToLineStart));A.bind(N.End,M.Shift,G(U.extendSelectionToLineEnd));A.bind(N.Up,M.CtrlShift,G(U.extendSelectionToParagraphStart));A.bind(N.Down,M.CtrlShift,G(U.extendSelectionToParagraphEnd));A.bind(N.Home,M.CtrlShift,G(U.extendSelectionToDocumentStart));
A.bind(N.End,M.CtrlShift,G(U.extendSelectionToDocumentEnd));ra?(A.bind(N.Left,M.Alt,G(U.moveCursorBeforeWord)),A.bind(N.Right,M.Alt,G(U.moveCursorPastWord)),A.bind(N.Left,M.Meta,G(U.moveCursorToLineStart)),A.bind(N.Right,M.Meta,G(U.moveCursorToLineEnd)),A.bind(N.Home,M.Meta,G(U.moveCursorToDocumentStart)),A.bind(N.End,M.Meta,G(U.moveCursorToDocumentEnd)),A.bind(N.Left,M.AltShift,G(U.extendSelectionBeforeWord)),A.bind(N.Right,M.AltShift,G(U.extendSelectionPastWord)),A.bind(N.Left,M.MetaShift,G(U.extendSelectionToLineStart)),
A.bind(N.Right,M.MetaShift,G(U.extendSelectionToLineEnd)),A.bind(N.Up,M.AltShift,G(U.extendSelectionToParagraphStart)),A.bind(N.Down,M.AltShift,G(U.extendSelectionToParagraphEnd)),A.bind(N.Up,M.MetaShift,G(U.extendSelectionToDocumentStart)),A.bind(N.Down,M.MetaShift,G(U.extendSelectionToDocumentEnd)),A.bind(N.A,M.Meta,G(U.extendSelectionToEntireDocument))):(A.bind(N.Left,M.Ctrl,G(U.moveCursorBeforeWord)),A.bind(N.Right,M.Ctrl,G(U.moveCursorPastWord)),A.bind(N.Left,M.CtrlShift,G(U.extendSelectionBeforeWord)),
A.bind(N.Right,M.CtrlShift,G(U.extendSelectionPastWord)),A.bind(N.A,M.Ctrl,G(U.extendSelectionToEntireDocument)));ua&&(sa=new gui.IOSSafariSupport(R));R.subscribe("keydown",A.handleEvent);R.subscribe("keypress",P.handleEvent);R.subscribe("keyup",O.handleEvent);R.subscribe("copy",p);R.subscribe("mousedown",s);R.subscribe("mousemove",ka.trigger);R.subscribe("mouseup",L);R.subscribe("contextmenu",D);R.subscribe("dragstart",E);R.subscribe("dragend",F);R.subscribe("click",la.handleClick);R.subscribe("longpress",
H);R.subscribe("drag",w);R.subscribe("dragstop",y);t.subscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);t.subscribe(ops.Document.signalCursorAdded,ia.registerCursor);t.subscribe(ops.Document.signalCursorRemoved,ia.removeCursor);t.subscribe(ops.OdtDocument.signalOperationEnd,a)}})();gui.CaretManager=function(g){function l(b){return a.hasOwnProperty(b)?a[b]:null}function e(){return Object.keys(a).map(function(b){return a[b]})}function b(b){var d=a[b];d&&(delete a[b],b===g.getInputMemberId()&&g.getEventManager().unsubscribe("compositionupdate",d.handleUpdate),d.destroy(function(){}))}function c(a){a=a.getMemberId();a===g.getInputMemberId()&&(a=l(a))&&a.refreshCursorBlinking()}function k(){var a=l(g.getInputMemberId());x=!1;a&&a.ensureVisible()}function f(){var a=l(g.getInputMemberId());
a&&(a.handleUpdate(),x||(x=!0,h=runtime.setTimeout(k,50)))}function m(a){a.memberId===g.getInputMemberId()&&f()}function q(){var a=l(g.getInputMemberId());a&&a.setFocus()}function p(){var a=l(g.getInputMemberId());a&&a.removeFocus()}function r(){var a=l(g.getInputMemberId());a&&a.show()}function d(){var a=l(g.getInputMemberId());a&&a.hide()}var a={},n=runtime.getWindow(),h,x=!1;this.registerCursor=function(b,d,c){var e=b.getMemberId();d=new gui.Caret(b,d,c);c=g.getEventManager();a[e]=d;e===g.getInputMemberId()?
(runtime.log("Starting to track input on new cursor of "+e),b.subscribe(ops.OdtCursor.signalCursorUpdated,f),c.subscribe("compositionupdate",d.handleUpdate),d.setOverlayElement(c.getEventTrap())):b.subscribe(ops.OdtCursor.signalCursorUpdated,d.handleUpdate);return d};this.getCaret=l;this.getCarets=e;this.destroy=function(f){var k=g.getSession().getOdtDocument(),l=g.getEventManager(),s=e().map(function(a){return a.destroy});runtime.clearTimeout(h);k.unsubscribe(ops.OdtDocument.signalParagraphChanged,
m);k.unsubscribe(ops.Document.signalCursorMoved,c);k.unsubscribe(ops.Document.signalCursorRemoved,b);l.unsubscribe("focus",q);l.unsubscribe("blur",p);n.removeEventListener("focus",r,!1);n.removeEventListener("blur",d,!1);a={};core.Async.destroyAll(s,f)};(function(){var a=g.getSession().getOdtDocument(),e=g.getEventManager();a.subscribe(ops.OdtDocument.signalParagraphChanged,m);a.subscribe(ops.Document.signalCursorMoved,c);a.subscribe(ops.Document.signalCursorRemoved,b);e.subscribe("focus",q);e.subscribe("blur",
p);n.addEventListener("focus",r,!1);n.addEventListener("blur",d,!1)})()};gui.EditInfoHandle=function(g){var l=[],e,b=g.ownerDocument,c=b.documentElement.namespaceURI;this.setEdits=function(g){l=g;var f,m,q,p;e.innerHTML="";for(g=0;g<l.length;g+=1)f=b.createElementNS(c,"div"),f.className="editInfo",m=b.createElementNS(c,"span"),m.className="editInfoColor",m.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",l[g].memberid),q=b.createElementNS(c,"span"),q.className="editInfoAuthor",q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",l[g].memberid),
p=b.createElementNS(c,"span"),p.className="editInfoTime",p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",l[g].memberid),p.innerHTML=l[g].time,f.appendChild(m),f.appendChild(q),f.appendChild(p),e.appendChild(f)};this.show=function(){e.style.display="block"};this.hide=function(){e.style.display="none"};this.destroy=function(b){g.removeChild(e);b()};e=b.createElementNS(c,"div");e.setAttribute("class","editInfoHandle");e.style.display="none";g.appendChild(e)};ops.EditInfo=function(g,l){function e(){var b=[],e;for(e in c)c.hasOwnProperty(e)&&b.push({memberid:e,time:c[e].time});b.sort(function(b,c){return b.time-c.time});return b}var b,c={};this.getNode=function(){return b};this.getOdtDocument=function(){return l};this.getEdits=function(){return c};this.getSortedEdits=function(){return e()};this.addEdit=function(b,e){c[b]={time:e}};this.clearEdits=function(){c={}};this.destroy=function(c){g.parentNode&&g.removeChild(b);c()};b=l.getDOMDocument().createElementNS("urn:webodf:names:editinfo",
"editinfo");g.insertBefore(b,g.firstChild)};gui.EditInfoMarker=function(g,l){function e(b,d){return runtime.setTimeout(function(){f.style.opacity=b},d)}var b=this,c,k,f,m,q,p;this.addEdit=function(b,d){var a=Date.now()-d;g.addEdit(b,d);k.setEdits(g.getSortedEdits());f.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",b);runtime.clearTimeout(q);runtime.clearTimeout(p);1E4>a?(m=e(1,0),q=e(0.5,1E4-a),p=e(0.2,2E4-a)):1E4<=a&&2E4>a?(m=e(0.5,0),p=e(0.2,2E4-a)):m=e(0.2,0)};this.getEdits=function(){return g.getEdits()};this.clearEdits=
function(){g.clearEdits();k.setEdits([]);f.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&f.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return g};this.show=function(){f.style.display="block"};this.hide=function(){b.hideHandle();f.style.display="none"};this.showHandle=function(){k.show()};this.hideHandle=function(){k.hide()};this.destroy=function(b){runtime.clearTimeout(m);runtime.clearTimeout(q);runtime.clearTimeout(p);c.removeChild(f);
k.destroy(function(d){d?b(d):g.destroy(b)})};(function(){var e=g.getOdtDocument().getDOMDocument();f=e.createElementNS(e.documentElement.namespaceURI,"div");f.setAttribute("class","editInfoMarker");f.onmouseover=function(){b.showHandle()};f.onmouseout=function(){b.hideHandle()};c=g.getNode();c.appendChild(f);k=new gui.EditInfoHandle(c);l||b.hide()})()};gui.HyperlinkTooltipView=function(g,l){var e=new core.DomUtils,b=new odf.OdfUtils,c=runtime.getWindow(),k,f,m;runtime.assert(null!==c,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(q){var p=q.target||q.srcElement,r=g.getSizer(),d=g.getZoomLevel(),a;a:{for(;p;){if(b.isHyperlink(p))break a;if(b.isParagraph(p)||b.isInlineRoot(p))break;p=p.parentNode}p=null}if(p){e.containsNode(r,m)||r.appendChild(m);a=f;var n;switch(l()){case gui.KeyboardHandler.Modifier.Ctrl:n=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:n=runtime.tr("\u2318-click to follow link");break;default:n=""}a.textContent=n;k.textContent=b.getHyperlinkTarget(p);m.style.display="block";a=c.innerWidth-m.offsetWidth-15;p=q.clientX>a?a:q.clientX+15;a=c.innerHeight-m.offsetHeight-10;q=q.clientY>a?a:q.clientY+10;r=r.getBoundingClientRect();p=(p-r.left)/d;q=(q-r.top)/d;m.style.left=p+"px";m.style.top=q+"px"}};this.hideTooltip=function(){m.style.display="none"};this.destroy=
function(b){m.parentNode&&m.parentNode.removeChild(m);b()};(function(){var b=g.getElement().ownerDocument;k=b.createElement("span");f=b.createElement("span");k.className="webodf-hyperlinkTooltipLink";f.className="webodf-hyperlinkTooltipText";m=b.createElement("div");m.className="webodf-hyperlinkTooltip";m.appendChild(k);m.appendChild(f);g.getElement().appendChild(m)})()};gui.ShadowCursor=function(g){var l=g.getDOMDocument().createRange(),e=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return l};this.setSelectedRange=function(b,c){l=b;e=!1!==c};this.hasForwardSelection=function(){return e};this.getDocument=function(){return g};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};l.setStart(g.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";gui.SelectionView=function(g){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(g){};gui.SelectionViewManager=function(g){function l(){return Object.keys(e).map(function(b){return e[b]})}var e={};this.getSelectionView=function(b){return e.hasOwnProperty(b)?e[b]:null};this.getSelectionViews=l;this.removeSelectionView=function(b){e.hasOwnProperty(b)&&(e[b].destroy(function(){}),delete e[b])};this.hideSelectionView=function(b){e.hasOwnProperty(b)&&e[b].hide()};this.showSelectionView=function(b){e.hasOwnProperty(b)&&e[b].show()};this.rerenderSelectionViews=function(){Object.keys(e).forEach(function(b){e[b].rerender()})};
this.registerCursor=function(b,c){var k=b.getMemberId(),f=new g(b);c?f.show():f.hide();return e[k]=f};this.destroy=function(b){function c(f,g){g?b(g):f<e.length?e[f].destroy(function(b){c(f+1,b)}):b()}var e=l();c(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){gui.SessionView=function(g,l,e,b,c,k){function f(){var a=document.getElementsByTagName("head").item(0),b=document.createElement("style");b.type="text/css";b.media="screen, print, handheld, projection";a.appendChild(b);return b}function m(a,b,d){function c(b,d,e){d=b+'[editinfo|memberid="'+a+'"]'+e+d;a:{var f=y.firstChild;for(b=b+'[editinfo|memberid="'+a+'"]'+e+"{";f;){if(f.nodeType===Node.TEXT_NODE&&0===f.data.indexOf(b)){b=f;break a}f=f.nextSibling}b=null}b?b.data=d:y.appendChild(document.createTextNode(d))}
c("div.editInfoMarker","{ background-color: "+d+"; }","");c("span.editInfoColor","{ background-color: "+d+"; }","");c("span.editInfoAuthor",'{ content: "'+b+'"; }',":before");c("dc|creator","{ background-color: "+d+"; }","");c(".webodf-selectionOverlay","{ fill: "+d+"; stroke: "+d+";}","");a!==gui.ShadowCursor.ShadowCursorMemberId&&a!==l||c(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable")}function q(a){var b,d;for(d in z)z.hasOwnProperty(d)&&(b=z[d],a?
b.show():b.hide())}function p(a){c.getCarets().forEach(function(b){a?b.showHandle():b.hideHandle()})}function r(a){var b=a.getMemberId();a=a.getProperties();m(b,a.fullName,a.color);l===b&&m("","",a.color)}function d(a){var b=a.getMemberId(),d=e.getOdtDocument().getMember(b).getProperties();c.registerCursor(a,F,D);k.registerCursor(a,!0);if(a=c.getCaret(b))a.setAvatarImageUrl(d.imageUrl),a.setColor(d.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+b+"'! +++")}function a(a){a=a.getMemberId();
var b=k.getSelectionView(l),d=k.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),e=c.getCaret(l);a===l?(d.hide(),b&&b.show(),e&&e.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&(d.show(),b&&b.hide(),e&&e.hide())}function n(a){k.removeSelectionView(a)}function h(a){var b=a.paragraphElement,d=a.memberId;a=a.timeStamp;var c,f="",g=b.getElementsByTagNameNS(s,"editinfo").item(0);g?(f=g.getAttributeNS(s,"id"),c=z[f]):(f=Math.random().toString(),c=new ops.EditInfo(b,e.getOdtDocument()),c=new gui.EditInfoMarker(c,
E),g=b.getElementsByTagNameNS(s,"editinfo").item(0),g.setAttributeNS(s,"id",f),z[f]=c);c.addEdit(d,new Date(a));J.trigger()}function x(){var a;""!==u.innerHTML&&(u.innerHTML="");!0===b.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=e.getOdtDocument().getMember(l))&&(a=a.getProperties().fullName,u.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}function w(c){var e=Object.keys(z).map(function(a){return z[a]});
v.unsubscribe(ops.Document.signalMemberAdded,r);v.unsubscribe(ops.Document.signalMemberUpdated,r);v.unsubscribe(ops.Document.signalCursorAdded,d);v.unsubscribe(ops.Document.signalCursorRemoved,n);v.unsubscribe(ops.OdtDocument.signalParagraphChanged,h);v.unsubscribe(ops.Document.signalCursorMoved,a);v.unsubscribe(ops.OdtDocument.signalParagraphChanged,k.rerenderSelectionViews);v.unsubscribe(ops.OdtDocument.signalTableAdded,k.rerenderSelectionViews);v.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,
k.rerenderSelectionViews);b.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,x);v.unsubscribe(ops.Document.signalMemberAdded,x);v.unsubscribe(ops.Document.signalMemberUpdated,x);y.parentNode.removeChild(y);u.parentNode.removeChild(u);(function G(a,b){b?c(b):a<e.length?e[a].destroy(function(b){G(a+1,b)}):c()})(0,void 0)}var y,u,s="urn:webodf:names:editinfo",z={},v,H,J,E=void 0!==g.editInfoMarkersInitiallyVisible?Boolean(g.editInfoMarkersInitiallyVisible):!0,F=void 0!==g.caretAvatarsInitiallyVisible?
Boolean(g.caretAvatarsInitiallyVisible):!0,D=void 0!==g.caretBlinksOnRangeSelect?Boolean(g.caretBlinksOnRangeSelect):!0;this.showEditInfoMarkers=function(){E||(E=!0,q(E))};this.hideEditInfoMarkers=function(){E&&(E=!1,q(E))};this.showCaretAvatars=function(){F||(F=!0,p(F))};this.hideCaretAvatars=function(){F&&(F=!1,p(F))};this.getSession=function(){return e};this.getCaret=function(a){return c.getCaret(a)};this.destroy=function(a){core.Async.destroyAll([J.destroy,w],a)};v=e.getOdtDocument();H=v.getOdfCanvas();
v.subscribe(ops.Document.signalMemberAdded,r);v.subscribe(ops.Document.signalMemberUpdated,r);v.subscribe(ops.Document.signalCursorAdded,d);v.subscribe(ops.Document.signalCursorRemoved,n);v.subscribe(ops.OdtDocument.signalParagraphChanged,h);v.subscribe(ops.Document.signalCursorMoved,a);v.subscribe(ops.OdtDocument.signalParagraphChanged,k.rerenderSelectionViews);v.subscribe(ops.OdtDocument.signalTableAdded,k.rerenderSelectionViews);v.subscribe(ops.OdtDocument.signalParagraphStyleModified,k.rerenderSelectionViews);
b.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,x);v.subscribe(ops.Document.signalMemberAdded,x);v.subscribe(ops.Document.signalMemberUpdated,x);y=f();y.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));y.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));u=f();x();J=core.Task.createRedrawTask(function(){var a=H.getAnnotationViewManager();a&&(a.rehighlightAnnotations(),v.fixCursorPositions())})}})();gui.SvgSelectionView=function(g){function l(){var b=a.getRootNode();n!==b&&(n=b,h=a.getCanvas().getSizer(),h.appendChild(w),w.setAttribute("class","webodf-selectionOverlay"),u.setAttribute("class","webodf-draggable"),s.setAttribute("class","webodf-draggable"),u.setAttribute("end","left"),s.setAttribute("end","right"),u.setAttribute("r",8),s.setAttribute("r",8),w.appendChild(y),w.appendChild(u),w.appendChild(s))}function e(a){a=a.getBoundingClientRect();return Boolean(a&&0!==a.height)}function b(a){var b=
z.getTextElements(a,!0,!1),d=a.cloneRange(),c=a.cloneRange();a=a.cloneRange();if(!b.length)return null;var f;a:{f=0;var g=b[f],h=d.startContainer===g?d.startOffset:0,k=h;d.setStart(g,h);for(d.setEnd(g,k);!e(d);){if(g.nodeType===Node.ELEMENT_NODE&&k<g.childNodes.length)k=g.childNodes.length;else if(g.nodeType===Node.TEXT_NODE&&k<g.length)k+=1;else if(b[f])g=b[f],f+=1,h=k=0;else{f=!1;break a}d.setStart(g,h);d.setEnd(g,k)}f=!0}if(!f)return null;a:{f=b.length-1;g=b[f];k=h=c.endContainer===g?c.endOffset:
g.nodeType===Node.TEXT_NODE?g.length:g.childNodes.length;c.setStart(g,h);for(c.setEnd(g,k);!e(c);){if(g.nodeType===Node.ELEMENT_NODE&&0<h)h=0;else if(g.nodeType===Node.TEXT_NODE&&0<h)h-=1;else if(b[f])g=b[f],f-=1,h=k=g.length||g.childNodes.length;else{b=!1;break a}c.setStart(g,h);c.setEnd(g,k)}b=!0}if(!b)return null;a.setStart(d.startContainer,d.startOffset);a.setEnd(c.endContainer,c.endOffset);return{firstRange:d,lastRange:c,fillerRange:a}}function c(a,b){var d={};d.top=Math.min(a.top,b.top);d.left=
Math.min(a.left,b.left);d.right=Math.max(a.right,b.right);d.bottom=Math.max(a.bottom,b.bottom);d.width=d.right-d.left;d.height=d.bottom-d.top;return d}function k(a,b){b&&0<b.width&&0<b.height&&(a=a?c(a,b):b);return a}function f(b){function d(a){E.setUnfilteredPosition(a,0);return w.acceptNode(a)===F&&s.acceptPosition(E)===F?F:D}function c(a){var b=null;d(a)===F&&(b=v.getBoundingClientRect(a));return b}var e=b.commonAncestorContainer,f=b.startContainer,g=b.endContainer,h=b.startOffset,n=b.endOffset,
l,m,p=null,q,r=x.createRange(),s,w=new odf.OdfNodeFilter,u;if(f===e||g===e)return r=b.cloneRange(),p=r.getBoundingClientRect(),r.detach(),p;for(b=f;b.parentNode!==e;)b=b.parentNode;for(m=g;m.parentNode!==e;)m=m.parentNode;s=a.createRootFilter(f);for(e=b.nextSibling;e&&e!==m;)q=c(e),p=k(p,q),e=e.nextSibling;if(z.isParagraph(b))p=k(p,v.getBoundingClientRect(b));else if(b.nodeType===Node.TEXT_NODE)e=b,r.setStart(e,h),r.setEnd(e,e===m?n:e.length),q=r.getBoundingClientRect(),p=k(p,q);else for(u=x.createTreeWalker(b,
NodeFilter.SHOW_TEXT,d,!1),e=u.currentNode=f;e&&e!==g;)r.setStart(e,h),r.setEnd(e,e.length),q=r.getBoundingClientRect(),p=k(p,q),l=e,h=0,e=u.nextNode();l||(l=f);if(z.isParagraph(m))p=k(p,v.getBoundingClientRect(m));else if(m.nodeType===Node.TEXT_NODE)e=m,r.setStart(e,e===b?h:0),r.setEnd(e,n),q=r.getBoundingClientRect(),p=k(p,q);else for(u=x.createTreeWalker(m,NodeFilter.SHOW_TEXT,d,!1),e=u.currentNode=g;e&&e!==l;)if(r.setStart(e,0),r.setEnd(e,n),q=r.getBoundingClientRect(),p=k(p,q),e=u.previousNode())n=
e.length;return p}function m(a,b){var d=a.getBoundingClientRect(),c={width:0};c.top=d.top;c.bottom=d.bottom;c.height=d.height;c.left=c.right=b?d.right:d.left;return c}function q(){var a=g.getSelectedRange(),d;if(d=J&&g.getSelectionType()===ops.OdtCursor.RangeSelection&&!a.collapsed){l();var e=v.getBoundingClientRect(h),k=H.getZoomLevel(),a=b(a),n,p,q,r,x,E;if(a){d=a.firstRange;n=a.lastRange;p=a.fillerRange;q=v.translateRect(m(d,!1),e,k);x=v.translateRect(m(n,!0),e,k);r=(r=f(p))?v.translateRect(r,
e,k):c(q,x);E=r.left;r=q.left+Math.max(0,r.width-(q.left-r.left));e=Math.min(q.top,x.top);k=x.top+x.height;E=[{x:q.left,y:e+q.height},{x:q.left,y:e},{x:r,y:e},{x:r,y:k-x.height},{x:x.right,y:k-x.height},{x:x.right,y:k},{x:E,y:k},{x:E,y:e+q.height},{x:q.left,y:e+q.height}];r="";var z;for(z=0;z<E.length;z+=1)r+=E[z].x+","+E[z].y+" ";y.setAttribute("points",r);u.setAttribute("cx",q.left);u.setAttribute("cy",e+q.height/2);s.setAttribute("cx",x.right);s.setAttribute("cy",k-x.height/2);d.detach();n.detach();
p.detach()}d=Boolean(a)}w.style.display=d?"block":"none"}function p(a){J&&a===g&&L.trigger()}function r(a){a=8/a;u.setAttribute("r",a);s.setAttribute("r",a)}function d(a){h.removeChild(w);h.classList.remove("webodf-virtualSelections");g.getDocument().unsubscribe(ops.Document.signalCursorMoved,p);H.unsubscribe(gui.ZoomHelper.signalZoomChanged,r);a()}var a=g.getDocument(),n,h,x=a.getDOMDocument(),w=x.createElementNS("http://www.w3.org/2000/svg","svg"),y=x.createElementNS("http://www.w3.org/2000/svg",
"polygon"),u=x.createElementNS("http://www.w3.org/2000/svg","circle"),s=x.createElementNS("http://www.w3.org/2000/svg","circle"),z=new odf.OdfUtils,v=new core.DomUtils,H=a.getCanvas().getZoomHelper(),J=!0,E=gui.SelectionMover.createPositionIterator(a.getRootNode()),F=NodeFilter.FILTER_ACCEPT,D=NodeFilter.FILTER_REJECT,L;this.rerender=function(){J&&L.trigger()};this.show=function(){J=!0;L.trigger()};this.hide=function(){J=!1;L.trigger()};this.destroy=function(a){core.Async.destroyAll([L.destroy,d],
a)};(function(){var a=g.getMemberId();L=core.Task.createRedrawTask(q);l();w.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);h.classList.add("webodf-virtualSelections");g.getDocument().subscribe(ops.Document.signalCursorMoved,p);H.subscribe(gui.ZoomHelper.signalZoomChanged,r);r(H.getZoomLevel())})()};gui.UndoStateRules=function(){function g(b,e){var f=b.length;this.previous=function(){for(f-=1;0<=f;f-=1)if(e(b[f]))return b[f];return null}}function l(b){b=b.spec();var e;b.hasOwnProperty("position")&&(e=b.position);return e}function e(b){return b.isEdit}function b(b,e,f){if(!f)return f=l(b)-l(e),0===f||1===Math.abs(f);b=l(b);e=l(e);f=l(f);return b-e===e-f}this.isEditOperation=e;this.isPartOfOperationSet=function(c,k){var f=void 0!==c.group,l;if(!c.isEdit||0===k.length)return!0;l=k[k.length-1];if(f&&
c.group===l.group)return!0;a:switch(c.spec().optype){case "RemoveText":case "InsertText":l=!0;break a;default:l=!1}if(l&&k.some(e)){if(f){var q;f=c.spec().optype;l=new g(k,e);var p=l.previous(),r=null,d,a;runtime.assert(Boolean(p),"No edit operations found in state");a=p.group;runtime.assert(void 0!==a,"Operation has no group");for(d=1;p&&p.group===a;){if(f===p.spec().optype){q=p;break}p=l.previous()}if(q){for(p=l.previous();p;){if(p.group!==a){if(2===d)break;a=p.group;d+=1}if(f===p.spec().optype){r=
p;break}p=l.previous()}q=b(c,q,r)}else q=!1;return q}q=c.spec().optype;f=new g(k,e);l=f.previous();runtime.assert(Boolean(l),"No edit operations found in state");q=q===l.spec().optype?b(c,l,f.previous()):!1;return q}return!1}};gui.TrivialUndoManager=function(g){function l(a){0<a.length&&(z=!0,n(a),z=!1)}function e(){u.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:q.hasUndoStates(),redoAvailable:q.hasRedoStates()})}function b(){x!==a&&x!==w[w.length-1]&&w.push(x)}function c(a){var b=a.previousSibling||a.nextSibling;a.parentNode.removeChild(a);r.normalizeTextNodes(b)}function k(a){return Object.keys(a).map(function(b){return a[b]})}function f(a){function b(a){var g=a.spec();if(e[g.memberid])switch(g.optype){case "AddCursor":d[g.memberid]||
(d[g.memberid]=a,delete e[g.memberid],f-=1);break;case "MoveCursor":c[g.memberid]||(c[g.memberid]=a)}}var d={},c={},e={},f,g=a.pop();h.getMemberIds().forEach(function(a){e[a]=!0});for(f=Object.keys(e).length;g&&0<f;)g.reverse(),g.forEach(b),g=a.pop();return k(d).concat(k(c))}function m(){var g=d=h.cloneDocumentElement();r.getElementsByTagNameNS(g,p,"cursor").forEach(c);r.getElementsByTagNameNS(g,p,"anchor").forEach(c);b();x=a=f([a].concat(w));w.length=0;y.length=0;e()}var q=this,p="urn:webodf:names:cursor",
r=new core.DomUtils,d,a=[],n,h,x=[],w=[],y=[],u=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),s=g||new gui.UndoStateRules,z=!1;this.subscribe=function(a,b){u.subscribe(a,b)};this.unsubscribe=function(a,b){u.unsubscribe(a,b)};this.hasUndoStates=function(){return 0<w.length};this.hasRedoStates=function(){return 0<y.length};this.setDocument=function(a){h=
a};this.purgeInitialState=function(){w.length=0;y.length=0;a.length=0;x.length=0;d=null;e()};this.setInitialState=m;this.initialize=function(){d||m()};this.setPlaybackFunction=function(a){n=a};this.onOperationExecuted=function(d){z||(s.isEditOperation(d)&&(x===a||0<y.length)||!s.isPartOfOperationSet(d,x)?(y.length=0,b(),x=[d],w.push(x),u.emit(gui.UndoManager.signalUndoStateCreated,{operations:x}),e()):(x.push(d),u.emit(gui.UndoManager.signalUndoStateModified,{operations:x})))};this.moveForward=function(a){for(var b=
0,d;a&&y.length;)d=y.pop(),w.push(d),l(d),a-=1,b+=1;b&&(x=w[w.length-1],e());return b};this.moveBackward=function(b){for(var c=0;b&&w.length;)y.push(w.pop()),b-=1,c+=1;c&&(h.getMemberIds().forEach(function(a){h.removeCursor(a)}),h.setDocumentElement(d.cloneNode(!0)),u.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),l(a),w.forEach(l),x=w[w.length-1]||a,e());return c}};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced";odf.LazyStyleProperties=function(g,l){var e={};this.value=function(b){var c;e.hasOwnProperty(b)?c=e[b]:(c=l[b](),void 0===c&&g&&(c=g.value(b)),e[b]=c);return c};this.reset=function(b){g=b;e={}}};
odf.StyleParseUtils=function(){function g(e){var b,c;e=(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null;c=e&&e.unit;"px"===c?b=e.value:"cm"===c?b=96*(e.value/2.54):"mm"===c?b=96*(e.value/25.4):"in"===c?b=96*e.value:"pt"===c?b=e.value/0.75:"pc"===c&&(b=16*e.value);return b}var l=odf.Namespaces.stylens;this.parseLength=g;this.parsePositiveLengthOrPercent=function(e,b,c){var k;e&&(k=parseFloat(e.substr(0,
e.indexOf("%"))),isNaN(k)&&(k=void 0));var f;void 0!==k?(c&&(f=c.value(b)),k=void 0===f?void 0:k*(f/100)):k=g(e);return k};this.getPropertiesElement=function(e,b,c){for(b=c?c.nextElementSibling:b.firstElementChild;null!==b&&(b.localName!==e||b.namespaceURI!==l);)b=b.nextElementSibling;return b}};odf.GraphicProperties=function(g,l,e){var b=this,c=odf.Namespaces.stylens,k=odf.Namespaces.svgns;this.verticalPos=function(){return b.data.value("verticalPos")};this.verticalRel=function(){return b.data.value("verticalRel")};this.horizontalPos=function(){return b.data.value("horizontalPos")};this.horizontalRel=function(){return b.data.value("horizontalRel")};this.strokeWidth=function(){return b.data.value("strokeWidth")};b.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{verticalPos:function(){var b=
g.getAttributeNS(c,"vertical-pos");return""===b?void 0:b},verticalRel:function(){var b=g.getAttributeNS(c,"vertical-rel");return""===b?void 0:b},horizontalPos:function(){var b=g.getAttributeNS(c,"horizontal-pos");return""===b?void 0:b},horizontalRel:function(){var b=g.getAttributeNS(c,"horizontal-rel");return""===b?void 0:b},strokeWidth:function(){var b=g.getAttributeNS(k,"stroke-width");return l.parseLength(b)}})};
odf.ComputedGraphicProperties=function(){var g;this.setGraphicProperties=function(l){g=l};this.verticalPos=function(){return g&&g.verticalPos()||"from-top"};this.verticalRel=function(){return g&&g.verticalRel()||"page"};this.horizontalPos=function(){return g&&g.horizontalPos()||"from-left"};this.horizontalRel=function(){return g&&g.horizontalRel()||"page"}};odf.PageLayoutProperties=function(g,l,e){var b=this,c=odf.Namespaces.fons;this.pageHeight=function(){return b.data.value("pageHeight")||1123};this.pageWidth=function(){return b.data.value("pageWidth")||794};b.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{pageHeight:function(){var b;g&&(b=g.getAttributeNS(c,"page-height"),b=l.parseLength(b));return b},pageWidth:function(){var b;g&&(b=g.getAttributeNS(c,"page-width"),b=l.parseLength(b));return b}})};
odf.PageLayout=function(g,l,e){var b=null;g&&(b=l.getPropertiesElement("page-layout-properties",g));this.pageLayout=new odf.PageLayoutProperties(b,l,e&&e.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(g){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};odf.ParagraphProperties=function(g,l,e){var b=this,c=odf.Namespaces.fons;this.marginTop=function(){return b.data.value("marginTop")};b.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{marginTop:function(){var b=g.getAttributeNS(c,"margin-top");return l.parsePositiveLengthOrPercent(b,"marginTop",e&&e.data)}})};
odf.ComputedParagraphProperties=function(){var g={},l=[];this.setStyleChain=function(e){l=e;g={}};this.marginTop=function(){var e,b;if(g.hasOwnProperty("marginTop"))e=g.marginTop;else{for(b=0;void 0===e&&b<l.length;b+=1)e=l[b].marginTop();g.marginTop=e}return e||0}};odf.TextProperties=function(g,l,e){var b=this,c=odf.Namespaces.fons;this.fontSize=function(){return b.data.value("fontSize")};b.data=new odf.LazyStyleProperties(void 0===e?void 0:e.data,{fontSize:function(){var b=g.getAttributeNS(c,"font-size");return l.parsePositiveLengthOrPercent(b,"fontSize",e&&e.data)}})};
odf.ComputedTextProperties=function(){var g={},l=[];this.setStyleChain=function(e){l=e;g={}};this.fontSize=function(){var e,b;if(g.hasOwnProperty("fontSize"))e=g.fontSize;else{for(b=0;void 0===e&&b<l.length;b+=1)e=l[b].fontSize();g.fontSize=e}return e||12}};odf.MasterPage=function(g,l){var e;g?(e=g.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=l.getPageLayout(e)):this.pageLayout=l.getDefaultPageLayout()};odf.MasterPageCache=function(){};odf.MasterPageCache.prototype.getMasterPage=function(g){};
odf.StylePileEntry=function(g,l,e,b){this.masterPage=function(){var b=g.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),k=null;b&&(k=e.getMasterPage(b));return k};(function(c){var e=g.getAttributeNS(odf.Namespaces.stylens,"family"),f=null;if("graphic"===e||"chart"===e)c.graphic=void 0===b?void 0:b.graphic,f=l.getPropertiesElement("graphic-properties",g,f),null!==f&&(c.graphic=new odf.GraphicProperties(f,l,c.graphic));if("paragraph"===e||"table-cell"===e||"graphic"===e||"presentation"===
e||"chart"===e)c.paragraph=void 0===b?void 0:b.paragraph,f=l.getPropertiesElement("paragraph-properties",g,f),null!==f&&(c.paragraph=new odf.ParagraphProperties(f,l,c.paragraph));if("text"===e||"paragraph"===e||"table-cell"===e||"graphic"===e||"presentation"===e||"chart"===e)c.text=void 0===b?void 0:b.text,f=l.getPropertiesElement("text-properties",g,f),null!==f&&(c.text=new odf.TextProperties(f,l,c.text))})(this)};
odf.StylePile=function(g,l){function e(c,d){var a,e;c.hasAttributeNS(b,"parent-style-name")&&(e=c.getAttributeNS(b,"parent-style-name"),-1===d.indexOf(e)&&(a=p(e,d)));return new odf.StylePileEntry(c,g,l,a)}var b=odf.Namespaces.stylens,c={},k={},f,m={},q={},p;p=function(b,d){var a=m[b],f;!a&&(f=c[b])&&(d.push(b),a=e(f,d),m[b]=a);return a};this.getStyle=function(b){var d=q[b]||m[b],a,f=[];d||(a=k[b],a||(a=c[b])&&f.push(b),a&&(d=e(a,f)));return d};this.addCommonStyle=function(e){var d;e.hasAttributeNS(b,
"name")&&(d=e.getAttributeNS(b,"name"),c.hasOwnProperty(d)||(c[d]=e))};this.addAutomaticStyle=function(c){var d;c.hasAttributeNS(b,"name")&&(d=c.getAttributeNS(b,"name"),k.hasOwnProperty(d)||(k[d]=c))};this.setDefaultStyle=function(b){void 0===f&&(f=e(b,[]))};this.getDefaultStyle=function(){return f}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(g){function l(a,b,d,c){b=d.getAttributeNS(b,"class-names");var e;if(b)for(b=b.split(" "),e=0;e<b.length;e+=1)if(d=b[e])c.push(a),c.push(d)}function e(a,b){var d=w.getStyleName("paragraph",a);void 0!==d&&(b.push("paragraph"),b.push(d));a.namespaceURI!==h||"h"!==a.localName&&"p"!==a.localName||l("paragraph",h,a,b);return b}function b(a,b,d){var c=[],e,f,g,h;for(e=0;e<a.length;e+=2)g=a[e],h=a[e+1],g=m[g],h=g.getStyle(h),void 0!==h&&(h=h[b],void 0!==h&&h!==f&&(c.push(h),f=h));
g=m[d];if(h=g.getDefaultStyle())h=h[b],void 0!==h&&h!==f&&c.push(h);return c}function c(a,b){var d=w.getStyleName("text",a),f=a.parentElement;void 0!==d&&(b.push("text"),b.push(d));"span"===a.localName&&a.namespaceURI===h&&l("text",h,a,b);if(!f||f===g)return b;f.namespaceURI!==h||"p"!==f.localName&&"h"!==f.localName?c(f,b):e(f,b);return b}function k(a){a=a.getAttributeNS(x,"family");return m[a]}var f=this,m,q,p,r,d,a,n,h=odf.Namespaces.textns,x=odf.Namespaces.stylens,w=new odf.StyleInfo,y=new odf.StyleParseUtils,
u,s,z,v,H,J;this.getComputedGraphicStyle=function(a){var d=[];a=w.getStyleName("graphic",a);void 0!==a&&(d.push("graphic"),d.push(a));a=d.join("/");var c=r[a];runtime.assert(0===d.length%2,"Invalid style chain.");void 0===c&&(c=new odf.ComputedGraphicStyle,c.graphic.setGraphicProperties(b(d,"graphic","graphic")[0]),c.text.setStyleChain(b(d,"text","graphic")),c.paragraph.setStyleChain(b(d,"paragraph","graphic")),r[a]=c);return c};this.getComputedParagraphStyle=function(a){a=e(a,[]);var d=a.join("/"),
c=p[d];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===c&&(c=new odf.ComputedParagraphStyle,c.text.setStyleChain(b(a,"text","paragraph")),c.paragraph.setStyleChain(b(a,"paragraph","paragraph")),p[d]=c);return c};this.getComputedTextStyle=function(a){a=c(a,[]);var d=a.join("/"),e=q[d];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedTextStyle,e.text.setStyleChain(b(a,"text","text")),q[d]=e);return e};this.getPageLayout=function(a){var b=J[a];b||((b=
H[a])?(b=new odf.PageLayout(b,y,v),J[a]=b):b=v);return b};this.getDefaultPageLayout=function(){return v};this.getMasterPage=function(a){var b=s[a];void 0===b&&((b=u[a])?(b=new odf.MasterPage(b,f),s[a]=b):b=null);return b};this.getDefaultMasterPage=function(){return z};this.update=function(){var b,c,e=null,h=null;q={};p={};r={};u={};s={};J={};H={};d=new odf.StylePile(y,f);a=new odf.StylePile(y,f);n=new odf.StylePile(y,f);m={text:d,paragraph:a,graphic:n};for(b=g.styles.firstElementChild;b;)b.namespaceURI===
x&&((c=k(b))?"style"===b.localName?c.addCommonStyle(b):"default-style"===b.localName&&c.setDefaultStyle(b):"default-page-layout"===b.localName&&(e=b)),b=b.nextElementSibling;v=new odf.PageLayout(e,y);for(b=g.automaticStyles.firstElementChild;b;)b.namespaceURI===x&&((c=k(b))&&"style"===b.localName?c.addAutomaticStyle(b):"page-layout"===b.localName&&(H[b.getAttributeNS(x,"name")]=b)),b=b.nextElementSibling;for(b=g.masterStyles.firstElementChild;b;)b.namespaceURI===x&&"master-page"===b.localName&&(h=
h||b,c=b,e=c.getAttributeNS(x,"name"),0<e.length&&!u.hasOwnProperty(e)&&(u[e]=c)),b=b.nextElementSibling;z=new odf.MasterPage(h,f)}};ops.OperationTransformMatrix=function(){function g(b){b.position+=b.length;b.length*=-1}function l(b){var a=0>b.length;a&&g(b);return a}function e(b,a){function c(f){b[f]===a&&e.push(f)}var e=[];b&&["style:parent-style-name","style:next-style-name"].forEach(c);return e}function b(b,a){function c(e){b[e]===a&&delete b[e]}b&&["style:parent-style-name","style:next-style-name"].forEach(c)}function c(b){var a={};Object.keys(b).forEach(function(e){a[e]="object"===typeof b[e]?c(b[e]):b[e]});return a}function k(b,
a,c,e){var f,g=!1,k=!1,l,m=[];e&&e.attributes&&(m=e.attributes.split(","));b&&(c||0<m.length)&&Object.keys(b).forEach(function(a){var e=b[a],f;"object"!==typeof e&&(c&&(f=c[a]),void 0!==f?(delete b[a],k=!0,f===e&&(delete c[a],g=!0)):-1!==m.indexOf(a)&&(delete b[a],k=!0))});if(a&&a.attributes&&(c||0<m.length)){l=a.attributes.split(",");for(e=0;e<l.length;e+=1)if(f=l[e],c&&void 0!==c[f]||m&&-1!==m.indexOf(f))l.splice(e,1),e-=1,k=!0;0<l.length?a.attributes=l.join(","):delete a.attributes}return{majorChanged:g,
minorChanged:k}}function f(b){for(var a in b)if(b.hasOwnProperty(a))return!0;return!1}function m(b){for(var a in b)if(b.hasOwnProperty(a)&&("attributes"!==a||0<b.attributes.length))return!0;return!1}function q(b,a,c,e,g){var l=b?b[g]:null,p=a?a[g]:null,q=c?c[g]:null,r=e?e[g]:null,z;z=k(l,p,q,r);l&&!f(l)&&delete b[g];p&&!m(p)&&delete a[g];q&&!f(q)&&delete c[g];r&&!m(r)&&delete e[g];return z}function p(b,a){return{opSpecsA:[b],opSpecsB:[a]}}var r;r={AddCursor:{AddCursor:p,AddMember:p,AddStyle:p,ApplyDirectStyling:p,
InsertText:p,MergeParagraph:p,MoveCursor:p,RemoveCursor:p,RemoveMember:p,RemoveStyle:p,RemoveText:p,SetParagraphStyle:p,SplitParagraph:p,UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},AddMember:{AddStyle:p,InsertText:p,MergeParagraph:p,MoveCursor:p,RemoveCursor:p,RemoveStyle:p,RemoveText:p,SetParagraphStyle:p,SplitParagraph:p,UpdateMetadata:p,UpdateParagraphStyle:p},AddStyle:{AddStyle:p,ApplyDirectStyling:p,InsertText:p,MergeParagraph:p,MoveCursor:p,RemoveCursor:p,RemoveMember:p,RemoveStyle:function(d,
a){var c,f=[d],g=[a];d.styleFamily===a.styleFamily&&(c=e(d.setProperties,a.styleName),0<c.length&&(c={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:d.styleName,removedProperties:{attributes:c.join(",")}},g.unshift(c)),b(d.setProperties,a.styleName));return{opSpecsA:f,opSpecsB:g}},RemoveText:p,SetParagraphStyle:p,SplitParagraph:p,UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},ApplyDirectStyling:{ApplyDirectStyling:function(b,a,e){var g,k,l,m,p,r,z,v;m=[b];
l=[a];if(!(b.position+b.length<=a.position||b.position>=a.position+a.length)){g=e?b:a;k=e?a:b;if(b.position!==a.position||b.length!==a.length)r=c(g),z=c(k);a=q(k.setProperties,null,g.setProperties,null,"style:text-properties");if(a.majorChanged||a.minorChanged)l=[],b=[],m=g.position+g.length,p=k.position+k.length,k.position<g.position?a.minorChanged&&(v=c(z),v.length=g.position-k.position,b.push(v),k.position=g.position,k.length=p-k.position):g.position<k.position&&a.majorChanged&&(v=c(r),v.length=
k.position-g.position,l.push(v),g.position=k.position,g.length=m-g.position),p>m?a.minorChanged&&(r=z,r.position=m,r.length=p-m,b.push(r),k.length=m-k.position):m>p&&a.majorChanged&&(r.position=p,r.length=m-p,l.push(r),g.length=p-g.position),g.setProperties&&f(g.setProperties)&&l.push(g),k.setProperties&&f(k.setProperties)&&b.push(k),e?(m=l,l=b):m=b}return{opSpecsA:m,opSpecsB:l}},InsertText:function(b,a){a.position<=b.position?b.position+=a.text.length:a.position<=b.position+b.length&&(b.length+=
a.text.length);return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,a){var c=b.position,e=b.position+b.length;c>=a.sourceStartPosition&&(c-=1);e>=a.sourceStartPosition&&(e-=1);b.position=c;b.length=e-c;return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:p,RemoveCursor:p,RemoveStyle:p,RemoveText:function(b,a){var c=b.position+b.length,e=a.position+a.length,f=[b],g=[a];e<=b.position?b.position-=a.length:a.position<c&&(b.position<a.position?b.length=e<c?b.length-a.length:a.position-b.position:(b.position=
a.position,e<c?b.length=c-e:f=[]));return{opSpecsA:f,opSpecsB:g}},SetParagraphStyle:p,SplitParagraph:function(b,a){a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMetadata:p,UpdateParagraphStyle:p},InsertText:{InsertText:function(b,a,c){b.position<a.position?a.position+=b.text.length:b.position>a.position?b.position+=a.text.length:c?a.position+=b.text.length:b.position+=a.text.length;return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,
a){b.position>=a.sourceStartPosition?b.position-=1:(b.position<a.sourceStartPosition&&(a.sourceStartPosition+=b.text.length),b.position<a.destinationStartPosition&&(a.destinationStartPosition+=b.text.length));return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:function(b,a){var c=l(a);b.position<a.position?a.position+=b.text.length:b.position<a.position+a.length&&(a.length+=b.text.length);c&&g(a);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:p,RemoveMember:p,RemoveStyle:p,RemoveText:function(b,a){var c;
c=a.position+a.length;var e=[b],f=[a];c<=b.position?b.position-=a.length:b.position<=a.position?a.position+=b.text.length:(a.length=b.position-a.position,c={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:b.position+b.text.length,length:c-b.position},f.unshift(c),b.position=a.position);return{opSpecsA:e,opSpecsB:f}},SetParagraphStyle:function(b,a){a.position>b.position&&(a.position+=b.text.length);return{opSpecsA:[b],opSpecsB:[a]}},SplitParagraph:function(b,a){b.position<a.sourceParagraphPosition&&
(a.sourceParagraphPosition+=b.text.length);b.position<=a.position?a.position+=b.text.length:b.position+=1;return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},MergeParagraph:{MergeParagraph:function(b,a,c){var e=[b],f=[a],g;b.destinationStartPosition===a.destinationStartPosition?(e=[],f=[],b.moveCursor&&(g={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:b.sourceStartPosition-1},e.push(g)),a.moveCursor&&(g={optype:"MoveCursor",memberid:a.memberid,
timestamp:a.timestamp,position:a.sourceStartPosition-1},f.push(g)),b=c?b:a,b={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:b.destinationStartPosition,styleName:b.paragraphStyleName},c?e.push(b):f.push(b)):b.destinationStartPosition<a.destinationStartPosition?(a.destinationStartPosition-=1,a.sourceStartPosition-=1):(b.destinationStartPosition-=1,b.sourceStartPosition-=1);return{opSpecsA:e,opSpecsB:f}},MoveCursor:function(b,a){var c=a.position,e=a.position+a.length,
f=Math.min(c,e),c=Math.max(c,e);f>=b.sourceStartPosition&&(f-=1);c>=b.sourceStartPosition&&(c-=1);0<=a.length?(a.position=f,a.length=c-f):(a.position=c,a.length=f-c);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:p,RemoveMember:p,RemoveStyle:p,RemoveText:function(b,a){a.position>=b.sourceStartPosition?a.position-=1:(a.position<b.destinationStartPosition&&(b.destinationStartPosition-=a.length),a.position<b.sourceStartPosition&&(b.sourceStartPosition-=a.length));return{opSpecsA:[b],opSpecsB:[a]}},
SetParagraphStyle:function(b,a){var c=[b],e=[a];if(a.position>b.sourceStartPosition)a.position-=1;else if(a.position===b.destinationStartPosition||a.position===b.sourceStartPosition)a.position=b.destinationStartPosition,b.paragraphStyleName=a.styleName;return{opSpecsA:c,opSpecsB:e}},SplitParagraph:function(b,a){var c,e=[b],f=[a];a.position<b.destinationStartPosition?(b.destinationStartPosition+=1,b.sourceStartPosition+=1):a.position>=b.destinationStartPosition&&a.position<b.sourceStartPosition?(a.paragraphStyleName=
b.paragraphStyleName,c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:b.destinationStartPosition,styleName:b.paragraphStyleName},e.push(c),a.position===b.sourceStartPosition-1&&b.moveCursor&&(c={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:a.position,length:0},e.push(c)),b.destinationStartPosition=a.position+1,b.sourceStartPosition+=1):a.position>=b.sourceStartPosition&&(a.position-=1,a.sourceParagraphPosition-=1);return{opSpecsA:e,opSpecsB:f}},
UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},MoveCursor:{MoveCursor:p,RemoveCursor:function(b,a){return{opSpecsA:b.memberid===a.memberid?[]:[b],opSpecsB:[a]}},RemoveMember:p,RemoveStyle:p,RemoveText:function(b,a){var c=l(b),e=b.position+b.length,f=a.position+a.length;f<=b.position?b.position-=a.length:a.position<e&&(b.position<a.position?b.length=f<e?b.length-a.length:a.position-b.position:(b.position=a.position,b.length=f<e?e-f:0));c&&g(b);return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:p,
SplitParagraph:function(b,a){var c=l(b);a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);c&&g(b);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},RemoveCursor:{RemoveCursor:function(b,a){var c=b.memberid===a.memberid;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveMember:p,RemoveStyle:p,RemoveText:p,SetParagraphStyle:p,SplitParagraph:p,UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},RemoveMember:{RemoveStyle:p,RemoveText:p,
SetParagraphStyle:p,SplitParagraph:p,UpdateMetadata:p,UpdateParagraphStyle:p},RemoveStyle:{RemoveStyle:function(b,a){var c=b.styleName===a.styleName&&b.styleFamily===a.styleFamily;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveText:p,SetParagraphStyle:function(b,a){var c,e=[b],f=[a];"paragraph"===b.styleFamily&&b.styleName===a.styleName&&(c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:a.position,styleName:""},e.unshift(c),a.styleName="");return{opSpecsA:e,opSpecsB:f}},
SplitParagraph:p,UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:function(d,a){var c,f=[d],g=[a];"paragraph"===d.styleFamily&&(c=e(a.setProperties,d.styleName),0<c.length&&(c={optype:"UpdateParagraphStyle",memberid:d.memberid,timestamp:d.timestamp,styleName:a.styleName,removedProperties:{attributes:c.join(",")}},f.unshift(c)),d.styleName===a.styleName?g=[]:b(a.setProperties,d.styleName));return{opSpecsA:f,opSpecsB:g}}},RemoveText:{RemoveText:function(b,a){var c=b.position+b.length,e=a.position+
a.length,f=[b],g=[a];e<=b.position?b.position-=a.length:c<=a.position?a.position-=b.length:a.position<c&&(b.position<a.position?(b.length=e<c?b.length-a.length:a.position-b.position,c<e?(a.position=b.position,a.length=e-c):g=[]):(c<e?a.length-=b.length:a.position<b.position?a.length=b.position-a.position:g=[],e<c?(b.position=a.position,b.length=c-e):f=[]));return{opSpecsA:f,opSpecsB:g}},SetParagraphStyle:function(b,a){b.position<a.position&&(a.position-=b.length);return{opSpecsA:[b],opSpecsB:[a]}},
SplitParagraph:function(b,a){var c=b.position+b.length,e=[b],f=[a];a.position<=b.position?b.position+=1:a.position<c&&(b.length=a.position-b.position,c={optype:"RemoveText",memberid:b.memberid,timestamp:b.timestamp,position:a.position+1,length:c-a.position},e.unshift(c));b.position+b.length<=a.position?a.position-=b.length:b.position<a.position&&(a.position=b.position);b.position+b.length<a.sourceParagraphPosition&&(a.sourceParagraphPosition-=b.length);return{opSpecsA:e,opSpecsB:f}},UpdateMember:p,
UpdateMetadata:p,UpdateParagraphStyle:p},SetParagraphStyle:{SetParagraphStyle:function(b,a,c){b.position===a.position&&(c?a.styleName=b.styleName:b.styleName=a.styleName);return{opSpecsA:[b],opSpecsB:[a]}},SplitParagraph:function(b,a){var e=[b],f=[a],g;b.position>a.position?b.position+=1:b.position===a.sourceParagraphPosition&&(a.paragraphStyleName=b.styleName,g=c(b),g.position=a.position+1,e.push(g));return{opSpecsA:e,opSpecsB:f}},UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},SplitParagraph:{SplitParagraph:function(b,
a,c){var e,f;b.position<a.position?e=!0:a.position<b.position?f=!0:b.position===a.position&&(c?e=!0:f=!0);e?(a.position+=1,a.sourceParagraphPosition=b.position<a.sourceParagraphPosition?a.sourceParagraphPosition+1:b.position+1):f&&(b.position+=1,b.sourceParagraphPosition=a.position<a.sourceParagraphPosition?b.sourceParagraphPosition+1:a.position+1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:p,UpdateMetadata:p,UpdateParagraphStyle:p},UpdateMember:{UpdateMetadata:p,UpdateParagraphStyle:p},UpdateMetadata:{UpdateMetadata:function(b,
a,c){var e,g=[b],l=[a];e=c?b:a;b=c?a:b;k(b.setProperties||null,b.removedProperties||null,e.setProperties||null,e.removedProperties||null);e.setProperties&&f(e.setProperties)||e.removedProperties&&m(e.removedProperties)||(c?g=[]:l=[]);b.setProperties&&f(b.setProperties)||b.removedProperties&&m(b.removedProperties)||(c?l=[]:g=[]);return{opSpecsA:g,opSpecsB:l}},UpdateParagraphStyle:p},UpdateParagraphStyle:{UpdateParagraphStyle:function(b,a,c){var e,g=[b],l=[a];b.styleName===a.styleName&&(e=c?b:a,b=c?
a:b,q(b.setProperties,b.removedProperties,e.setProperties,e.removedProperties,"style:paragraph-properties"),q(b.setProperties,b.removedProperties,e.setProperties,e.removedProperties,"style:text-properties"),k(b.setProperties||null,b.removedProperties||null,e.setProperties||null,e.removedProperties||null),e.setProperties&&f(e.setProperties)||e.removedProperties&&m(e.removedProperties)||(c?g=[]:l=[]),b.setProperties&&f(b.setProperties)||b.removedProperties&&m(b.removedProperties)||(c?l=[]:g=[]));return{opSpecsA:g,
opSpecsB:l}}}};this.passUnchanged=p;this.extendTransformations=function(b){Object.keys(b).forEach(function(a){var c=b[a],e,f=r.hasOwnProperty(a);runtime.log((f?"Extending":"Adding")+" map for optypeA: "+a);f||(r[a]={});e=r[a];Object.keys(c).forEach(function(b){var d=e.hasOwnProperty(b);runtime.assert(a<=b,"Wrong order:"+a+", "+b);runtime.log("  "+(d?"Overwriting":"Adding")+" entry for optypeB: "+b);e[b]=c[b]})})};this.transformOpspecVsOpspec=function(b,a){var c=b.optype<=a.optype,e;runtime.log("Crosstransforming:");
runtime.log(runtime.toJson(b));runtime.log(runtime.toJson(a));c||(e=b,b=a,a=e);(e=(e=r[b.optype])&&e[a.optype])?(e=e(b,a,!c),c||null===e||(e={opSpecsA:e.opSpecsB,opSpecsB:e.opSpecsA})):e=null;runtime.log("result:");e?(runtime.log(runtime.toJson(e.opSpecsA)),runtime.log(runtime.toJson(e.opSpecsB))):runtime.log("null");return e}};ops.OperationTransformer=function(){function g(e,b){for(var c,k,f=[],m=[];0<e.length&&b;){c=e.shift();c=l.transformOpspecVsOpspec(c,b);if(!c)return null;f=f.concat(c.opSpecsA);if(0===c.opSpecsB.length){f=f.concat(e);b=null;break}for(;1<c.opSpecsB.length;){k=g(e,c.opSpecsB.shift());if(!k)return null;m=m.concat(k.opSpecsB);e=k.opSpecsA}b=c.opSpecsB.pop()}b&&m.push(b);return{opSpecsA:f,opSpecsB:m}}var l=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return l};this.transform=
function(e,b){for(var c,k=[];0<b.length;){c=g(e,b.shift());if(!c)return null;e=c.opSpecsA;k=k.concat(c.opSpecsB)}return{opSpecsA:e,opSpecsB:k}}};var webodf_css="/**\n * Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>\n *\n * @licstart\n * This file is part of WebODF.\n *\n * WebODF is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License (GNU AGPL)\n * as published by the Free Software Foundation, either version 3 of\n * the License, or (at your option) any later version.\n *\n * WebODF is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with WebODF.  If not, see <http://www.gnu.org/licenses/>.\n * @licend\n *\n * @source: http://www.webodf.org/\n * @source: https://github.com/kogmbh/WebODF/\n */\n\n@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);\n@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);\n@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);\n@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);\n@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);\n@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);\n@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);\n@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);\n@namespace webodfhelper url(urn:webodf:names:helper);\n@namespace cursor url(urn:webodf:names:cursor);\n@namespace editinfo url(urn:webodf:names:editinfo);\n@namespace annotation url(urn:webodf:names:annotation);\n@namespace dc url(http://purl.org/dc/elements/1.1/);\n@namespace svgns url(http://www.w3.org/2000/svg);\n\noffice|document > *, office|document-content > * {\n  display: none;\n}\noffice|body, office|document {\n  display: inline-block;\n  position: relative;\n}\n\ntext|p, text|h {\n  display: block;\n  padding: 0;\n  margin: 0;\n  line-height: normal;\n  position: relative;\n  min-height: 1.3em; /* prevent empty paragraphs and headings from collapsing if they are empty */\n}\n*[webodfhelper|containsparagraphanchor] {\n  position: relative;\n}\ntext|s {\n    white-space: pre;\n}\ntext|tab {\n  display: inline;\n  white-space: pre;\n}\ntext|tracked-changes {\n  /*Consumers that do not support change tracking, should ignore changes.*/\n  display: none;\n}\noffice|binary-data {\n  display: none;\n}\noffice|text {\n  display: block;\n  text-align: left;\n  overflow: visible;\n  word-wrap: break-word;\n}\n\noffice|text::selection {\n  /** Let's not draw selection highlight that overflows into the office|text\n   * node when selecting content across several paragraphs\n   */\n  background: transparent;\n}\n\n.webodf-virtualSelections *::selection {\n  background: transparent;\n}\n.webodf-virtualSelections *::-moz-selection {\n  background: transparent;\n}\n\noffice|text * draw|text-box {\n/** only for text documents */\n    display: block;\n    border: 1px solid #d3d3d3;\n}\noffice|text draw|frame {\n  /** make sure frames are above the main text. */\n  z-index: 1;\n}\noffice|spreadsheet {\n  display: block;\n  border-collapse: collapse;\n  empty-cells: show;\n  font-family: sans-serif;\n  font-size: 10pt;\n  text-align: left;\n  page-break-inside: avoid;\n  overflow: hidden;\n}\noffice|presentation {\n  display: inline-block;\n  text-align: left;\n}\n#shadowContent {\n  display: inline-block;\n  text-align: left;\n}\ndraw|page {\n  display: block;\n  position: relative;\n  overflow: hidden;\n}\npresentation|notes, presentation|footer-decl, presentation|date-time-decl {\n    display: none;\n}\n@media print {\n  draw|page {\n    border: 1pt solid black;\n    page-break-inside: avoid;\n  }\n  presentation|notes {\n    /*TODO*/\n  }\n}\noffice|spreadsheet text|p {\n  border: 0px;\n  padding: 1px;\n  margin: 0px;\n}\noffice|spreadsheet table|table {\n  margin: 3px;\n}\noffice|spreadsheet table|table:after {\n  /* show sheet name the end of the sheet */\n  /*content: attr(table|name);*/ /* gives parsing error in opera */\n}\noffice|spreadsheet table|table-row {\n  counter-increment: row;\n}\noffice|spreadsheet table|table-row:before {\n  width: 3em;\n  background: #cccccc;\n  border: 1px solid black;\n  text-align: center;\n  content: counter(row);\n  display: table-cell;\n}\noffice|spreadsheet table|table-cell {\n  border: 1px solid #cccccc;\n}\ntable|table {\n  display: table;\n}\ndraw|frame table|table {\n  width: 100%;\n  height: 100%;\n  background: white;\n}\ntable|table-header-rows {\n  display: table-header-group;\n}\ntable|table-row {\n  display: table-row;\n}\ntable|table-column {\n  display: table-column;\n}\ntable|table-cell {\n  width: 0.889in;\n  display: table-cell;\n  word-break: break-all; /* prevent long words from extending out the table cell */\n}\ndraw|frame {\n  display: block;\n}\ndraw|image {\n  display: block;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  background-repeat: no-repeat;\n  background-size: 100% 100%;\n  -moz-background-size: 100% 100%;\n}\n/* only show the first image in frame */\ndraw|frame > draw|image:nth-of-type(n+2) {\n  display: none;\n}\ntext|list:before {\n    display: none;\n    content:\"\";\n}\ntext|list {\n    display: block;\n    counter-reset: list;\n}\ntext|list-item {\n    display: block;\n}\ntext|number {\n    display:none;\n}\n\ntext|a {\n    color: blue;\n    text-decoration: underline;\n    cursor: pointer;\n}\n.webodf-inactiveLinks text|a {\n    cursor: text;\n}\ntext|note-citation {\n    vertical-align: super;\n    font-size: smaller;\n}\ntext|note-body {\n    display: none;\n}\ntext|note:hover text|note-citation {\n    background: #dddddd;\n}\ntext|note:hover text|note-body {\n    display: block;\n    left:1em;\n    max-width: 80%;\n    position: absolute;\n    background: #ffffaa;\n}\ntext|bibliography-source {\n  display: none;\n}\nsvg|title, svg|desc {\n    display: none;\n}\nvideo {\n    width: 100%;\n    height: 100%\n}\n\n/* below set up the cursor */\ncursor|anchor {\n    display: none;\n}\n\ncursor|cursor {\n    display: none;\n}\n\n.webodf-caretOverlay {\n    position: absolute;\n    top: 5%; /* push down the caret; 0px can do the job, 5% looks better, 10% is a bit over */\n    height: 1em;\n    margin-left: -1px;\n    z-index: 10;\n    pointer-events: none;\n}\n\n.webodf-caretOverlay .caret {\n    position: absolute;\n    border-left: 2px solid black;\n    top: 0;\n    bottom: 0;\n}\n\n.webodf-caretOverlay .handle {\n    margin-top: 5px;\n    padding-top: 3px;\n    margin-left: auto;\n    margin-right: auto;\n    width: 64px !important;\n    height: 68px !important;\n    border-radius: 5px;\n    opacity: 0.3;\n    text-align: center;\n    background-color: black !important;\n    box-shadow: 0px 0px 5px rgb(90, 90, 90);\n    border: 1px solid black;\n\n    top: -85px !important;\n    left: -32px !important;\n}\n\n.webodf-caretOverlay .handle > img {\n    box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;\n    background-color: rgb(200, 200, 200);\n    border-radius: 5px;\n    border: 2px solid;\n    height: 60px !important;\n    width: 60px !important;\n    display: block;\n    margin: auto;\n}\n\n.webodf-caretOverlay .handle.active {\n    opacity: 0.8;\n}\n\n.webodf-caretOverlay .handle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 43%;\n}\n\n.webodf-caretSizer {\n    display: inline-block; /* inline-block is necessary so the width can be set to 0 */\n    width: 0; /* the caret sizer shouldn't take up any horizontal space */\n    visibility: hidden; /* \"hidden\" means the client rects are still calculated, but the node content is not shown */\n}\n\n/** Input Method Editor input pane & behaviours */\n/* not within a cursor */\n#eventTrap {\n    height: auto;\n    display: block;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n    width: 1px;\n    outline: none;\n    opacity: 0;\n    color: rgba(255, 255, 255, 0); /* hide the blinking caret by setting the colour to fully transparent */\n    overflow: hidden; /* The overflow visibility is used to hide and show characters being entered */\n    pointer-events: none;\n}\n\n/* within a cursor */\ncursor|cursor > #composer {\n    text-decoration: underline;\n}\n\ncursor|cursor[cursor|caret-sizer-active=\"true\"],\ncursor|cursor[cursor|composing=\"true\"] {\n    display: inline;\n}\n\neditinfo|editinfo {\n    /* Empty or invisible display:inline elements respond very badly to mouse selection.\n       Inline blocks are much more reliably selectable in Chrome & friends */\n    display: inline-block;\n}\n\n.editInfoMarker {\n    position: absolute;\n    width: 10px;\n    height: 100%;\n    left: -20px;\n    opacity: 0.8;\n    top: 0;\n    border-radius: 5px;\n    background-color: transparent;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n}\n.editInfoMarker:hover {\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);\n}\n\n.editInfoHandle {\n    position: absolute;\n    background-color: black;\n    padding: 5px;\n    border-radius: 5px;\n    opacity: 0.8;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    bottom: 100%;\n    margin-bottom: 10px;\n    z-index: 3;\n    left: -25px;\n}\n.editInfoHandle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 5px;\n}\n.editInfo {\n    font-family: sans-serif;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    color: white;\n    width: 100%;\n    height: 12pt;\n}\n.editInfoColor {\n    float: left;\n    width: 10pt;\n    height: 10pt;\n    border: 1px solid white;\n}\n.editInfoAuthor {\n    float: left;\n    margin-left: 5pt;\n    font-size: 10pt;\n    text-align: left;\n    height: 12pt;\n    line-height: 12pt;\n}\n.editInfoTime {\n    float: right;\n    margin-left: 30pt;\n    font-size: 8pt;\n    font-style: italic;\n    color: yellow;\n    height: 12pt;\n    line-height: 12pt;\n}\n\n.annotationWrapper {\n    display: inline;\n    position: relative;\n}\n\n.annotationRemoveButton:before {\n    content: '\u00d7';\n    color: white;\n    padding: 5px;\n    line-height: 1em;\n}\n\n.annotationRemoveButton {\n    width: 20px;\n    height: 20px;\n    border-radius: 10px;\n    background-color: black;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    position: absolute;\n    top: -10px;\n    left: -10px;\n    z-index: 3;\n    text-align: center;\n    font-family: sans-serif;\n    font-style: normal;\n    font-weight: normal;\n    text-decoration: none;\n    font-size: 15px;\n}\n.annotationRemoveButton:hover {\n    cursor: pointer;\n    box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);\n}\n\n.annotationNote {\n    width: 4cm;\n    position: absolute;\n    display: inline;\n    z-index: 10;\n    top: 0;\n}\n.annotationNote > office|annotation {\n    display: block;\n    text-align: left;\n}\n\n.annotationConnector {\n    position: absolute;\n    display: inline;\n    top: 0;\n    z-index: 2;\n    border-top: 1px dashed brown;\n}\n.annotationConnector.angular {\n    -moz-transform-origin: left top;\n    -webkit-transform-origin: left top;\n    -ms-transform-origin: left top;\n    transform-origin: left top;\n}\n.annotationConnector.horizontal {\n    left: 0;\n}\n.annotationConnector.horizontal:before {\n    content: '';\n    display: inline;\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: brown transparent transparent transparent;\n    top: -1px;\n    left: -5px;\n}\n\noffice|annotation {\n    width: 100%;\n    height: 100%;\n    display: none;\n    background: rgb(198, 238, 184);\n    background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    box-shadow: 0 3px 4px -3px #ccc;\n}\n\noffice|annotation > dc|creator {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    color: white;\n    background-color: brown;\n    padding: 4px;\n}\noffice|annotation > dc|date {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    border: 4px solid transparent;\n    color: black;\n}\noffice|annotation > text|list {\n    display: block;\n    padding: 5px;\n}\n\n/* This is very temporary CSS. This must go once\n * we start bundling webodf-default ODF styles for annotations.\n */\noffice|annotation text|p {\n    font-size: 10pt;\n    color: black;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    font-family: sans-serif;\n}\n\n#annotationsPane {\n    background-color: #EAEAEA;\n    width: 4cm;\n    height: 100%;\n    display: none;\n    position: absolute;\n    outline: 1px solid #ccc;\n}\n\n.webodf-annotationHighlight {\n    background-color: yellow;\n    position: relative;\n}\n\n.webodf-selectionOverlay {\n    position: absolute;\n    pointer-events: none;\n    top: 0;\n    left: 0;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 15;\n}\n.webodf-selectionOverlay > polygon {\n    fill-opacity: 0.3;\n    stroke-opacity: 0.8;\n    stroke-width: 1;\n    fill-rule: evenodd;\n}\n\n.webodf-selectionOverlay > .webodf-draggable {\n    fill-opacity: 0.8;\n    stroke-opacity: 0;\n    stroke-width: 8;\n    pointer-events: all;\n    display: none;\n\n    -moz-transform-origin: center center;\n    -webkit-transform-origin: center center;\n    -ms-transform-origin: center center;\n    transform-origin: center center;\n}\n\n#imageSelector {\n    display: none;\n    position: absolute;\n    border-style: solid;\n    border-color: black;\n}\n\n#imageSelector > div {\n    width: 5px;\n    height: 5px;\n    display: block;\n    position: absolute;\n    border: 1px solid black;\n    background-color: #ffffff;\n}\n\n#imageSelector > .topLeft {\n    top: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topRight {\n    top: -4px;\n    right: -4px;\n}\n\n#imageSelector > .bottomRight {\n    right: -4px;\n    bottom: -4px;\n}\n\n#imageSelector > .bottomLeft {\n    bottom: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topMiddle {\n    top: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .rightMiddle {\n    top: 50%;\n    right: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\n#imageSelector > .bottomMiddle {\n    bottom: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .leftMiddle {\n    top: 50%;\n    left: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar\n{\n    width: 8px;\n    height: 8px;\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-track\n{\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-thumb\n{\n    background-color: #444;\n    border-radius: 4px;\n}\n\n.webodf-hyperlinkTooltip {\n    display: none;\n    color: white;\n    background-color: black;\n    border-radius: 5px;\n    box-shadow: 2px 2px 5px gray;\n    padding: 3px;\n    position: absolute;\n    max-width: 210px;\n    text-align: left;\n    word-break: break-all;\n    z-index: 16;\n}\n\n.webodf-hyperlinkTooltipText {\n    display: block;\n    font-weight: bold;\n}\n";
